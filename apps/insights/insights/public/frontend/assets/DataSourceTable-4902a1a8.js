var Q=Object.defineProperty,J=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(r,e,o)=>e in r?Q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,z=(r,e)=>{for(var o in e||(e={}))X.call(e,o)&&P(r,o,e[o]);if(O)for(var o of O(e))Y.call(e,o)&&P(r,o,e[o]);return r},F=(r,e)=>J(r,W(e));var K=(r,e,o)=>new Promise((_,p)=>{var t=m=>{try{i(o.next(m))}catch(f){p(f)}},a=m=>{try{i(o.throw(m))}catch(f){p(f)}},i=m=>m.done?_(m.value):Promise.resolve(m.value).then(t,a);i((o=o.apply(r,e)).next())});import{k as Z}from"./index-61e7aa99.js";import{v as s,x as n,B as V,N as l,y as ee,F as $,E as D,O as x,z as d,M as v,L as u,H as g,r as j,a as te,aP as ae,f as k,Q as T,w as A,i as oe,a5 as E,am as le,aq as se,a0 as ne,n as re}from"./frappe-ui-24524c82.js";import{P as ie}from"./PageBreadcrumbs-e38fbd0a.js";import{u as ce}from"./useDataSourceTable-f88aea74.js";import"./index-45270e13.js";import"./cacheStore-8d74b582.js";const de={class:"relative flex flex-1 overflow-hidden rounded py-3"},ue={key:0,class:"absolute top-0 flex h-full w-full items-center justify-center text-lg font-light text-gray-600"},pe=l("span",null,"No Data",-1),me=[pe],_e={class:"flex flex-1 flex-col overflow-scroll text-base"},ye={key:0,class:"sticky top-0"},be={class:"whitespace-nowrap bg-gray-100 px-2.5 py-1.5 font-medium text-gray-600 first:rounded-l-md last:rounded-r-md",scope:"col"},fe={class:"border-b"},he={class:"whitespace-nowrap bg-white px-2.5 py-2"},ge={__name:"Grid",props:["header","rows"],setup(r){const e=r;return(o,_)=>(s(),n("div",de,[e.rows.length==0?(s(),n("div",ue,me)):V("",!0),l("div",_e,[l("table",null,[e.header?(s(),n("thead",ye,[l("tr",null,[ee(o.$slots,"header",{},()=>[(s(!0),n($,null,D(e.header,p=>(s(),n("td",be,x(p),1))),256))])])])):V("",!0),l("tbody",null,[(s(!0),n($,null,D(e.rows,(p,t)=>(s(),n("tr",fe,[(s(!0),n($,null,D(p,a=>(s(),n("td",he,x(d(Z)(a,100)),1))),256))]))),256))])])])]))}},ve={class:"bg-gray-100 px-2.5 py-1.5 first:rounded-l-md last:rounded-r-md",scope:"col"},xe={class:"flex items-center"},we={class:"mr-2 overflow-hidden text-ellipsis whitespace-nowrap"},ke={class:"h-6"},$e=["onClick"],Ve={key:0,class:"flex items-end space-x-2 rounded bg-white px-3 py-2 shadow-md"},Ce={__name:"DataSourceTableColumnHeader",props:{columns:Object},emits:["update-column-type"],setup(r){return(e,o)=>{const _=v("FeatherIcon"),p=v("Input"),t=v("Button"),a=v("Popover");return s(!0),n($,null,D(e.$props.columns,i=>(s(),n("td",ve,[l("div",xe,[l("span",we,x(i.label)+" : "+x(i.type),1),l("div",ke,[u(a,null,{target:g(({togglePopover:m})=>[l("div",{class:"cursor-pointer rounded p-1 hover:bg-gray-200",onClick:f=>m()},[u(_,{name:"more-horizontal",class:"h-4 w-4"})],8,$e)]),body:g(({isOpen:m,togglePopover:f})=>[m?(s(),n("div",Ve,[u(p,{class:"w-40",type:"select",label:"Change Type",options:["String","Integer","Decimal","Text","Datetime","Date","Time"],modelValue:i.type,"onUpdate:modelValue":w=>i.type=w},null,8,["modelValue","onUpdate:modelValue"]),u(t,{icon:"check",variant:"solid",onClick:w=>e.$emit("update-column-type",i)&f()},null,8,["onClick"])])):V("",!0)]),_:2},1024)])])]))),256)}}},De={class:"sticky top-0 z-10 flex items-center bg-white px-5 py-2.5"},Se={key:0,class:"ml-2 flex items-center space-x-2.5"},Ke={class:"flex flex-1 flex-col overflow-hidden bg-white px-6 py-2"},Te={key:0,class:"flex flex-1 flex-col overflow-hidden"},Le={class:"flex flex-1 overflow-scroll"},Be={key:1,class:"mt-2 flex h-full w-full flex-col items-center justify-center rounded bg-gray-50"},Ue=l("div",{class:"text-lg text-gray-600"},"Syncing columns from database...",-1),Ie={class:"space-y-4"},Ne=l("div",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Table",-1),Oe={class:"mb-2 block text-sm leading-4 text-gray-700"},Pe={key:0},ze={class:"mb-2 block text-sm leading-4 text-gray-700"},Ge={__name:"DataSourceTable",props:{name:{type:String,required:!0},table:{type:String,required:!0}},setup(r){return K(this,null,function*(){let e,o;const _=r,p=j(!1),t=te({table:{},primaryKey:{},foreignKey:{}}),a=([e,o]=ae(()=>ce({name:_.table})),e=yield e,o(),e);a.fetchPreview();const i=k({get(){return a.doc.hidden},set(c){c!==a.hidden&&a.updateVisibility.submit({hidden:c})}}),m=T({url:"insights.api.data_sources.get_tables",params:{data_source:_.name},initialData:[],auto:!0}),f=k(()=>m.data.map(c=>F(z({},c),{value:c.table}))),w=T({url:"insights.api.data_sources.get_table_columns",initialData:[]});A(()=>t.table,c=>{c?w.submit({data_source:_.name,table:c.table}):L.value=[]});const L=k({get(){var c,y;return((y=(c=w.data)==null?void 0:c.columns)==null?void 0:y.map(h=>({label:`${h.label} (${h.type})`,value:h.column})))||[]},set(c){w.data=c}}),B=k(()=>!t.table||!(t.primaryKey&&t.primaryKey.value)||!(t.foreignKey&&t.foreignKey.value)),q=oe("$notify"),U=T({url:"insights.api.data_sources.create_table_link",onSuccess(){t.table="",t.primaryKey="",t.foreignKey="",p.value=!1,q({variant:"success",title:"Success",message:"Link created successfully"})}}),H=k(()=>U.loading);function R(){B.value||U.submit({data_source:_.name,primary_table:{label:a.doc.label,table:a.doc.table},foreign_table:{label:t.table.label,table:t.table.table},primary_key:t.primaryKey.value,foreign_key:t.foreignKey.value})}const S=j(null);return A(p,c=>K(this,null,function*(){c&&(yield re(),setTimeout(()=>{S.value.input.$el.blur(),S.value.input.$el.focus()},500))})),(c,y)=>{var I,N;const h=v("Autocomplete"),G=v("Button"),M=v("Dialog");return s(),n($,null,[l("header",De,[u(ie,{class:"h-7",items:[{label:"Data Sources",href:"/data-source",route:{path:"/data-source"}},{label:_.name,route:{path:`/data-source/${_.name}`}},{label:((I=d(a).doc)==null?void 0:I.label)||_.table}]},null,8,["items"]),d(a).doc?(s(),n("div",Se,[u(d(le),{theme:i.value?"yellow":"green",size:"md"},{default:g(()=>[E(x(i.value?"Disabled":"Enabled"),1)]),_:1},8,["theme"]),u(d(se),{placement:"left",button:{icon:"more-horizontal",variant:"ghost"},options:[{label:i.value?"Enable":"Disable",icon:i.value?"eye":"eye-off",onClick:()=>i.value=!i.value},{label:"Sync Table",icon:"refresh-cw",onClick:()=>d(a).sync()},{label:"Add Link",icon:"link",onClick:()=>p.value=!0}]},null,8,["options"])])):V("",!0)]),l("div",Ke,[d(a).doc&&d(a).doc.columns&&((N=d(a).rows)!=null&&N.data)&&!d(a).syncing?(s(),n("div",Te,[l("div",Le,[u(ge,{header:!0,rows:d(a).rows.data},{header:g(()=>[u(Ce,{columns:d(a).doc.columns,onUpdateColumnType:d(a).updateColumnType},null,8,["columns","onUpdateColumnType"])]),_:1},8,["rows"])])])):(s(),n("div",Be,[u(d(ne),{class:"mb-2 w-8 text-gray-500"}),Ue]))]),u(M,{options:{title:"Create a Link"},modelValue:p.value,"onUpdate:modelValue":y[3]||(y[3]=C=>p.value=C)},{"body-content":g(()=>{var C;return[l("div",Ie,[l("div",null,[Ne,u(h,{ref_key:"$autocomplete",ref:S,modelValue:t.table,"onUpdate:modelValue":y[0]||(y[0]=b=>t.table=b),options:f.value,placeholder:"Select a table..."},null,8,["modelValue","options"])]),l("div",null,[l("div",Oe," Select a column from "+x(d(a).doc.label),1),u(h,{modelValue:t.primaryKey,"onUpdate:modelValue":y[1]||(y[1]=b=>t.primaryKey=b),options:d(a).doc.columns.map(b=>({label:`${b.label} (${b.type})`,value:b.column}))},null,8,["modelValue","options"])]),(C=t.table)!=null&&C.value?(s(),n("div",Pe,[l("div",ze," Select a column from "+x(t.table.label),1),u(h,{modelValue:t.foreignKey,"onUpdate:modelValue":y[2]||(y[2]=b=>t.foreignKey=b),options:L.value},null,8,["modelValue","options"])])):V("",!0)])]}),actions:g(()=>[u(G,{variant:"solid",onClick:R,loading:H.value,disabled:B.value},{default:g(()=>[E(" Create ")]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"])],64)}})}};export{Ge as default};
