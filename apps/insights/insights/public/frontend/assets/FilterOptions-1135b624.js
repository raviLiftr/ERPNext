var S=Object.defineProperty,U=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var $=(i,s,a)=>s in i?S(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,O=(i,s)=>{for(var a in s||(s={}))F.call(s,a)&&$(i,a,s[a]);if(L)for(var a of L(s))j.call(s,a)&&$(i,a,s[a]);return i},B=(i,s)=>U(i,A(s));var g=(i,s,a)=>new Promise((l,y)=>{var _=u=>{try{m(a.next(u))}catch(v){y(v)}},c=u=>{try{m(a.throw(u))}catch(v){y(v)}},m=u=>u.done?l(u.value):Promise.resolve(u.value).then(_,c);m((a=a.apply(i,s)).next())});import{g as z,a as Q}from"./useDashboards-ef8a3602.js";import{f as D,i as G,r as M,a as T,M as N,v as f,x,L as C,N as d,F as H,E as J,A as K,O as P,G as R,B as E,z as W}from"./frappe-ui-24524c82.js";import"./index-61e7aa99.js";const X={class:"space-y-4"},Y=d("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Column",-1),Z={key:0},I=d("div",{class:"mb-2 space-y-1"},[d("span",{class:"block text-sm leading-4 text-gray-700"},"Links"),d("span",{class:"block text-xs leading-4 text-gray-600"}," Select charts to link to this filter. The filter will be applied to the selected column in the linked charts. ")],-1),ee={class:"max-h-[20rem] space-y-2 overflow-y-scroll"},se={__name:"FilterOptions",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(i,{emit:s}){const a=i,l=D({get:()=>a.modelValue,set:t=>s("update:modelValue",t)});l.value.links||(l.value.links={}),l.value.column||(l.value.column={});function y(t,e){l.value=B(O({},l.value),{[t]:e})}const _=G("dashboard"),c=_.doc.items.filter(t=>_.isChart(t)),m=c.map(t=>t.options.query),u=M([]);z(m).then(t=>{u.value=t.map(e=>({label:e.label,column:e.column,type:e.type,table:e.table,data_source:e.data_source,description:`${e.type} - ${e.table_label}`,value:`${e.table}.${e.column}`}))}),c.forEach(t=>{l.value.links[t.item_id]&&V(t)});function v(t,e){return g(this,null,function*(){var n;const r=l.value.links;if(t){r[e.item_id]={},k[e.options.query]||(yield V(e));const b=(n=k[e.options.query])==null?void 0:n.find(o=>{var p,h,w,q;return((p=o.column)==null?void 0:p.toLowerCase())===((h=l.value.column.column)==null?void 0:h.toLowerCase())&&((w=o.table)==null?void 0:w.toLowerCase())===((q=l.value.column.table)==null?void 0:q.toLowerCase())});b&&(r[e.item_id]=b)}else delete r[e.item_id];y("links",r)})}const k=T({});function V(t){return g(this,null,function*(){const e=l.value.column;if(!(e!=null&&e.column))return;const r=yield Q(t.options.query);k[t.options.query]=r.map(n=>({label:n.label,column:n.column,table:n.table,type:n.type,table_label:n.table_label,data_source:n.data_source,description:`${n.type} - ${n.table_label}`,value:`${n.table}.${n.column}`}))})}return(t,e)=>{var b;const r=N("Input"),n=N("Autocomplete");return f(),x("div",X,[C(r,{type:"text",label:"Label",modelValue:l.value.label,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.label=o),placeholder:"Enter filter label"},null,8,["modelValue"]),d("div",null,[Y,C(n,{modelValue:l.value.column,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.column=o),options:u.value,placeholder:"Select a column"},null,8,["modelValue","options"])]),(b=l.value.column)!=null&&b.column?(f(),x("div",Z,[I,d("div",ee,[(f(!0),x(H,null,J(W(c),o=>(f(),x("div",{class:"flex h-8 w-full items-center",key:o.item_id},[C(r,{type:"checkbox",class:"flex-shrink-0 focus:ring-0",onChange:p=>v(p,o),value:l.value.links[o.item_id]},null,8,["onChange","value"]),d("span",{class:K(["mx-2 flex-1 truncate text-base font-medium",[l.value.links[o.item_id]?"text-gray-900":"font-normal text-gray-600"]])},P(o.options.title),3),l.value.links[o.item_id]&&o.options.query?(f(),R(n,{key:0,class:"w-28 flex-shrink-0",placeholder:"Select Column",options:k[o.options.query],modelValue:l.value.links[o.item_id],"onUpdate:modelValue":p=>l.value.links[o.item_id]=p,"empty-text":"No matching columns found"},null,8,["options","modelValue","onUpdate:modelValue"])):E("",!0)]))),128))])])):E("",!0)])}}};export{se as default};
