var D=(b,o,d)=>new Promise((x,u)=>{var y=c=>{try{h(d.next(c))}catch(e){u(e)}},v=c=>{try{h(d.throw(c))}catch(e){u(e)}},h=c=>c.done?x(c.value):Promise.resolve(c.value).then(y,v);h((d=d.apply(b,o)).next())});import{B as q,k as E}from"./index-61e7aa99.js";import{f as w,r as P,s as z,v as n,x as r,O as k,B as _,N as m,F as N,E as C,A as F,z as O,P as R}from"./frappe-ui-24524c82.js";const T={key:0,class:"flex h-full w-full flex-col space-y-2 overflow-hidden rounded"},V={key:0,class:"text-lg font-normal leading-6 text-gray-800"},A={class:"relative flex flex-1 flex-col overflow-scroll text-base"},L={key:0,class:"absolute top-0 flex h-full w-full items-center justify-center text-lg text-gray-600"},S=m("span",null,"No Data",-1),G=[S],H={key:1,class:"w-full"},I=["colspan"],J=["colspan"],U={__name:"PivotTable",props:{data:{type:Object,required:!0},options:{type:Object,required:!0}},setup(b){const o=b,d=w(()=>Object.keys(o.data[0]));function x(e,i,a){const s=o.data.map(t=>d.value.map(l=>t[l]));return R("insights.api.queries.apply_pivot_transform",{data:[d.value,...s],rows:e.map(t=>t.label),columns:i.map(t=>t.label),values:a.map(t=>t.label)})}const u=P([]);z(()=>D(this,null,function*(){var i,a,s,t,l,f,p;if(!((i=o.data)!=null&&i.length)||!((s=(a=o.options)==null?void 0:a.rows)!=null&&s.length)||!((l=(t=o.options)==null?void 0:t.columns)!=null&&l.length)||!((p=(f=o.options)==null?void 0:f.values)!=null&&p.length))return;const e=yield x(o.options.rows,o.options.columns,o.options.values);u.value=c(e)}));const y=w(()=>{var e;return(e=u.value)!=null&&e.length?u.value[0]:[]}),v=w(()=>{var e;return(e=u.value)!=null&&e.length?u.value.slice(1):[]});function h(e){return e?!isNaN(e):!1}function c(e){const i=[];for(let a=0;a<e.length;a++){const s=e[a],t=[];for(let l=0;l<s.length;l++){const f=s[l];if(f==="<<skip>>")continue;const p={value:f};if(p.colspan||p.rowspan){t.push(p);continue}let j=1;for(let g=l+1;g<s.length;g++){const B=s[g];if(B!=="<<skip>>")if(B===f&&f!=0)j++,s[g]="<<skip>>";else break}p.colspan=j,t.push(p)}i.push(t)}return i}return(e,i)=>{var a;return(a=u.value)!=null&&a.length?(n(),r("div",T,[o.options.title?(n(),r("div",V,k(o.options.title),1)):_("",!0),m("div",A,[v.value.length==0?(n(),r("div",L,G)):_("",!0),v.value.length?(n(),r("table",H,[m("thead",null,[m("tr",null,[(n(!0),r(N,null,C(y.value,s=>(n(),r("td",{class:"truncate border-b border-r bg-white py-2 px-3 text-center",scope:"col",colspan:s.colspan},k(s.value),9,I))),256))])]),m("tbody",null,[(n(!0),r(N,null,C(v.value,(s,t)=>(n(),r("tr",{key:t},[(n(!0),r(N,null,C(s,l=>(n(),r("td",{class:F(["truncate border-b border-r bg-white py-2 px-3",h(l.value)?"text-right":""]),colspan:l.colspan},k(h(l.value)?O(q)(l.value):O(E)(l.value,100)),11,J))),256))]))),128))])])):_("",!0)])])):_("",!0)}}};export{U as default};
