var kt=Object.defineProperty,Ct=Object.defineProperties;var Vt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,At=Object.prototype.propertyIsEnumerable;var Pe=(a,t,n)=>t in a?kt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,P=(a,t)=>{for(var n in t||(t={}))Tt.call(t,n)&&Pe(a,n,t[n]);if(Fe)for(var n of Fe(t))At.call(t,n)&&Pe(a,n,t[n]);return a},Y=(a,t)=>Ct(a,Vt(t));var J=(a,t,n)=>new Promise((o,s)=>{var e=c=>{try{x(n.next(c))}catch(m){s(m)}},r=c=>{try{x(n.throw(c))}catch(m){s(m)}},x=c=>c.done?o(c.value):Promise.resolve(c.value).then(e,r);x((n=n.apply(a,t)).next())});import{P as Ot}from"./PageBreadcrumbs-e38fbd0a.js";import{_ as Ie}from"./Tabs-2e22988b.js";import{w as ue,L as St}from"./widgets-f5903e20.js";import{f as V,Q as le,w as q,r as E,M as T,v as i,G as S,H as O,N as l,O as Q,x as $,L as p,z as v,B as A,F,E as G,i as B,Z as ce,a5 as M,_ as te,aV as ze,D as Ue,J as X,aW as pe,ay as xe,aC as N,a as H,aB as We,aq as Et,ao as Se,n as Be,y as ge,K as fe,V as Me,s as be,aF as re,A as Z,q as ve,P as Je,ar as Dt,a0 as Rt,C as Qt,aP as It,aH as Ut}from"./frappe-ui-24524c82.js";import{f as z,a as Ke,m as me,e as Bt,i as Ye,l as ne,F as se,k as Mt,n as Ze,o as ee,p as Ne,u as Ft,r as Pt,q as Xe,c as Ee,b as Nt,t as Lt,G as jt,w as et,A as qt}from"./index-61e7aa99.js";import{u as Gt}from"./useDashboards-ef8a3602.js";import{C as Ht,D as tt}from"./DatePicker-f885a1f8.js";import{_ as zt,a as Ve,b as ot,c as ae,C as Wt,d as Jt}from"./useQuery-b1a5cdc5.js";import{u as Kt}from"./dataSourceStore-3ba6c3b5.js";import{u as Yt}from"./queryStore-d82f5e4a.js";import{a as Zt,u as lt}from"./index-45270e13.js";import{d as we}from"./results-60b5fd7f.js";import{D as nt}from"./vuedraggable.umd-a5e26eb5.js";import{_ as Xt}from"./ListPicker-10d4a6be.js";import{_ as _e}from"./UsePopover-9747e78c.js";import{X as Te}from"./x-8e1e14d8.js";import{u as st}from"./useDataSource-327864e5.js";import{u as Le}from"./useDataSourceTable-f88aea74.js";const eo=z("ArrowDownUpIcon",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]),to=z("ArrowDownIcon",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),oo=z("ArrowUpIcon",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),lo=z("BookmarkMinusIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]),no=z("BracesIcon",[["path",{d:"M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1",key:"ezmyqa"}],["path",{d:"M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1",key:"e1hn23"}]]),so=z("BugIcon",[["rect",{width:"8",height:"14",x:"8",y:"6",rx:"4",key:"hq8nra"}],["path",{d:"m19 7-3 2",key:"fmg8ec"}],["path",{d:"m5 7 3 2",key:"dkxqes"}],["path",{d:"m19 19-3-2",key:"1hbhi4"}],["path",{d:"m5 19 3-2",key:"dvt2ee"}],["path",{d:"M20 13h-4",key:"1agfp2"}],["path",{d:"M4 13h4",key:"1bwh8b"}],["path",{d:"m10 4 1 2",key:"1pot59"}],["path",{d:"m14 4-1 2",key:"m8sn0o"}]]),ao=z("ChevronDownIcon",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ro=z("CombineIcon",[["rect",{width:"8",height:"8",x:"2",y:"2",rx:"2",key:"z1hh3n"}],["path",{d:"M14 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"83orz6"}],["path",{d:"M20 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"k86dmt"}],["path",{d:"M10 18H5c-1.7 0-3-1.3-3-3v-1",key:"6vokjl"}],["polyline",{points:"7 21 10 18 7 15",key:"1k02g0"}],["rect",{width:"8",height:"8",x:"14",y:"14",rx:"2",key:"1fa9i4"}]]),io=z("CornerLeftDownIcon",[["polyline",{points:"14 15 9 20 4 15",key:"nkc4i"}],["path",{d:"M20 4h-7a4 4 0 0 0-4 4v12",key:"nbpdq2"}]]),uo=z("CornerRightUpIcon",[["polyline",{points:"10 9 15 4 20 9",key:"1lr6px"}],["path",{d:"M4 20h7a4 4 0 0 0 4-4V4",key:"1plgdj"}]]),co=z("CropIcon",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]),je=z("ExternalLinkIcon",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),po=z("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),mo=z("OptionIcon",[["path",{d:"M3 3h6l6 18h6",key:"ph9rgk"}],["path",{d:"M14 3h7",key:"16f0ms"}]]),fo=z("SheetIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"9",y2:"21",key:"1ib60c"}],["line",{x1:"15",x2:"15",y1:"9",y2:"21",key:"1n26ft"}]]),vo=z("SigmaIcon",[["path",{d:"M18 7V4H6l6 8-6 8h12v-3",key:"zis8ev"}]]),_o={class:"bg-white px-4 py-5 sm:p-6"},ho={class:"mb-3 text-lg font-medium leading-6 text-gray-900"},yo={class:"space-y-3 text-base"},xo={key:0,class:"space-y-4"},go={class:"flex items-center space-x-4 rounded border px-4 py-2"},bo={class:"flex flex-1 flex-col"},wo=l("div",{class:"font-medium text-gray-600"},"Create Public Link",-1),$o={class:"text-sm text-gray-500"},ko={key:0,class:"flex overflow-hidden rounded bg-gray-100"},Co={class:"font-code form-input flex-1 overflow-hidden text-ellipsis whitespace-nowrap rounded-r-none text-sm text-gray-600"},Vo={key:1},To={class:"space-y-3"},Ao=l("div",{class:"font-medium text-gray-600"},"Teams with access",-1),Oo={key:0,class:"space-y-3"},So={class:"ml-2 flex flex-col"},Eo={class:"text-gray-500"},Do={key:1,class:"flex h-20 items-center justify-center rounded border-2 border-dashed text-sm font-light text-gray-500"},Ro={__name:"ShareDialog",props:{show:{type:Boolean,required:!0},resourceType:{type:String,required:!0},resourceName:{type:String,required:!0},allowPublicAccess:{type:Boolean,default:!1},isPublic:{type:Boolean,default:!1}},emits:["update:show","togglePublicAccess"],setup(a,{emit:t}){const n=a,o=Ke().settings,s=V({get:()=>n.show,set:h=>{t("update:show",h)}}),e=V(()=>`Share ${n.resourceType.replace("Insights ","")}`),r=V({get:()=>n.isPublic,set:h=>{t("togglePublicAccess",h?1:0)}}),x=le({url:"insights.api.public.get_public_key",params:{resource_type:n.resourceType,resource_name:n.resourceName}});q(r,(h,y)=>{h&&!y&&x.fetch()},{immediate:!0});const c=V(()=>{const h=x.data,y=`${window.location.origin}/insights/public/dashboard/`;return r.value&&h?y+h:null}),m=V(()=>{const h=x.data,y=`${window.location.origin}/insights/public/dashboard/`,C='width="800" height="600" frameborder="0" allowtransparency';return r.value&&h?`<iframe src="${y+h}" ${C}></iframe>`:null}),f=le({url:"insights.api.permissions.get_resource_access_info",params:{resource_type:n.resourceType,resource_name:n.resourceName}});q(s,(h,y)=>{h&&!y&&f.fetch()});const g=V(()=>{var h;return((h=f.data)==null?void 0:h.authorized_teams)||[]}),w=E(null),u=V(()=>{var h;return(h=f.data)==null?void 0:h.unauthorized_teams.map(y=>({label:y.team_name,value:y.name,description:y.members_count+" members"}))}),d=le({url:"insights.api.permissions.grant_access"});function b(h){d.submit({resource_type:n.resourceType,resource_name:n.resourceName,team:h.value}).then(()=>{f.fetch()}),w.value=null}const _=le({url:"insights.api.permissions.revoke_access"});function k(h){_.submit({resource_type:n.resourceType,resource_name:n.resourceName,team:h}).then(()=>{f.fetch()})}return(h,y)=>{const C=T("FeatherIcon"),U=T("Checkbox"),R=T("Button"),D=T("Tooltip"),W=T("Autocomplete"),ie=T("Avatar"),oe=T("Dialog");return i(),S(oe,{modelValue:s.value,"onUpdate:modelValue":y[4]||(y[4]=L=>s.value=L),dismissable:!0},{body:O(()=>[l("div",_o,[l("h3",ho,Q(e.value),1),l("div",yo,[n.allowPublicAccess?(i(),$("div",xo,[l("div",go,[p(C,{name:"globe",class:"h-5 w-5 text-blue-500"}),l("div",bo,[wo,l("div",$o," Anyone with the link can view this "+Q(a.resourceType.replace("Insights ","").toLowerCase()),1)]),p(U,{modelValue:r.value,"onUpdate:modelValue":y[0]||(y[0]=L=>r.value=L)},null,8,["modelValue"])]),c.value?(i(),$("div",ko,[l("div",Co,Q(c.value),1),p(D,{text:"Copy Link",hoverDelay:.1},{default:O(()=>[p(R,{class:"w-8 rounded-none bg-gray-200 hover:bg-gray-300",icon:"link-2",onClick:y[1]||(y[1]=L=>v(me)(c.value))})]),_:1}),p(D,{text:"Copy iFrame",hoverDelay:.1},{default:O(()=>[p(R,{class:"w-8 rounded-l-none bg-gray-200 hover:bg-gray-300",icon:"code",onClick:y[2]||(y[2]=L=>v(me)(m.value))})]),_:1})])):A("",!0)])):A("",!0),v(o).enable_permissions?(i(),$("div",Vo,[p(W,{modelValue:w.value,"onUpdate:modelValue":[y[3]||(y[3]=L=>w.value=L),b],placeholder:"Add a team to share with",options:u.value,autofocus:!1},null,8,["modelValue","options"]),l("div",To,[Ao,g.value.length>0?(i(),$("div",Oo,[(i(!0),$(F,null,G(g.value,L=>(i(),$("div",{class:"flex items-center text-gray-600",key:L.name},[p(ie,{label:L.team_name},null,8,["label"]),l("div",So,[l("span",null,Q(L.team_name),1),l("span",Eo,Q(L.members_count)+" members",1)]),p(R,{icon:"x",class:"ml-auto",variant:"minimal",onClick:j=>k(L.name)},null,8,["onClick"])]))),128))])):(i(),$("div",Do," Only you have access to this "+Q(a.resourceType.replace("Insights ","").toLowerCase()),1))])])):A("",!0)])])]),_:1},8,["modelValue"])}}},Qo={class:"flex h-full flex-col space-y-4 overflow-y-scroll pr-4"},at={__name:"ChartOptions",setup(a){const t=B("query"),n=[{label:"Select a chart type",value:void 0,disabled:!0}].concat(ue.getChartOptions());function o(){t.chart.doc.options={}}return(s,e)=>{const r=T("FormControl"),x=T("Button");return i(),$("div",Qo,[p(r,{type:"select",label:"Chart Type",class:"w-full",modelValue:v(t).chart.doc.chart_type,"onUpdate:modelValue":[e[0]||(e[0]=c=>v(t).chart.doc.chart_type=c),e[1]||(e[1]=c=>v(t).chart.doc.options={})],options:v(n)},null,8,["modelValue","options"]),v(t).chart.doc.chart_type?(i(),S(ce(v(ue).getOptionComponent(v(t).chart.doc.chart_type)),{key:v(t).chart.doc.chart_type,modelValue:v(t).chart.doc.options,"onUpdate:modelValue":e[2]||(e[2]=c=>v(t).chart.doc.options=c),columns:v(t).resultColumns},null,8,["modelValue","columns"])):A("",!0),p(x,{variant:"subtle",onClick:o},{default:O(()=>[M(" Reset Options ")]),_:1})])}}},Io={class:"bg-white px-4 py-5 sm:p-6"},Uo={class:"mb-3 text-lg font-medium leading-6 text-gray-900"},Bo={class:"space-y-3 text-base"},Mo={class:"space-y-4"},Fo={class:"flex items-center space-x-4 rounded border px-4 py-2"},Po={class:"flex flex-1 flex-col"},No=l("div",{class:"font-medium text-gray-800"},"Create Public Link",-1),Lo={class:"text-sm text-gray-700"},jo={key:0,class:"flex overflow-hidden rounded bg-gray-100"},qo={class:"font-code form-input flex-1 overflow-hidden text-ellipsis whitespace-nowrap rounded-r-none text-sm text-gray-600"},Go={__name:"PublicShareDialog",props:{show:{type:Boolean,required:!0},resourceType:{type:String,required:!0},resourceName:{type:String,required:!0},isPublic:{type:Boolean,default:!1}},emits:["update:show","togglePublicAccess"],setup(a,{emit:t}){const n=a,o=V({get:()=>n.show,set:f=>{t("update:show",f)}}),s=V(()=>`Share ${n.resourceType.replace("Insights ","")}`),e=V({get:()=>n.isPublic,set:f=>{t("togglePublicAccess",f?1:0)}}),r=le({url:"insights.api.public.get_public_key",params:{resource_type:n.resourceType,resource_name:n.resourceName}});q(e,(f,g)=>{f&&!g&&r.fetch()},{immediate:!0});const x=n.resourceType.replace("Insights ","").toLowerCase(),c=V(()=>{const f=r.data,g=`${window.location.origin}/insights/public/${x}/`;return e.value&&f?g+f:null}),m=V(()=>{const f=r.data,g=`${window.location.origin}/insights/public/${x}/`,w='width="800" height="600" frameborder="0" allowtransparency';return e.value&&f?`<iframe src="${g+f}" ${w}></iframe>`:null});return(f,g)=>{const w=T("FeatherIcon"),u=T("Checkbox"),d=T("Button"),b=T("Tooltip"),_=T("Dialog");return i(),S(_,{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=k=>o.value=k),dismissable:!0},{body:O(()=>[l("div",Io,[l("h3",Uo,Q(s.value),1),l("div",Bo,[l("div",Mo,[l("div",Fo,[p(w,{name:"globe",class:"h-5 w-5 text-blue-500"}),l("div",Po,[No,l("div",Lo," Anyone with the link can view this "+Q(a.resourceType.replace("Insights ","").toLowerCase()),1)]),p(u,{modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=k=>e.value=k)},null,8,["modelValue"])]),c.value?(i(),$("div",jo,[l("div",qo,Q(c.value),1),p(b,{text:"Copy Link",hoverDelay:.1},{default:O(()=>[p(d,{class:"w-8 rounded-none bg-gray-200 hover:bg-gray-300",icon:"link-2",onClick:g[1]||(g[1]=k=>v(me)(c.value))})]),_:1}),p(b,{text:"Copy iFrame",hoverDelay:.1},{default:O(()=>[p(d,{class:"w-8 rounded-l-none bg-gray-200 hover:bg-gray-300",icon:"code",onClick:g[2]||(g[2]=k=>v(me)(m.value))})]),_:1})])):A("",!0)])])])]),_:1},8,["modelValue"])}}},Ho={class:"flex gap-2"},zo={class:"text-base"},Wo=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Dashboard",-1),Jo={__name:"ChartActionButtons",setup(a){const t=B("query"),n=E(!1),o=E(!1),s=Gt(),e=E(null),r=E(!1),x=V(()=>s.list.map(u=>({label:u.title,value:u.name}))),c=B("$notify");function m(){if(t.chart.doc.chart_type=="Auto"){c({variant:"warning",title:"Choose a chart type",message:"Chart type cannot be 'Auto' to add to dashboard"});return}o.value=!0}const f=()=>J(this,null,function*(){e.value&&(yield t.chart.addToDashboard(e.value.value),o.value=!1,c({variant:"success",title:"Success",message:"Chart added to dashboard"}))});q(o,u=>u&&s.reload(),{immediate:!0});const g=B("chartRef");function w(){const u=t.chart.doc.options.title||t.doc.title;Bt(g.value.$el,`${u}.png`)}return(u,d)=>{var h,y;const b=T("Button"),_=T("Autocomplete"),k=T("Dialog");return i(),$(F,null,[l("div",Ho,[p(b,{variant:"outline",onClick:d[0]||(d[0]=C=>m())},{default:O(()=>[M(" Add to Dashboard ")]),_:1}),p(b,{variant:"outline",onClick:w},{default:O(()=>[M(" Download ")]),_:1}),p(b,{variant:"outline",onClick:d[1]||(d[1]=C=>n.value=!0)},{default:O(()=>[M(" Share ")]),_:1})]),(h=v(t).chart.doc)!=null&&h.doctype&&((y=v(t).chart.doc)!=null&&y.name)?(i(),S(Go,{key:0,show:n.value,"onUpdate:show":d[2]||(d[2]=C=>n.value=C),"resource-type":v(t).chart.doc.doctype,"resource-name":v(t).chart.doc.name,"allow-public-access":!0,isPublic:!!v(t).chart.doc.is_public,onTogglePublicAccess:v(t).chart.togglePublicAccess},null,8,["show","resource-type","resource-name","isPublic","onTogglePublicAccess"])):A("",!0),p(k,{options:{title:"Add to Dashboard"},modelValue:o.value,"onUpdate:modelValue":d[4]||(d[4]=C=>o.value=C)},{"body-content":O(()=>[l("div",zo,[Wo,p(_,{options:x.value,modelValue:e.value,"onUpdate:modelValue":d[3]||(d[3]=C=>e.value=C)},null,8,["options","modelValue"])])]),actions:O(()=>[p(b,{variant:"solid",onClick:f,loading:r.value},{default:O(()=>[M(" Add ")]),_:1},8,["loading"])]),_:1},8,["modelValue"])],64)}}},Ko={},Yo={width:"158",height:"118",viewBox:"0 0 158 118",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Zo=ze('<g filter="url(#filter0_dd_33890_17132)"><rect x="88.3955" y="53.6816" width="40" height="40" rx="4" transform="rotate(-8.96992 88.3955 53.6816)" fill="white"></rect><path d="M104.171 76.1108L108.501 70.4174L112.275 73.1625L117.274 66.0299" stroke="#505A62" stroke-linecap="round"></path><path d="M112.928 66.7168L117.274 66.0308L117.96 70.377" stroke="#505A62" stroke-linecap="round"></path></g><g filter="url(#filter1_dd_33890_17132)"><rect x="24" y="53.0078" width="40" height="40" rx="4" fill="white"></rect><path d="M44 66.957L44 79.057" stroke="#505A62" stroke-width="1.25" stroke-linecap="round"></path><path d="M39.6 69.6641L39.6 79.0576" stroke="#505A62" stroke-width="1.25" stroke-linecap="round"></path><path d="M48.4 71.957L48.4 79.0571" stroke="#505A62" stroke-width="1.25" stroke-linecap="round"></path></g><g filter="url(#filter2_dd_33890_17132)"><rect x="64.6121" y="23" width="40" height="40" rx="4" transform="rotate(16.4816 64.6121 23)" fill="white"></rect><g clip-path="url(#clip0_33890_17132)"><path d="M84.5644 52.0617C83.8393 53.173 82.8392 54.078 81.6613 54.6889C80.4834 55.2999 79.1676 55.5961 77.8416 55.5488C76.5155 55.5015 75.2241 55.1123 74.0927 54.419C72.9613 53.7257 72.0283 52.7517 71.3842 51.5917C70.74 50.4316 70.4066 49.1247 70.4162 47.7978C70.4258 46.4709 70.7782 45.169 71.4391 44.0184C72.1 42.8678 73.0471 41.9075 74.1884 41.2307C75.3297 40.5539 76.6266 40.1834 77.9532 40.1554" stroke="#505A62" stroke-linecap="round"></path><path d="M85.4997 50.0379C85.7866 49.0682 85.8797 48.0516 85.7737 47.046C85.6677 46.0404 85.3646 45.0655 84.8818 44.177C84.3991 43.2885 83.746 42.5038 82.96 41.8677C82.1739 41.2316 81.2703 40.7566 80.3007 40.4697L78.1161 47.8533L85.4997 50.0379Z" stroke="#505A62"></path></g></g><defs><filter id="filter0_dd_33890_17132" x="64.3955" y="24.4453" width="93.7474" height="93.748" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="12"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.16915 0 0 0 0 0.258824 0 0 0 0.03 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_33890_17132"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feMorphology radius="2" operator="dilate" in="SourceAlpha" result="effect2_dropShadow_33890_17132"></feMorphology><feOffset dy="2"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.168627 0 0 0 0 0.258824 0 0 0 0.12 0"></feColorMatrix><feBlend mode="normal" in2="effect1_dropShadow_33890_17132" result="effect2_dropShadow_33890_17132"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_33890_17132" result="shape"></feBlend></filter><filter id="filter1_dd_33890_17132" x="0" y="30.0078" width="88" height="88" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="12"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.16915 0 0 0 0 0.258824 0 0 0 0.03 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_33890_17132"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feMorphology radius="2" operator="dilate" in="SourceAlpha" result="effect2_dropShadow_33890_17132"></feMorphology><feOffset dy="2"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.168627 0 0 0 0 0.258824 0 0 0 0.12 0"></feColorMatrix><feBlend mode="normal" in2="effect1_dropShadow_33890_17132" result="effect2_dropShadow_33890_17132"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_33890_17132" result="shape"></feBlend></filter><filter id="filter2_dd_33890_17132" x="29.2638" y="0" width="97.7047" height="97.7051" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="12"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.16915 0 0 0 0 0.258824 0 0 0 0.03 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_33890_17132"></feBlend><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feMorphology radius="2" operator="dilate" in="SourceAlpha" result="effect2_dropShadow_33890_17132"></feMorphology><feOffset dy="2"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0.0666667 0 0 0 0 0.168627 0 0 0 0 0.258824 0 0 0 0.12 0"></feColorMatrix><feBlend mode="normal" in2="effect1_dropShadow_33890_17132" result="effect2_dropShadow_33890_17132"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_33890_17132" result="shape"></feBlend></filter><clipPath id="clip0_33890_17132"><rect x="70.6889" y="34.1836" width="22" height="22" rx="4" transform="rotate(16.4816 70.6889 34.1836)" fill="white"></rect></clipPath></defs>',4),Xo=[Zo];function el(a,t){return i(),$("svg",Yo,Xo)}const tl=te(Ko,[["render",el]]),ol={class:"flex items-center gap-2"},ll={class:"truncate"},nl={__name:"ChartTypeSelector",setup(a){const t=B("query");t.chart.doc.chart_type||(t.chart.doc.chart_type="Auto");const n=V(()=>{var e;return(e=t.chart.doc)==null?void 0:e.chart_type}),o={label:"Auto",value:"Auto"},s=V(()=>[o,...ue.getChartOptions()]);return(e,r)=>{const x=T("Button"),c=T("Autocomplete");return i(),S(c,{"return-value":!0,options:s.value,modelValue:v(t).chart.doc.chart_type,"onUpdate:modelValue":r[0]||(r[0]=m=>v(t).chart.doc.chart_type=m)},{target:O(({togglePopover:m})=>[p(x,{variant:"outline",onClick:m},{default:O(()=>[l("div",ol,[(i(),S(ce(v(ue).getIcon(n.value)),{class:"h-4 w-4 text-gray-600"})),l("span",ll,Q(n.value),1),p(v(ao),{class:"h-4 w-4 text-gray-600"})])]),_:2},1032,["onClick"])]),"item-prefix":O(({option:m})=>[(i(),S(ce(v(ue).getIcon(m.value)),{class:"h-4 w-4 text-gray-600"}))]),"item-suffix":O(({selected:m})=>[m?(i(),S(v(Ht),{key:0,class:"h-4 w-4 text-gray-600"})):A("",!0)]),_:1},8,["options","modelValue"])}}},sl={class:"flex flex-1 flex-col gap-4 overflow-hidden"},al={key:0,class:"flex flex-1 flex-col items-center justify-center rounded border"},rl={class:"text-gray-500"},il={class:"flex w-full flex-shrink-0 justify-between"},ul={class:"flex w-full flex-1 overflow-hidden rounded border"},rt={__name:"ChartSection",setup(a){const t=B("query"),n=E(null);Ue("chartRef",n);const o=V(()=>{var r,x;return((r=t.chart.doc)==null?void 0:r.name)&&((x=t.formattedResults)==null?void 0:x.length)&&t.doc.status!=="Pending Execution"}),s=V(()=>{var r;return t.doc.status=="Pending Execution"?"Execute the query to see the chart":(r=t.formattedResults)!=null&&r.length?"Pick a chart type to get started":"No results found"}),e=V(()=>{const r=t.chart.doc.chart_type,x=t.chart.getGuessedChart(r),c=Object.assign({},x.options,t.chart.doc.options);return{type:x.chart_type,data:t.chart.data,options:r=="Auto"?x.options:c,component:ue.getComponent(x.chart_type)}});return(r,x)=>{var c;return i(),$("div",sl,[(c=v(t).chart.doc)!=null&&c.name&&!o.value?(i(),$("div",al,[p(tl),l("span",rl,Q(s.value),1)])):(i(),$(F,{key:1},[l("div",il,[p(nl),p(Jo)]),l("div",ul,[e.value.type?(i(),S(ce(e.value.component),{ref_key:"chartRef",ref:n,options:e.value.options,data:e.value.data,key:JSON.stringify(v(t).chart.doc)},null,8,["options","data"])):A("",!0)])],64))])}}},cl={class:"flex items-center justify-between rounded-b-md px-1 text-base"},dl={key:0,class:"flex items-center space-x-1"},pl=l("span",{class:"text-gray-600"},"Showing",-1),ml={class:"font-mono"},fl=l("span",{class:"text-gray-600"},"out of",-1),vl={class:"font-mono"},_l=l("span",{class:"text-gray-600"},"rows in",-1),hl={class:"font-mono"},yl=l("span",{class:"text-gray-600"},"seconds",-1),xl={class:"ml-auto flex items-center space-x-1"},gl=l("span",{class:"text-gray-600"},"Limit to",-1),bl=["size"],wl=l("span",{class:"text-gray-600"},"rows",-1),$l={__name:"ResultFooter",setup(a){const t=B("query"),n=V(()=>t.doc.execution_time),o=V(()=>t.doc.results_row_count),s=V(()=>Math.min(t.MAX_ROWS,o.value)),e=B("assistedQuery"),r=E(null),x=V({get:()=>e.limit,set:c=>e.limit=c||100});return V(()=>e.columns.filter(c=>c.order)),(c,m)=>(i(),$("div",cl,[o.value>=0?(i(),$("div",dl,[pl,l("span",ml,Q(s.value),1),fl,l("span",vl,Q(o.value),1),_l,l("span",hl,Q(n.value),1),yl])):A("",!0),l("div",xl,[gl,X(l("input",{type:"text",ref_key:"limitInput",ref:r,"onUpdate:modelValue":m[0]||(m[0]=f=>x.value=f),size:String(x.value).length,class:"form-input",onKeydown:[m[1]||(m[1]=xe(N(f=>c.$refs.limitInput.blur(),["stop"]),["enter"])),m[2]||(m[2]=xe(N(f=>c.$refs.limitInput.blur(),["stop"]),["esc"]))]},null,40,bl),[[pe,x.value,void 0,{number:!0}]]),wl])]))}},kl={class:"flex h-full w-full flex-col"},Cl=l("div",{class:"flex-shrink-0 uppercase leading-7 tracking-wide text-gray-600"}," Native Query ",-1),Vl={class:"flex flex-1 flex-shrink-0 overflow-hidden rounded border"},Tl={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden py-4"},Al={key:0,class:"flex items-center space-x-1"},Ol=l("span",{class:"text-gray-600"},"Showing",-1),Sl={class:"font-mono"},El=l("span",{class:"text-gray-600"},"out of",-1),Dl={class:"font-mono"},Rl=l("span",{class:"text-gray-600"},"rows in",-1),Ql={class:"font-mono"},Il=l("span",{class:"text-gray-600"},"seconds",-1),Ul={__name:"NativeQueryBuilder",setup(a){const t=B("query");E(t.doc.sql);const n=V(()=>t.doc.execution_time),o=V(()=>t.doc.results_row_count),s=V(()=>Math.min(t.MAX_ROWS,o.value));return(e,r)=>(i(),$("div",kl,[Cl,l("div",Vl,[p(zt)]),l("div",Tl,[p(Ve,null,{footer:O(()=>[o.value>=0?(i(),$("div",Al,[Ol,l("span",Sl,Q(s.value),1),El,l("span",Dl,Q(o.value),1),Rl,l("span",Ql,Q(n.value),1),Il])):A("",!0)]),_:1})])]))}},Bl={class:"space-y-4 text-base"},Ml={class:"flex gap-4"},Fl={class:"flex flex-1 flex-col space-y-4"},Pl={class:"flex flex-1 flex-col space-y-4"},Nl={class:"space-y-4"},Ll=l("p",{class:"text-lg font-medium text-gray-800"},"Send alert when",-1),jl={key:0,class:"!mt-2 flex gap-4"},ql={key:1,class:"!mt-2"},Gl={class:"form-textarea h-20"},Hl=l("p",{class:"font-code mt-1 text-sm text-gray-600"},' Example: results["Count of Records"][0] > 100 ',-1),zl=l("p",{class:"text-lg font-medium text-gray-800"},[M(" Message "),l("span",{class:"text-sm font-normal"},"(Optional)")],-1),Wl=l("p",{class:"mt-2 text-sm text-gray-600"},[M(" You can use all the fields from the query like "),l("span",{class:"font-code px-1"}," title, data_source "),M(" etc. like this "),l("span",{class:"font-code px-1",innerHTML:"{{ title }}"})],-1),Jl={__name:"AlertDialog",props:{show:Boolean,queryName:String},emits:["update:show"],setup(a,{emit:t}){const n=a,o=V({get:()=>n.show,set:b=>{t("update:show",b)}});let s=B("query");s||(s=ot(n.queryName));const e=H({title:"",query:n.queryName,frequency:"Daily",cron:null,channel:"Email",recipients:"",telegram_chat_id:null,condition:{isAdvanced:!1,left:"",operator:"=",right:null,advanceCondition:null},message:null}),r=[{value:"Hourly",label:"Check once an hour"},{value:"Daily",label:"Check once a day"},{value:"Weekly",label:"Check once a week"},{value:"Monthly",label:"Check once a month"},{value:"Custom",label:"Custom"}],x=[{label:"Email",value:"Email"},{label:"Telegram",value:"Telegram"}],c=["=","!=",">",">=","<","<="],m=V(()=>!!(!e.title||!e.frequency||e.frequency==="Custom"&&!e.cron||!e.channel||e.channel==="Email"&&!e.recipients||e.channel==="Telegram"&&!e.telegram_chat_id||e.condition.isAdvanced&&!e.condition.advanceCondition||!e.condition.isAdvanced&&!e.condition.left||!e.condition.isAdvanced&&!e.condition.operator||!e.condition.isAdvanced&&!e.condition.right)),f=le({url:"insights.api.alerts.create_alert"});function g(){return e.condition.isAdvanced?e.condition.advanceCondition:`any(results['${e.condition.left}'] ${e.condition.operator} ${e.condition.right})`}function w(){if(m.value)return;const b=P({},e);b.condition=g(),f.submit({alert:b}).then(_=>{console.log(_),o.value=!1})}const u=le({url:"insights.api.alerts.test_alert"});function d(){if(m.value)return;const b=P({},e);b.condition=g(),u.submit({alert:b}).then(_=>{console.log(_)})}return(b,_)=>{const k=T("Input"),h=T("Button"),y=T("Dialog");return i(),S(y,{options:{title:"Create Alert"},modelValue:o.value,"onUpdate:modelValue":_[12]||(_[12]=C=>o.value=C),dismissable:!0},{"body-content":O(()=>[l("div",Bl,[l("div",Ml,[l("div",Fl,[p(k,{type:"text",label:"Alert Name",modelValue:e.title,"onUpdate:modelValue":_[0]||(_[0]=C=>e.title=C),placeholder:"e.g. Low Inventory"},null,8,["modelValue"]),p(k,{type:"select",label:"Frequency",modelValue:e.frequency,"onUpdate:modelValue":_[1]||(_[1]=C=>e.frequency=C),options:r},null,8,["modelValue"]),e.frequency==="Custom"?(i(),S(k,{key:0,type:"text",label:"Cron",modelValue:e.cron,"onUpdate:modelValue":_[2]||(_[2]=C=>e.cron=C),placeholder:"e.g. 0 0 12 * * ?"},null,8,["modelValue"])):A("",!0)]),l("div",Pl,[p(k,{type:"select",label:"Channel",modelValue:e.channel,"onUpdate:modelValue":_[3]||(_[3]=C=>e.channel=C),options:x},null,8,["modelValue"]),e.channel==="Email"?(i(),S(k,{key:0,type:"text",label:"Recipients",modelValue:e.recipients,"onUpdate:modelValue":_[4]||(_[4]=C=>e.recipients=C),placeholder:"e.g. john@example.com, henry@example.com"},null,8,["modelValue"])):A("",!0),e.channel==="Telegram"?(i(),S(k,{key:1,type:"text",label:"Telegram Chat ID",modelValue:e.telegram_chat_id,"onUpdate:modelValue":_[5]||(_[5]=C=>e.telegram_chat_id=C),placeholder:"e.g. 123456789"},null,8,["modelValue"])):A("",!0)])]),l("div",Nl,[Ll,e.condition.isAdvanced?(i(),$("div",ql,[l("div",Gl,[p(ae,{modelValue:e.condition.advanceCondition,"onUpdate:modelValue":_[9]||(_[9]=C=>e.condition.advanceCondition=C),placeholder:"Write a python expression..."},null,8,["modelValue"])]),Hl])):(i(),$("div",jl,[p(k,{type:"select",class:"flex-1",modelValue:e.condition.left,"onUpdate:modelValue":_[6]||(_[6]=C=>e.condition.left=C),options:v(s).resultColumns.map(C=>({label:C.label,value:C.label,description:C.type}))},null,8,["modelValue","options"]),p(k,{type:"select",class:"flex-1",modelValue:e.condition.operator,"onUpdate:modelValue":_[7]||(_[7]=C=>e.condition.operator=C),options:c},null,8,["modelValue"]),p(k,{type:"text",class:"flex-1",modelValue:e.condition.right,"onUpdate:modelValue":_[8]||(_[8]=C=>e.condition.right=C),placeholder:"e.g. 100"},null,8,["modelValue"])])),p(k,{type:"checkbox",label:"Use Advanced Condition",modelValue:e.condition.isAdvanced,"onUpdate:modelValue":_[10]||(_[10]=C=>e.condition.isAdvanced=C)},null,8,["modelValue"])]),l("div",null,[zl,p(k,{type:"textarea",class:"mt-1 h-40",modelValue:e.message,"onUpdate:modelValue":_[11]||(_[11]=C=>e.message=C),placeholder:`e.g. 
Hey,
We have **low inventory** for **{{ title }}**.
Please order more.
Thanks,
						`},null,8,["modelValue","placeholder"]),Wl])])]),actions:O(()=>[p(h,{variant:"solid",disabled:m.value,loading:v(f).loading,class:"mr-2",onClick:w},{default:O(()=>[M(" Create ")]),_:1},8,["disabled","loading"]),p(h,{disabled:m.value,loading:d.loading,onClick:d},{default:O(()=>[M(" Test ")]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])}}},Kl={class:"flex flex-shrink-0 space-x-2"},Yl={class:"relative"},Zl=["innerHTML"],Xl={__name:"QueryMenu",props:["query"],setup(a){const t=a,n=Ke().settings,o=t.query||B("query"),s=E(!1),e=E(!1),r=E(!1),x=E(!1),c=E(!1),f=Zt()["Meta+E"];q(f,h=>h&&o.execute());const g=V(()=>o.doc.sql.replaceAll(`
`,"<br>").replaceAll("      ","&ensp;&ensp;&ensp;&ensp;")),w=We(),u=B("$notify");function d(){o.duplicate().then(h=>J(this,null,function*(){yield Be(),w.push(`/query/build/${h}`),u({variant:"success",title:"Query Duplicated"})}))}function b(){o.store().then(h=>{u({variant:"success",title:"Query Stored"})})}function _(){o.unstore().then(h=>{u({variant:"success",title:"Query Unstored"})})}function k(){let h=o.doc.results;if(h.length===0)return;h[0]=h[0].map(D=>D.label);const y=h.map(D=>D.join(",")).join(`
`),C=new Blob([y],{type:"text/csv"}),U=window.URL.createObjectURL(C),R=document.createElement("a");R.setAttribute("hidden",""),R.setAttribute("href",U),R.setAttribute("download",`${o.doc.title||"data"}.csv`),document.body.appendChild(R),R.click(),document.body.removeChild(R)}return(h,y)=>{const C=T("Button");return i(),$(F,null,[l("div",Kl,[p(v(Et),{placement:"left",button:{icon:"more-horizontal",variant:"outline"},options:[v(o).doc.is_stored?{label:"Unstore Query",icon:v(lo),onClick:_}:{label:"Store Query",icon:"bookmark",onClick:b},{label:"Execute (âŒ˜+E)",icon:"play",onClick:v(o).execute},v(n).enable_permissions&&v(o).isOwner?{label:"Share",icon:"share-2",onClick:()=>r.value=!0}:null,{label:"Set Alert",icon:"bell",onClick:()=>x.value=!0},v(o).doc.is_native_query?null:{label:"View SQL",icon:"help-circle",onClick:()=>e.value=!0},{label:"Duplicate",icon:"copy",onClick:d},{label:"Download CSV",icon:"download",onClick:k},{label:v(o).doc.is_assisted_query?"Switch to Classic Query Builder":"Switch to Visual Query Builder",icon:"toggle-left",onClick:()=>c.value=!0},{label:"Delete",icon:"trash-2",onClick:()=>s.value=!0}]},null,8,["options"]),p(v(Se),{modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=U=>s.value=U),dismissable:!0,options:{title:"Delete Query",message:"Are you sure you want to delete this query?",icon:{name:"trash",appearance:"danger"},actions:[{label:"Delete",variant:"solid",theme:"red",onClick:()=>{v(Yt)().delete(v(o).doc.name).then(()=>{h.$router.push("/query"),s.value=!1})}}]}},null,8,["modelValue","options"]),p(v(Se),{modelValue:c.value,"onUpdate:modelValue":y[1]||(y[1]=U=>c.value=U),dismissable:!0,options:{title:v(o).doc.is_assisted_query?"Switch to Classic Query Builder":"Switch to Visual Query Builder",message:v(o).doc.is_assisted_query?"All the changes you have made in the query will be preserved. However, if you make any changes in the Classic Query Builder, they will be lost when you switch back to the Visual Query Builder. Are you sure you want to continue?":"All the changes you have made in the Classic Query Builder will be converted to the Visual Query Builder. Are you sure you want to continue?",icon:{name:"toggle-left",appearance:"warning"},actions:[{label:"Switch",variant:"solid",onClick:()=>v(o).switchQueryBuilder().then(()=>c.value=!1)}]}},null,8,["modelValue","options"]),p(v(Se),{options:{title:"Generated SQL",size:"3xl"},modelValue:e.value,"onUpdate:modelValue":y[3]||(y[3]=U=>e.value=U),dismissable:!0},{"body-content":O(()=>[l("div",Yl,[l("p",{class:"rounded border bg-gray-100 p-2 text-base text-gray-600",style:{"font-family":"'Fira Code'"},innerHTML:g.value},null,8,Zl),p(C,{icon:"copy",variant:"outline",class:"absolute bottom-2 right-2",onClick:y[2]||(y[2]=U=>v(me)(v(o).doc.sql))})])]),_:1},8,["modelValue"])]),v(n).enable_permissions?(i(),S(Ro,{key:0,show:r.value,"onUpdate:show":y[4]||(y[4]=U=>r.value=U),"resource-type":v(o).doc.doctype,"resource-name":v(o).doc.name},null,8,["show","resource-type","resource-name"])):A("",!0),v(o).doc.name?(i(),S(Jl,{key:1,show:x.value,"onUpdate:show":y[5]||(y[5]=U=>x.value=U),queryName:v(o).doc.name},null,8,["show","queryName"])):A("",!0)],64)}}},en={class:"flex w-full items-center justify-between gap-4"},tn={class:"flex items-center"},on={key:0,class:"mr-2"},ln={__name:"QueryHeader",setup(a){const t=B("$notify"),n=B("query"),o=E(n.doc.title);Ye(o,n.updateTitle,{debounce:500});const s=Kt(),e=m=>p("div",{class:"group flex w-full cursor-pointer items-center justify-between rounded-md px-2 py-2 text-sm hover:bg-gray-100",onClick:()=>c(m.name)},[p("span",null,[m.label]),X(p(T("FeatherIcon"),{name:"check",class:"h-4 w-4 text-gray-600"},null),[[fe,m.active]])]),r=V(()=>s.list.find(m=>m.name===n.doc.data_source)),x=V(()=>s.list.map(m=>({component:f=>p(e,{name:m.name,label:m.title,active:m.name===n.doc.data_source},null)})));function c(m){n.changeDataSource(m).then(()=>{t({title:"Data source updated",variant:"success"})})}return(m,f)=>{var u;const g=T("Dropdown"),w=T("Button");return i(),$("div",en,[l("div",tn,[v(n).doc.is_stored?(i(),$("div",on,[p(v(Jt),{class:"h-4 w-4 text-gray-600",fill:"currentColor"})])):A("",!0),p(Wt,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=d=>o.value=d),placeholder:"Untitled Query",class:"mr-3 rounded-sm text-xl font-medium !text-gray-900 focus:ring-2 focus:ring-gray-700 focus:ring-offset-4"},null,8,["modelValue"]),p(g,{class:"mr-2",button:{iconLeft:"database",variant:"outline",label:((u=r.value)==null?void 0:u.title)||"Select data source"},options:x.value},null,8,["button","options"]),v(n).doc.is_native_query?A("",!0):(i(),S(w,{key:1,class:"mr-2",variant:"outline",icon:"play",onClick:f[1]||(f[1]=d=>v(n).execute()),disabled:!v(n).doc.data_source,loading:v(n).executing},null,8,["disabled","loading"])),p(Xl)]),l("div",null,[ge(m.$slots,"right-actions")])])}}},nn=l("p",{class:"-mt-4 mb-5 text-base text-gray-600"},[M(" Variables are used to store sensitive information such as API keys and credentials. They can be referenced in your script just like any other variable. For eg.: "),l("code",{class:"text-sm text-gray-800"},"print(api_key)")],-1),sn={class:"flex flex-col overflow-hidden"},an={class:"relative flex max-h-[10rem] flex-col overflow-y-auto"},rn=l("div",{class:"sticky top-0 flex gap-x-2 border-b py-2 text-sm uppercase text-gray-600"},[l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Name"),l("div",{class:"flex flex-1 flex-shrink-0 px-2"},"Value"),l("div",{class:"flex w-10"})],-1),un={class:"flex flex-1 flex-shrink-0"},cn=["onUpdate:modelValue"],dn={class:"flex flex-1 flex-shrink-0"},pn=["onUpdate:modelValue"],mn={class:"flex w-10 justify-end"},fn={key:0,class:"flex justify-center py-4"},vn=l("span",{class:"text-sm text-gray-400"},"No variables",-1),_n=[vn],hn={class:"mt-4 flex justify-between"},yn=l("span",{class:"text-sm"},"Add Variable",-1),xn={__name:"VariablesDialog",props:{show:Boolean,variables:Array},emits:["update:show","update:variables","save"],setup(a,{emit:t}){const n=a,o=V({get:()=>n.show,set:e=>t("update:show",e)}),s=V({get:()=>n.variables,set:e=>t("update:variables",e)});return(e,r)=>{const x=T("Button"),c=T("Dialog");return i(),S(c,{modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=m=>o.value=m),options:{title:"Variables"}},{"body-content":O(()=>{var m;return[nn,l("div",sn,[l("div",an,[rn,(i(!0),$(F,null,G(s.value,(f,g)=>(i(),$("div",{class:"flex gap-x-2",key:g},[l("div",un,[X(l("input",{class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0",type:"text","onUpdate:modelValue":w=>f.variable_name=w,placeholder:"eg. api_key"},null,8,cn),[[pe,f.variable_name]])]),l("div",dn,[X(l("input",{type:"password",class:"w-full rounded-sm border-none bg-transparent px-2 py-2 text-base focus:bg-gray-100 focus:outline-none focus:ring-0","onUpdate:modelValue":w=>f.variable_value=w,placeholder:"**********************"},null,8,pn),[[pe,f.variable_value]])]),l("div",mn,[p(x,{variant:"ghost",icon:"x",onClick:w=>s.value.splice(g,1)},null,8,["onClick"])])]))),128)),((m=s.value)==null?void 0:m.length)===0?(i(),$("div",fn,_n)):A("",!0)]),l("div",hn,[p(x,{variant:"subtle",onClick:r[0]||(r[0]=f=>s.value.push({variable_name:"",variable_type:"text",variable_value:""}))},{default:O(()=>[yn]),_:1}),p(x,{variant:"solid",label:"Save",onClick:r[1]||(r[1]=f=>e.$emit("save",s.value))})])])]}),_:1},8,["modelValue"])}}},gn={class:"flex h-full w-full flex-col"},bn=l("div",{class:"flex-shrink-0 uppercase leading-7 tracking-wide text-gray-600"}," Script Query ",-1),wn={class:"flex flex-1 flex-shrink-0 overflow-hidden rounded border"},$n={class:"relative flex flex-1 flex-col overflow-y-scroll"},kn={class:"sticky bottom-0 flex justify-between bg-white p-2"},Cn={class:"flex gap-2"},Vn={key:0,class:"flex h-full w-[30rem] flex-col overflow-hidden bg-gray-50 p-3"},Tn=l("div",{class:"text-sm uppercase tracking-wide text-gray-600"},"Logs",-1),An={class:"mt-2 flex w-full flex-col gap-2 overflow-scroll font-mono"},On={class:"text-gray-400"},Sn={class:"text-gray-500"},En={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden py-4"},Dn={class:"flex w-full flex-col gap-2 text-base leading-5"},Rn=l("div",{class:""}," In the Script Query interface, you can write custom Python scripts to query the database and retrieve data as a Pandas DataFrame. You can also fetch data from external sources using Pandas functions ",-1),Qn=l("div",null,[M(" For detailed information about these functions and how to use them, please refer to "),l("a",{class:"text-blue-500 underline",href:"https://frappeframework.com/docs/user/en/desk/scripting/script-api"}," Frappe Framework's Script API ")],-1),In=l("div",{class:""}," Example script to read data from a CSV file hosted on a URL and create a Pandas DataFrame: ",-1),Un={class:"rounded bg-gray-50 text-sm"},Bn=`def fetch_data_from_url():
		# URL of the CSV file
		csv_url = "https://example.com/data.csv"

		try:
				# Read data from the CSV file into a Pandas DataFrame
				df = pd.read_csv(csv_url)

				# use the log function to log messages to the script log
				log(df)

				# return the DataFrame
				return df

		except Exception as e:
				log("An error occurred:", str(e))
				return None

# Call the function to execute the script and
# then convert the data into a Pandas DataFrame or a List of lists with first row as column names
results = fetch_data_from_url()`,Mn={__name:"ScriptQueryEditor",setup(a){const t=B("query"),n=E(t.doc.script);q(()=>t.doc.script,f=>n.value=f);const o=E(!1);function s(){return J(this,null,function*(){if(!o.value){o.value=!0;try{yield t.updateScript(n.value),yield t.execute()}finally{o.value=!1}}})}const e=E(!1);function r(f){t.updateScriptVariables(f),e.value=!1}const x=lt(`insights:query-${t.doc.name}-show-logs`,!1),c=V(()=>{var f,g;return(g=(f=t.doc.script_log)==null?void 0:f.split(`
`))==null?void 0:g.slice(1)}),m=E(!1);return(f,g)=>{const w=T("Button"),u=T("Dialog");return i(),$(F,null,[l("div",gn,[bn,l("div",wn,[l("div",$n,[p(ae,{language:"python",modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=d=>n.value=d),placeholder:"Enter your script here..."},null,8,["modelValue"]),l("div",kn,[l("div",Cn,[p(w,{variant:"outline",icon:"help-circle",onClick:g[1]||(g[1]=d=>m.value=!0)}),p(w,{variant:"outline",onClick:g[2]||(g[2]=d=>e.value=!e.value)},{icon:O(()=>[p(v(no),{class:"h-4 w-4"})]),_:1}),p(w,{variant:"outline",onClick:g[3]||(g[3]=d=>x.value=!v(x))},{icon:O(()=>[p(v(so),{class:"h-4 w-4"})]),_:1}),p(w,{variant:"solid",icon:"play",onClick:s,loading:o.value},null,8,["loading"])])])]),p(Me,{tag:"div",name:"slide","enter-active-class":"transition ease-out duration-200","enter-from-class":"transform translate-x-full opacity-0","enter-to-class":"transform translate-x-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform translate-x-0","leave-to-class":"transform translate-x-full"},{default:O(()=>[v(x)?(i(),$("div",Vn,[Tn,l("div",An,[(i(!0),$(F,null,G(c.value,(d,b)=>(i(),$("div",{key:b,class:"flex gap-2"},[l("div",On,"["+Q(b+1)+"]",1),l("div",Sn,Q(d),1)]))),128))])])):A("",!0)]),_:1})]),l("div",En,[p(Ve)])]),p(xn,{show:e.value,"onUpdate:show":g[4]||(g[4]=d=>e.value=d),variables:v(t).doc.variables,"onUpdate:variables":g[5]||(g[5]=d=>v(t).doc.variables=d),onSave:r},null,8,["show","variables"]),p(u,{modelValue:m.value,"onUpdate:modelValue":g[6]||(g[6]=d=>m.value=d),options:{title:"Help",size:"3xl"}},{"body-content":O(()=>[l("div",Dn,[Rn,Qn,In,l("div",Un,[p(ae,{readOnly:!0,language:"python","model-value":Bn})])])]),_:1},8,["modelValue"])],64)}}},Fn={class:"relative flex flex-col space-y-3"},Pn={class:"space-y-1 text-sm"},Nn=l("div",{class:"text-gray-700"},"Aggregation Type",-1),Ln={key:0,class:"space-y-1 text-sm"},jn=l("div",{class:"text-gray-700"},"Column",-1),qn={class:"space-y-1 text-sm"},Gn=l("div",{class:"text-gray-700"},"Label",-1),Hn={key:1,class:"space-y-1 text-sm"},zn=l("div",{class:"text-gray-700"},"Date Format",-1),Wn={class:"space-y-1 text-sm"},Jn=l("div",{class:"text-gray-700"},"Sort",-1),Kn={class:"sticky bottom-0 mt-3 flex justify-end space-x-2 bg-white pt-1"},it={__name:"SimpleColumnPicker",props:{column:{type:Object,default:{}}},emits:["column-select","close"],setup(a,{emit:t}){const n=a,o=B("query"),s=E([{label:"No Aggregation",value:""},{label:"Group by",value:"Group By"},{label:"Count of Records",value:"Count"},{label:"Sum of",value:"Sum"},{label:"Avg of",value:"Avg"},{label:"Min of",value:"Min"},{label:"Max of",value:"Max"},{label:"Cumulative Count of Records",value:"Cumulative Count"},{label:"Cumulative Sum of",value:"Cumulative Sum"}]),e=H({column:Y(P({},n.column),{value:n.column.column}),label:n.column.label,order_by:n.column.order_by,aggType:s.value.find(k=>k.value==n.column.aggregation),dateFormat:we.find(k=>{var h;return k.value==((h=n.column.format_option)==null?void 0:h.date_format)})||{}});e.aggType||(e.aggType={label:"No Aggregation",value:""});const r=V(()=>{var k;return e.aggType.label&&!((k=e.aggType.label)!=null&&k.includes("Count"))}),x=V(()=>!e.label||r.value&&ne(e.column)||g.value&&ne(e.dateFormat)),c=o.columns.options,m=V(()=>e.aggType.value==="Sum"||e.aggType.value==="Avg"||e.aggType.value==="Min"||e.aggType.value==="Max"||e.aggType.value==="Cumulative Sum"),f=V(()=>m.value?c==null?void 0:c.filter(k=>se.NUMBER.includes(k.type)):c),g=V(()=>["Date","Datetime"].includes(e.column.type));function w(k){e.column.format_option={date_format:typeof k=="string"?k:k.value}}function u(k){e.aggType=k||{},e.label=e.aggType.label}function d(k){e.column=k||{},e.column.name=n.column.name,e.aggType.value?e.label=e.aggType.label+" "+e.column.label:e.label=e.column.label}function b(){var y;if(x.value)return;const k=(y=n.column)==null?void 0:y.name,h=Y(P({},e.column),{aggregation:e.aggType.value,label:e.label,order_by:e.order_by,format_option:g.value?e.column.format_option:null});r.value||(h.column="count",h.type="Integer",h.table=o.tables.data[0].table,h.table_label=o.tables.data[0].table_label),k?o.updateColumn.submit({column:h}):o.addColumn.submit({column:h}),t("close")}function _(){o.removeColumn.submit({column:e.column}),t("close")}return(k,h)=>{const y=T("Autocomplete"),C=T("Input"),U=T("Button");return i(),$("div",Fn,[l("div",Pn,[Nn,p(y,{modelValue:e.aggType,"onUpdate:modelValue":[h[0]||(h[0]=R=>e.aggType=R),u],options:s.value,placeholder:"Select aggregation type"},null,8,["modelValue","options"])]),r.value?(i(),$("div",Ln,[jn,p(y,{modelValue:e.column,"onUpdate:modelValue":[h[1]||(h[1]=R=>e.column=R),d],options:f.value,placeholder:"Select a column...",emptyText:m.value?"No number columns":"No columns"},null,8,["modelValue","options","emptyText"])])):A("",!0),l("div",qn,[Gn,p(C,{type:"text",modelValue:e.label,"onUpdate:modelValue":h[2]||(h[2]=R=>e.label=R),class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),g.value?(i(),$("div",Hn,[zn,p(y,{modelValue:e.dateFormat,"onUpdate:modelValue":[h[3]||(h[3]=R=>e.dateFormat=R),w],options:v(we).map(R=>Y(P({},R),{description:R.value})),placeholder:"Select a date format..."},null,8,["modelValue","options"])])):A("",!0),l("div",Wn,[Jn,p(C,{type:"select",modelValue:e.order_by,"onUpdate:modelValue":h[4]||(h[4]=R=>e.order_by=R),options:[{label:"",value:""},{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",Kn,[n.column.name?(i(),S(U,{key:0,class:"text-red-500",variant:"outline",onClick:_},{default:O(()=>[M(" Remove ")]),_:1})):A("",!0),p(U,{onClick:b,variant:"solid",disabled:x.value},{default:O(()=>[M(Q(n.column.name?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},K={in:{syntax:'in(column_name, "value1", "value2", ...)',description:"Checks if column contains any of the provided values.",example:'in(`status`, "Closed", "Resolved")'},not_in:{syntax:'not_in(column_name, "value1", "value2", ...)',description:"Checks if column excludes the provided values.",example:'not_in(`status`, "Closed", "Resolved")'},is_set:{syntax:"is_set(column_name)",description:"Checks if column has a value.",example:"is_set(`status`)"},is_not_set:{syntax:"is_not_set(column_name)",description:"Checks if column lacks a value.",example:"is_not_set(`status`)"},between:{syntax:'between(column_name, "value1", "value2")',description:"Checks if column value is between two values.",example:"between(`age`, 10, 30)"},contains:{syntax:'contains(column_name, "value")',description:"Checks if column contains the specified value.",example:'contains(`customer`, "John")'},not_contains:{syntax:'not_contains(column_name, "value")',description:"Checks if column excludes the specified value.",example:'not_contains(`customer`, "John")'},ends_with:{syntax:'ends_with(column_name, "value")',description:"Checks if column ends with the specified value.",example:'ends_with(`customer`, "Souza")'},starts_with:{syntax:'starts_with(column_name, "value")',description:"Checks if column starts with the specified value.",example:'starts_with(`customer`, "John")'},lower:{syntax:"lower(string_column)",description:"Converts string to lowercase.",example:"lower(`category`)"},upper:{syntax:"upper(string_column)",description:"Converts string to uppercase.",example:"upper(`category`)"},concat:{syntax:"concat(column1, column2, ...)",description:"Combines values from columns or strings.",example:'concat(`first_name`, " ", `last_name`)'},replace:{syntax:'replace(column_name, "search", "replace")',description:"Replaces occurrences in the column.",example:'replace(`category`, "_", "-")'},abs:{syntax:"abs(number_column)",description:"Returns absolute value of the column.",example:"abs(`paid_amount`)"},sum:{syntax:"sum(number_column)",description:"Sums values of the column.",example:"sum(`paid_amount`)"},min:{syntax:"min(number_column)",description:"Finds minimum value of the column.",example:"min(`paid_amount`)"},max:{syntax:"max(number_column)",description:"Finds maximum value of the column.",example:"max(`paid_amount`)"},avg:{syntax:"avg(number_column)",description:"Calculates average value of the column.",example:"avg(`paid_amount`)"},round:{syntax:"round(number_column)",description:"Rounds the column value.",example:"round(`paid_amount`)"},floor:{syntax:"floor(number_column)",description:"Rounds the column value down.",example:"floor(`paid_amount`)"},ceil:{syntax:"ceil(number_column)",description:"Rounds the column value up.",example:"ceil(`paid_amount`)"},timespan:{syntax:'timespan(column_name, "timespan")',description:"Checks if column value is within the timespan.",example:'timespan(`creation`, "Last 7 Days")'},now:{syntax:"now()",description:"Gets current date and time.",example:"`posting_date` = now()"},today:{syntax:"today()",description:"Gets current date.",example:"`posting_date` = today()"},start_of:{syntax:"start_of(unit, date)",description:"Finds start of the given unit (e.g., Month, Year).",example:'start_of("Month", today())'},time_elapsed:{syntax:"time_elapsed(unit, date1, date2)",description:"Calculates time between two dates.",example:'time_elapsed("day", `posting_date`, today())'},case:{syntax:'case(condition1, "value1", ..., "default_value")',description:"Returns matched condition value or default.",example:'case(`amount` > 0, "Unpaid", `amount` < 0, "Return", "Paid")'},count:{syntax:"count(column_name)",description:"Counts rows based on column.",example:"count(`ID`)"},coalesce:{syntax:"coalesce(column1, column2, ...)",description:"Returns first non-null value from columns.",example:"coalesce(`first_name`, `last_name`)"},if_null:{syntax:'if_null(column_name, "default_value")',description:"Provides default if column is null.",example:'if_null(`category`, "No Category")'},distinct:{syntax:"distinct(column_name)",description:"Lists distinct values of the column.",example:"distinct(`customer`)"},distinct_count:{syntax:"distinct_count(column_name)",description:"Counts distinct values of the column.",example:"distinct_count(`customer`)"},count_if:{syntax:"count_if(condition)",description:"Counts rows that satisfy the condition.",example:"count_if(`amount` > 0)"},sum_if:{syntax:"sum_if(condition, column_name)",description:"Sums values of the column that satisfy the condition.",example:'sum_if(`customer` = "John", `grand_total`)'},descendants:{syntax:'descendants("value", "doctype", "fieldname")',description:"Lists all descendants of the given value.",example:'descendants("India", "tabTerritory", `territory`)'},descendants_and_self:{syntax:'descendants_and_self("value", "doctype", "fieldname")',description:"Lists all descendants and self of the given value.",example:'descendants_and_self("India", "tabTerritory", `territory`)'}},Yn={class:"mt-4 flex max-h-[30rem] flex-col space-y-1 divide-y overflow-y-scroll text-base"},Zn={class:"flex-1 space-y-1 py-2"},Xn={class:"font-mono text-lg font-medium"},es={class:"text-sm text-gray-600"},ts={class:"mt-2 flex-1 rounded bg-gray-50 p-2 text-sm leading-5"},os=l("span",{class:"text-gray-600"},"# Syntax",-1),ls=l("br",null,null,-1),ns=l("br",null,null,-1),ss=l("br",null,null,-1),as=l("span",{class:"text-gray-600"},"# Example",-1),rs=l("br",null,null,-1),is={key:0,class:"py-2 text-center text-gray-700"},ut={__name:"ExpressionHelpDialog",setup(a){const t=E(!1),n=E(""),o=Object.keys(K).map(e=>P({name:e},K[e])),s=V(()=>n.value?o.filter(e=>{var r;return e.name.toLowerCase().includes(n.value.toLowerCase())||((r=e.syntax)==null?void 0:r.toLowerCase().includes(n.value.toLowerCase()))}):o);return(e,r)=>{const x=T("Button"),c=T("Dialog");return i(),$(F,null,[p(x,{variant:"ghost",onClick:r[0]||(r[0]=m=>t.value=!0),icon:"help-circle"}),p(c,{options:{title:"Functions"},modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=m=>t.value=m),dismissable:!0},{"body-content":O(()=>[X(l("input",{"onUpdate:modelValue":r[1]||(r[1]=m=>n.value=m),placeholder:"Search functions",class:"form-input block w-full border-gray-400 placeholder-gray-500"},null,512),[[pe,n.value]]),l("div",Yn,[(i(!0),$(F,null,G(s.value,m=>(i(),$("div",{key:m.name,class:"flex"},[l("div",Zn,[l("p",Xn,Q(m.name),1),l("p",es,Q(m.description),1)]),l("div",ts,[l("code",null,[os,ls,M(" "+Q(m.syntax)+" ",1),ns,ss,as,rs,M(" "+Q(m.example),1)])])]))),128)),s.value.length?A("",!0):(i(),$("div",is," No functions found "))])]),_:1},8,["modelValue"])],64)}}},us={name:"Tooltip",props:{hoverDelay:{default:.5},placement:{default:"bottom"},text:{type:String,default:""}}},cs={class:"w-fit rounded border border-gray-100 bg-gray-800 px-2 py-1 text-center text-xs text-white shadow-xl"};function ds(a,t,n,o,s,e){const r=T("Popover");return i(),S(r,{trigger:"hover",hoverDelay:n.hoverDelay,placement:n.placement},{target:O(()=>[ge(a.$slots,"default")]),body:O(()=>[ge(a.$slots,"body",{},()=>[l("div",cs,Q(n.text),1)])]),_:3},8,["hoverDelay","placement"])}const ct=te(us,[["render",ds]]),ps={class:"ml-auto w-[20rem] rounded border bg-white p-2 shadow-lg"},ms={class:"mt-2 rounded bg-gray-50 p-2 text-xs leading-5"},fs=l("span",{class:"text-gray-600"},"# Syntax",-1),vs=l("br",null,null,-1),_s=l("br",null,null,-1),hs=l("br",null,null,-1),ys=l("span",{class:"text-gray-600"},"# Example",-1),xs=l("br",null,null,-1),Ae={__name:"ExpressionHelp",props:{info:Object},setup(a){return(t,n)=>{var o,s,e;return i(),$("div",ps,[l("p",null,Q((o=a.info)==null?void 0:o.description),1),l("div",ms,[l("code",null,[fs,vs,M(" "+Q((s=a.info)==null?void 0:s.syntax)+" ",1),_s,hs,ys,xs,M(" "+Q((e=a.info)==null?void 0:e.example),1)])])])}}},I={EOF:"EOF",NUMBER:"NUMBER",OPEN_PARENTHESIS:"OPEN_PARENTHESIS",CLOSE_PARENTHESIS:"CLOSE_PARENTHESIS",OPERATOR_ADD:"OPERATOR_ADD",OPERATOR_SUB:"OPERATOR_SUB",OPERATOR_MUL:"OPERATOR_MUL",OPERATOR_DIV:"OPERATOR_DIV",OPERATOR_GT:"OPERATOR_GT",OPERATOR_LT:"OPERATOR_LT",OPERATOR_EQ:"OPERATOR_EQ",OPERATOR_NEQ:"OPERATOR_NEQ",OPERATOR_GTE:"OPERATOR_GTE",OPERATOR_LTE:"OPERATOR_LTE",BACKTICK:"BACKTICK",COLUMN:"COLUMN",FUNCTION:"FUNCTION",ARGUMENT_SEPARATOR:"ARGUMENT_SEPARATOR",FUNCTION_ARGUMENTS:"FUNCTION_ARGUMENTS",STRING:"STRING",LOGICAL_AND:"LOGICAL_AND",LOGICAL_OR:"LOGICAL_OR"},qe="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$";function gs(a){return/^[()]$/.test(a)}function bs(a){return/^\s$/.test(a)}function De(a){return/^[0-9]$/.test(a)}function ws(a){return a==="`"}function $s(a){return a===","}function ks(a){return a==='"'||a==="'"}function Ge(a){return a==="+"||a==="-"||a==="*"||a==="/"||a===">"||a==="<"||a==="="||a==="!"}function Cs(a){switch(a){case"+":return I.OPERATOR_ADD;case"-":return I.OPERATOR_SUB;case"*":return I.OPERATOR_MUL;case"/":return I.OPERATOR_DIV;case">":return I.OPERATOR_GT;case"<":return I.OPERATOR_LT;case"=":return I.OPERATOR_EQ;case"!=":return I.OPERATOR_NEQ;case">=":return I.OPERATOR_GTE;case"<=":return I.OPERATOR_LTE;default:console.warn(`Unknown operator: ${a}`)}}function Re(a){return a==="&"||a==="|"}function dt(a,t=0){if(a=a==null?void 0:a.replace(/\t\f\r\n/g,""),!a)return[];let n=0,o=[],s=a[n],e=a[n+1];function r(){s=a[++n],e=a[n+1]}function x(){let u="";for(;Ge(s);)u+=s,r();o.push({type:Cs(u),value:u})}function c(){let u="";for(;De(s)||s=="."&&De(a[n+1]);)u+=s,r();o.push({type:I.NUMBER,value:u})}function m(){o.push({type:I.BACKTICK}),r();let u="";for(;s!="`"&&n<a.length;)u+=s,r();if(u.length){const d=t+n-u.length,[b,_]=u.split(".");o.push({type:I.COLUMN,start:d,end:t+n,value:{table:_?b:null,column:_||b}})}s==="`"&&(o.push({type:I.BACKTICK}),r())}function f(){let u="";for(;qe.includes(s)&&n<a.length;)u+=s,r();if(!u)return;const d={type:I.FUNCTION,start:t+n-u.length,end:t+n,value:u};let b=null;s==="("&&(b={type:I.OPEN_PARENTHESIS},r());let _=n,k=Vs(a,n-1),h=k!==-1?k:a.length,y=a.substring(_,h);if(!y){d.end=t+n,o.push(d),b&&o.push(b);return}let C=dt(y,t+_).filter(R=>R.type!==I.EOF);n=h-1,r();let U=null;s===")"&&(U={type:I.CLOSE_PARENTHESIS},r()),d.end=t+n,o.push(d),b&&o.push(b),o=o.concat(C),U&&o.push(U)}function g(){let u=s;r();let d="";for(;s!=u&&n<a.length;)d+=s,r();s==u&&(o.push({type:I.STRING,value:d}),r())}function w(){o.push({type:s=="&"?I.LOGICAL_AND:I.LOGICAL_OR,value:s+e}),r(),r()}for(;n<a.length;){if(bs(s)){r();continue}if(Ge(s)){x();continue}if(gs(s)){o.push({type:s=="("?I.OPEN_PARENTHESIS:I.CLOSE_PARENTHESIS}),r();continue}if($s(s)){o.push({type:I.ARGUMENT_SEPARATOR,value:s}),r();continue}if(De(s)){c();continue}if(ws(s)){m();continue}if(ks(s)){g();continue}if(Re(s)&&Re(s)==Re(e)){w();continue}if(qe.includes(s)){f();continue}console.warn(`Unexpected character: ${s} while parsing expression: ${a}`);break}return o.push({type:I.EOF}),o}function Vs(a,t){if(a[t]!=="(")return-1;let n=0;for(let o=t;o<a.length;o++)if(a[o]=="("&&n++,a[o]==")"&&n--,n==0)return o;return-1}const pt=5;function Ts(a){switch(a){case I.NUMBER:case I.STRING:case I.COLUMN:case I.FUNCTION:case I.OPEN_PARENTHESIS:case I.CLOSE_PARENTHESIS:case I.BACKTICK:return pt;case I.OPERATOR_MUL:case I.OPERATOR_DIV:return 4;case I.OPERATOR_ADD:case I.OPERATOR_SUB:return 3;case I.OPERATOR_GT:case I.OPERATOR_LT:case I.OPERATOR_EQ:case I.OPERATOR_NEQ:case I.OPERATOR_GTE:case I.OPERATOR_LTE:return 2;case I.LOGICAL_AND:return 1;case I.LOGICAL_OR:return 0;default:return 100}}function de(a){const t=dt(a);let n=0,o=t[n],s=null;function e(u){if(u<pt){let d=e(u+1);for(;Ts(o.type)==u&&o.type!==I.EOF;){const b=o.value;o=t[++n];const _=e(u+1);d={type:"BinaryExpression",operator:b,left:d,right:_}}return d}switch(o.type){case I.NUMBER:return r();case I.STRING:return x();case I.OPEN_PARENTHESIS:return c();case I.BACKTICK:return m();case I.FUNCTION:return f();case I.EOF:return{type:"EOF"};default:throw s=`Unexpected token: ${o.value}`,new Error(`Failed to Parse Expression ${a}: Unexpected token: ${o.type}`)}}function r(){const u=o.value;return o=t[++n],{type:"Number",value:parseFloat(u)}}function x(){const u=o.value;return o=t[++n],{type:"String",value:u}}function c(){if(o=t[++n],!g())throw s="Missing closing parenthesis for opening parenthesis",new Error(`Failed to Parse Expression ${a}: Missing closing parenthesis`);const u=e(0);return o=t[++n],u}function m(){if(o=t[++n],o.type!==I.COLUMN)throw s="Missing column name",new Error(`Failed to Parse Expression ${a}: Expected column reference, got: ${o.type}`);const u=o.value;if(!u.table||!u.column)throw s="Invalid column reference",new Error(`Failed to Parse Expression ${a}: Invalid column reference: ${u}`);if(o=t[++n],o.type!==I.BACKTICK)throw s="Missing closing backtick",new Error(`Failed to Parse Expression ${a}: Expected closing backtick, got: ${o.type}`);return o=t[++n],{type:"Column",value:u}}function f(){const u=o.value;if(o=t[++n],o.type!==I.OPEN_PARENTHESIS)throw s=`Expected opening parenthesis after ${u} function`,new Error(`Failed to Parse Expression ${a}: Expected opening parenthesis, got: ${o.type}`);if(o=t[++n],!g())throw s=`Missing closing parenthesis for ${u} function`,new Error(`Failed to Parse Expression ${a}: Missing closing parenthesis for ${u} function`);const d=[];for(;o.type!==I.CLOSE_PARENTHESIS&&o.type!==I.EOF;)d.push(e(0)),o.type===I.ARGUMENT_SEPARATOR&&(o=t[++n]);return o=t[++n],{type:"CallExpression",function:u,arguments:d}}function g(){let u=-1;for(let d=n;d<t.length;d++)if(t[d].type===I.CLOSE_PARENTHESIS){u=d;break}if(u!==-1)return!0}let w=null;try{w=e(0)}catch(u){console.groupCollapsed("Failed to Parse Expression"),console.error(u),console.groupEnd()}return{ast:w,errorMessage:s,tokens:t}}const As={class:"relative flex flex-col"},Os={class:"flex justify-between"},Ss=l("div",{class:"mb-1 text-sm"},"Expression",-1),Es={class:"!mt-1 flex cursor-pointer items-center text-xs text-red-500"},Ds={class:"relative h-full w-full rounded border p-1"},Rs={class:"absolute bottom-1 left-1"},Qs={class:"w-full pr-3 text-base"},Is={class:"mt-2 text-sm text-gray-700"},Us=l("div",{class:"mb-1"},"Label",-1),Bs={class:"mt-2 text-sm text-gray-700"},Ms=l("div",{class:"mb-1"},"Type",-1),Fs={key:0,class:"mt-2 text-sm text-gray-700"},Ps=l("div",{class:"mb-1"},"Date Format",-1),Ns={class:"mt-2 space-y-1 text-sm text-gray-700"},Ls=l("div",{class:""},"Sort",-1),js={class:"mt-4 text-sm text-gray-700"},qs={class:"sticky bottom-0 mt-3 flex justify-end space-x-2 bg-white pt-1"},mt={__name:"ColumnExpressionPicker",props:{column:{type:Object,default:{},validate:a=>{if(a.is_expression!=1)return"Column must be an expression"}}},emits:["close"],setup(a,{emit:t}){var b;const n=a,o=B("query"),s=Y(P({},n.column),{expression:n.column.expression||{}}),e=E(!!s.name),r=H({value:s.expression.raw||"",caretPosition:((b=s.expression.raw)==null?void 0:b.length)||0}),x=["String","Integer","Decimal","Text","Datetime","Date","Time"],c=H({raw:r.value,label:s.label,order_by:s.order_by,groupBy:s.aggregation=="Group By",valueType:s.type||"String",ast:null,error:null,tokens:[],help:null,dateFormat:["Date","Datetime"].includes(n.column.type)?we.find(_=>{var k;return _.value===((k=n.column.format_option)==null?void 0:k.date_format)}):{}});be(()=>{c.raw=r.value;const{ast:_,tokens:k,errorMessage:h}=de(r.value);c.ast=_,c.tokens=k,c.error=h});const m=V(()=>["Date","Datetime"].includes(c.valueType));be(()=>{(m.value||c.valueType!=="String")&&(c.groupBy=!1)});const f=re(function({cursorPos:_}){c.help=null;const{tokens:k}=c,h=k.filter(y=>y.start<=_-1&&y.end>=_&&y.type=="FUNCTION").at(-1);if(h){const{value:y}=h;K[y]&&(c.help=K[y])}},300),g=(_,k)=>{let h=_.matchBefore(/\w*/),y=k.resolveInner(_.pos,-1);if(y.name==="TemplateString")return{from:h.from,options:o.columns.options.map(C=>({label:`${C.table}.${C.column}`}))};if(y.name==="VariableName")return{from:h.from,options:Object.keys(K).map(C=>({label:C}))}},w=V(()=>!!(c.error||!c.raw||!c.label||!c.valueType)),u=()=>{const _={name:n.column.name,is_expression:1,expression:{raw:c.raw,ast:c.ast},type:c.valueType,label:c.label,order_by:c.order_by,column:c.label.replace(/\s/g,"_"),aggregation:c.groupBy?"Group By":""};m.value&&(_.format_option={date_format:c.dateFormat.value}),n.column.name?o.updateColumn.submit({column:_}):o.addColumn.submit({column:_}),t("close")},d=()=>{o.removeColumn.submit({column:n.column}),t("close")};return(_,k)=>{const h=T("FeatherIcon"),y=T("Popover"),C=T("Input"),U=T("Autocomplete"),R=T("Button");return i(),$("div",As,[l("div",Os,[Ss,c.error?(i(),S(ct,{key:0,text:c.error},{default:O(()=>[l("div",Es,[p(h,{name:"alert-circle",class:"h-4 w-4"})])]),_:1},8,["text"])):A("",!0)]),p(y,{class:"h-36 w-full text-sm",placement:"left-start"},{target:O(({open:D})=>[l("div",Ds,[p(ae,{modelValue:r.value,"onUpdate:modelValue":k[0]||(k[0]=W=>r.value=W),completions:g,onInputChange:D,onViewUpdate:v(f)},null,8,["modelValue","onInputChange","onViewUpdate"]),l("div",Rs,[p(ut)])])]),body:O(()=>[l("div",Qs,[p(Me,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform opacity-100","leave-to-class":"transform opacity-0"},{default:O(()=>[X(p(Ae,{info:c.help},null,8,["info"]),[[fe,c.help]])]),_:1})])]),_:1}),l("div",Is,[Us,p(C,{type:"text",modelValue:c.label,"onUpdate:modelValue":k[1]||(k[1]=D=>c.label=D),class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",Bs,[Ms,p(C,{type:"select",modelValue:c.valueType,"onUpdate:modelValue":k[2]||(k[2]=D=>c.valueType=D),class:"placeholder:text-sm",placeholder:"Select a type...",options:x},null,8,["modelValue"])]),m.value?(i(),$("div",Fs,[Ps,p(U,{modelValue:c.dateFormat,"onUpdate:modelValue":k[3]||(k[3]=D=>c.dateFormat=D),options:v(we),placeholder:"Select a date format..."},null,8,["modelValue","options"])])):A("",!0),l("div",Ns,[Ls,p(C,{type:"select",modelValue:c.order_by,"onUpdate:modelValue":k[4]||(k[4]=D=>c.order_by=D),options:[{label:"",value:""},{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],class:"placeholder:text-sm",placeholder:"Enter a label..."},null,8,["modelValue"])]),l("div",js,[c.valueType=="String"?(i(),S(C,{key:0,type:"checkbox",label:"Group By",modelValue:c.groupBy,"onUpdate:modelValue":k[5]||(k[5]=D=>c.groupBy=D)},null,8,["modelValue"])):A("",!0)]),l("div",qs,[e.value?(i(),S(R,{key:0,class:"text-red-500",variant:"outline",onClick:d},{default:O(()=>[M(" Remove ")]),_:1})):A("",!0),p(R,{variant:"solid",onClick:u,disabled:w.value},{default:O(()=>[M(Q(e.value?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},Gs={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},Hs=l("div",{class:"text-sm uppercase tracking-wide text-gray-700"},"Edit Column",-1),zs={class:"flex flex-1 flex-col overflow-y-scroll"},Ws={__name:"ColumnEditor",props:{column:{type:Object,default:{},required:!0}},emits:["close"],setup(a,{emit:t}){const n=a;return(o,s)=>{const e=T("Button");return i(),$(F,null,[l("div",Gs,[p(e,{icon:"chevron-left",class:"mr-2",onClick:s[0]||(s[0]=r=>o.$emit("close"))}),Hs]),l("div",zs,[n.column.is_expression?(i(),S(mt,{key:0,column:n.column,onClose:s[1]||(s[1]=r=>o.$emit("close"))},null,8,["column"])):(i(),S(it,{key:1,column:n.column,onClose:s[2]||(s[2]=r=>o.$emit("close"))},null,8,["column"]))])],64)}}},Js={name:"DragHandleIcon"},Ks={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ys=ze('<circle cx="12" cy="9" r="1"></circle><circle cx="19" cy="9" r="1"></circle><circle cx="5" cy="9" r="1"></circle><circle cx="12" cy="15" r="1"></circle><circle cx="19" cy="15" r="1"></circle><circle cx="5" cy="15" r="1"></circle>',6),Zs=[Ys];function Xs(a,t,n,o,s,e){return i(),$("svg",Ks,Zs)}const ea=te(Js,[["render",Xs]]),ta={key:0,class:"flex h-full w-full items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-500"},oa=l("p",null,"No columns selected",-1),la=[oa],na={key:1,class:"flex h-full w-full flex-col overflow-y-scroll"},sa=["onClick"],aa={class:"overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},ra={class:"ml-auto mr-1 overflow-hidden text-ellipsis whitespace-nowrap text-gray-700"},ia=["onClick"],ua={__name:"ColumnList",emits:["edit-column"],setup(a){const t=B("query"),n=E(v(t.columns.data));q(()=>t.columns.data,s=>{n.value=s});function o(s){s.oldIndex!=s.newIndex&&t.moveColumn.submit({from_index:s.oldIndex,to_index:s.newIndex})}return(s,e)=>{const r=T("FeatherIcon");return n.value.length==0?(i(),$("div",ta,la)):n.value.length>0?(i(),$("div",na,[p(v(nt),{class:"w-full",modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=x=>n.value=x),group:"columns","item-key":"name",handle:".handle",onSort:o},{item:O(({element:x})=>[l("div",{class:"flex h-10 w-full cursor-pointer items-center border-b text-sm last:border-0 hover:bg-gray-50",onClick:N(()=>{s.$emit("edit-column",x),s.newColumnType=x.aggregation=="Group By"?"Dimension":"Metric"},["prevent","stop"])},[p(ea,{class:"handle -ml-1 mr-1 h-4 w-4 rotate-90 cursor-grab self-center text-gray-500"}),l("span",aa,Q(x.label),1),l("span",ra,Q(x.is_expression?"Expression":v(Mt)(x.table_label,12)),1),l("div",{class:"flex items-center px-1 py-0.5 text-gray-700 hover:text-gray-700",onClick:N(c=>v(t).removeColumn.submit({column:x}),["prevent","stop"])},[p(r,{name:"x",class:"h-3 w-3"})],8,ia)],8,sa)]),_:1},8,["modelValue"])])):A("",!0)}}},ca={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},da=l("div",{class:"text-sm uppercase tracking-wide text-gray-700"},"Add Column",-1),pa={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},ma={class:"flex h-9 flex-shrink-0 cursor-pointer items-center space-x-2 rounded bg-gray-100 p-1 text-sm"},fa=["onClick"],va={__name:"ColumnPicker",emits:["close"],setup(a){const t=E("Simple");return(n,o)=>{const s=T("Button");return i(),$(F,null,[l("div",ca,[p(s,{icon:"chevron-left",class:"mr-2",onClick:o[0]||(o[0]=e=>n.$emit("close"))}),da]),l("div",pa,[l("div",ma,[(i(),$(F,null,G(["Simple","Expression"],e=>l("div",{class:Z(["flex h-full flex-1 items-center justify-center rounded",{" bg-white font-normal shadow":t.value==e}]),onClick:N(r=>t.value=e,["prevent","stop"])},Q(e),11,fa)),64))]),t.value=="Simple"?(i(),S(it,{key:0,onClose:o[1]||(o[1]=e=>n.$emit("close"))})):A("",!0),t.value=="Expression"?(i(),S(mt,{key:1,onClose:o[2]||(o[2]=e=>n.$emit("close"))})):A("",!0)])],64)}}},_a={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden text-gray-900"},ha={class:"flex w-full flex-shrink-0 items-center justify-between bg-white pb-2"},ya=l("div",{class:"text-sm tracking-wide text-gray-700"},"COLUMNS",-1),xa={class:"w-full flex-1 overflow-hidden"},ga={__name:"ColumnPanel",setup(a){const t=E(!1),n=E({}),o=E(!1);return(s,e)=>{const r=T("Button");return i(),$("div",_a,[!t.value&&!o.value?(i(),$(F,{key:0},[l("div",ha,[ya,p(r,{icon:"plus",onClick:e[0]||(e[0]=x=>t.value=!0)})]),l("div",xa,[p(ua,{onEditColumn:e[1]||(e[1]=x=>[n.value,o.value]=[x,!0])})])],64)):A("",!0),t.value?(i(),S(va,{key:1,onClose:e[2]||(e[2]=x=>t.value=!1)})):A("",!0),o.value?(i(),S(Ws,{key:2,onClose:e[3]||(e[3]=x=>o.value=!1),column:n.value},null,8,["column"])):A("",!0)])}}},ba={class:"inline-flex w-full flex-wrap"},wa={class:"whitespace-nowrap font-mono font-medium text-purple-700"},$a=l("div",{class:"font-mono text-purple-700"},"(",-1),ka={class:"flex items-center"},Ca={key:0},Va=l("div",{class:"font-mono text-purple-700"},")",-1),ft={__name:"CallExpression",props:{expression:{type:Object,required:!0}},setup(a){const t=a;return(n,o)=>(i(),$("div",ba,[l("div",wa,Q(t.expression.function),1),$a,(i(!0),$(F,null,G(t.expression.arguments,(s,e)=>(i(),$("div",ka,[p(Qe,{term:s},null,8,["term"]),e<t.expression.arguments.length-1?(i(),$("div",Ca,",Â ")):A("",!0)]))),256)),Va]))}},Ta={key:2,class:"w-fit"},Aa={key:3,class:"w-fit"},Oa={key:4,class:"w-fit"},Qe={__name:"ExpressionTerm",props:{term:{type:Object,required:!0}},setup(a){const t=a,n=t.term.type,o=t.term.value;return(s,e)=>{const r=T("Tooltip");return v(n)=="BinaryExpression"?(i(),S(vt,{key:0,expression:t.term},null,8,["expression"])):v(n)=="CallExpression"?(i(),S(ft,{key:1,expression:t.term},null,8,["expression"])):v(n)=="Column"?(i(),$("p",Ta,[p(r,{text:v(o).table},{default:O(()=>[l("span",null,Q(v(o).column),1)]),_:1},8,["text"])])):v(n)=="String"?(i(),$("p",Aa,Q(v(o)),1)):v(n)=="Number"?(i(),$("p",Oa,Q(v(o)),1)):A("",!0)}}},Sa={class:"inline-flex w-full flex-wrap items-baseline"},Ea=l("span",{class:"w-2"},null,-1),Da={class:"whitespace-nowrap text-sm font-medium text-green-600"},Ra=l("span",{class:"w-2"},null,-1),vt={__name:"BinaryExpression",props:{expression:{type:Object,required:!0}},setup(a){const t=a;return(n,o)=>(i(),$("div",Sa,[p(Qe,{term:t.expression.left},null,8,["term"]),Ea,l("p",Da,Q(t.expression.operator),1),Ra,p(Qe,{term:t.expression.right},null,8,["term"])]))}},Qa={__name:"Expression",props:{expression:{type:Object,required:!0,validate:a=>a.type==="BinaryExpression"||a.type==="CallExpression"}},emits:["edit","remove"],setup(a){var r,x;let n=H(v(a.expression));const o=c=>c.type=="String"||c.type=="Number",s=n.type=="BinaryExpression"&&n.left.type=="Column"&&o(n.right)||n.type=="CallExpression"&&n.arguments[0].type=="Column"&&n.arguments.slice(1).every(o),e=B("query");if(s){const c=e.filters.convertIntoSimpleFilter(n);c&&(n=H({type:"BinaryExpression",left:{type:"Column",value:{table:(r=c.column)==null?void 0:r.table_label,column:(x=c.column)==null?void 0:x.label}},operator:c.operator.label,right:{type:"String",value:c.value.label}}))}return(c,m)=>{const f=T("FeatherIcon");return i(),$("div",{class:"group relative flex w-full max-w-fit cursor-pointer items-center rounded border p-2 pr-6 hover:border-gray-300",onClick:m[1]||(m[1]=N(g=>c.$emit("edit"),["prevent","stop"]))},[v(n).type=="BinaryExpression"?(i(),S(vt,{key:0,expression:v(n)},null,8,["expression"])):v(n).type=="CallExpression"?(i(),S(ft,{key:1,expression:v(n)},null,8,["expression"])):A("",!0),p(f,{name:"x",class:"absolute right-1.5 h-3 w-3 self-center text-gray-600 hover:text-gray-700",onClick:m[0]||(m[0]=N(g=>c.$emit("remove"),["prevent","stop"]))})])}}},Ia={class:"relative flex w-full"},Ua={class:"z-[5] flex w-full items-center"},Ba={class:"flex flex-1 flex-col space-y-2"},Ma={class:"absolute top-0 left-0 z-0 h-full w-full"},Fa={width:"100%",height:"100%",class:"text-gray-400"},Pa={__name:"LogicalExpression",props:{expression:{type:Object,required:!0,validate:a=>a.type==="LogicalExpression"}},emits:["add-filter","edit-filter","remove-filter","toggle-operator"],setup(a){const t=a,n=V(()=>t.expression.level),o=V(()=>t.expression.position),s=V(()=>t.expression.operator),e=V(()=>t.expression.conditions);ve(()=>{q(()=>t.expression,()=>Be(()=>f()),{immediate:!0,deep:!0})});const r=E(null),x=E(null),c=E(null),m=E([]);function f(){var u;!c.value||!x.value||!r.value||!((u=m.value)!=null&&u.length)||(c.value.innerHTML="",m.value.forEach(d=>{g(r.value,d)}),g(r.value,x.value,!0))}function g(u,d,b=!1){let _=document.createElementNS("http://www.w3.org/2000/svg","path");const k={x:u.offsetLeft+u.offsetWidth/2,y:u.offsetTop+u.offsetHeight/2},h={x:d.offsetLeft,y:d.offsetTop+d.offsetHeight/2},y=w(k,h);_.setAttribute("d",y),_.setAttribute("stroke","currentColor"),b&&_.setAttribute("stroke-dasharray","3,3"),c.value.appendChild(_)}function w(u,d){if(Math.abs(u.y-d.y)<3)return`M${u.x},${u.y} L${d.x},${d.y}`;{let b="",_=0;return u.y>d.y?(b="a5,5 0 0 1 5,-5 ",_=5):(b="a5,5 1 0 0 5,5 ",_=-5),`M${u.x},${u.y} L${u.x},${d.y+_} ${b}L${d.x},${d.y}`}}return(u,d)=>{const b=T("LogicalExpression",!0);return i(),$("div",Ia,[l("div",Ua,[l("div",{ref_key:"operatorRef",ref:r,class:"z-[5] mr-2 flex h-6 w-6 flex-shrink-0 cursor-pointer items-center justify-center rounded-full border border-gray-300 bg-white hover:border-blue-300 hover:font-normal hover:text-blue-500",onClick:d[0]||(d[0]=N(_=>u.$emit("toggle-operator",{level:n.value,position:o.value}),["prevent","stop"]))},Q(s.value=="&&"?"&":"or"),513),l("div",Ba,[(i(!0),$(F,null,G(e.value,(_,k)=>(i(),$("div",{key:k,ref_for:!0,ref_key:"conditionRefs",ref:m},[_.type=="LogicalExpression"?(i(),S(b,{key:0,expression:_,onAddFilter:d[1]||(d[1]=h=>u.$emit("add-filter",h)),onEditFilter:d[2]||(d[2]=h=>u.$emit("edit-filter",h)),onRemoveFilter:d[3]||(d[3]=h=>u.$emit("remove-filter",h)),onToggleOperator:d[4]||(d[4]=h=>u.$emit("toggle-operator",h))},null,8,["expression"])):(i(),S(Qa,{key:1,expression:_,onEdit:h=>u.$emit("edit-filter",{condition:_,level:n.value,position:o.value,idx:k}),onRemove:h=>u.$emit("remove-filter",{level:n.value,position:o.value,idx:k})},null,8,["expression","onEdit","onRemove"]))]))),128)),l("div",{ref_key:"addConditionRef",ref:x,class:"!-mt-0.5 !-mb-2 flex h-9 cursor-pointer items-center text-sm text-gray-600 hover:text-gray-700",onClick:d[5]||(d[5]=N(_=>u.$emit("add-filter",{level:n.value,position:o.value}),["prevent","stop"]))}," + "+Q(s.value=="&&"?"and":"or")+" condition ",513)])]),l("div",Ma,[(i(),$("svg",Fa,[l("g",{ref_key:"connectorsRef",ref:c,fill:"none"},null,512)]))])])}}},Na={class:"flex flex-col"},La={class:"flex justify-between"},ja=l("div",{class:"mb-1 text-sm"},"Expression",-1),qa={class:"!mt-1 flex cursor-pointer items-center text-xs text-red-500"},Ga={class:"relative h-full w-full rounded border p-1"},Ha={class:"absolute bottom-1 left-1"},za={class:"w-full pr-3 text-base"},Wa={class:"mt-3 flex justify-end space-x-2"},Ja={__name:"FilterExpressionPicker",props:{filter:{type:Object,default:{}}},emits:["filter-select","close"],setup(a,{emit:t}){var f;const n=a,o=B("query"),s=V(()=>o.filters.editFilterAt.idx!==-1),e=E(((f=n.filter)==null?void 0:f.raw)||""),r=H({raw:e.value,ast:null,error:null,tokens:[],help:null});be(()=>{r.raw=e.value;const{ast:g,tokens:w,errorMessage:u}=de(r.raw);r.ast=g,r.tokens=w,r.error=u});const x=(g,w)=>{let u=g.matchBefore(/\w*/),d=w.resolveInner(g.pos,-1);if(d.name==="TemplateString")return{from:u.from,options:o.columns.options.map(b=>({label:`${b.table}.${b.column}`}))};if(d.name==="VariableName")return{from:u.from,options:Object.keys(K).map(b=>({label:b}))}},c=re(function({cursorPos:g}){r.help=null;const{tokens:w}=r,u=w.filter(d=>d.start<=g-1&&d.end>=g&&d.type=="FUNCTION").at(-1);if(u){const{value:d}=u;K[d]&&(r.help=K[d])}},300),m=()=>{t("filter-select",Y(P({},r.ast),{raw:r.raw,is_expression:!0}))};return(g,w)=>{const u=T("FeatherIcon"),d=T("Popover"),b=T("Button");return i(),$("div",Na,[l("div",La,[ja,r.error?(i(),S(ct,{key:0,text:r.error},{default:O(()=>[l("div",qa,[p(u,{name:"alert-circle",class:"h-4 w-4"})])]),_:1},8,["text"])):A("",!0)]),p(d,{class:"h-36 w-full text-sm",placement:"left-start"},{target:O(({open:_})=>[l("div",Ga,[p(ae,{modelValue:e.value,"onUpdate:modelValue":w[0]||(w[0]=k=>e.value=k),completions:x,onInputChange:_,onViewUpdate:v(c)},null,8,["modelValue","onInputChange","onViewUpdate"]),l("div",Ha,[p(ut)])])]),body:O(()=>[l("div",za,[p(Me,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:O(()=>[X(p(Ae,{info:r.help},null,8,["info"]),[[fe,r.help]])]),_:1})])]),_:1}),l("div",Wa,[p(b,{variant:"solid",onClick:m,disabled:!!r.error},{default:O(()=>[M(Q(s.value?"Update":"Add "),1)]),_:1},8,["disabled"])])])}}},Ka={name:"DateRangePicker",props:["value","placeholder","formatter","readonly","inputClass"],emits:["change"],data(){const a=this.value?this.value.split(",")[0]:"",t=this.value?this.value.split(",")[1]:"";return{currentYear:null,currentMonth:null,fromDate:a,toDate:t}},created(){this.selectCurrentMonthYear()},computed:{today(){return this.getDate()},datesAsWeeks(){let a=[],t=this.dates.slice();for(;t.length;){let n=t.splice(0,7);a.push(n)}return a},dates(){if(!(this.currentYear&&this.currentMonth))return[];let a=this.currentMonth-1,t=this.currentYear,n=this.getDate(t,a,1),o=this.getDate(t,a+1,0),s=n.getDay(),e=6-o.getDay(),r=this.getDatesAfter(n,-s),x=this.getDatesAfter(o,e),c=this.getDaysInMonth(a,t),m=this.getDatesAfter(n,c-1),f=[...r,n,...m,...x];if(f.length<42){const g=this.getDatesAfter(f.at(-1),42-f.length);f=f.concat(...g)}return f},formatMonth(){return this.getDate(this.currentYear,this.currentMonth-1,1).toLocaleString("en-US",{month:"short",year:"numeric"})}},methods:{handleDateClick(a){this.fromDate&&this.toDate?(this.fromDate=this.toValue(a),this.toDate=""):this.fromDate&&!this.toDate?this.toDate=this.toValue(a):this.fromDate=this.toValue(a),this.swapDatesIfNecessary()},selectDates(){if(!this.fromDate&&!this.toDate)return this.$emit("change","");this.$emit("change",`${this.fromDate},${this.toDate}`)},swapDatesIfNecessary(){if(!this.fromDate||!this.toDate)return;let a=this.getDate(this.fromDate),t=this.getDate(this.toDate);if(a>t){let n=a;a=t,t=n}this.fromDate=this.toValue(a),this.toDate=this.toValue(t)},selectCurrentMonthYear(){let a=this.toDate?this.getDate(this.toDate):this.today;this.currentYear=a.getFullYear(),this.currentMonth=a.getMonth()+1},prevMonth(){this.changeMonth(-1)},nextMonth(){this.changeMonth(1)},changeMonth(a){this.currentMonth=this.currentMonth+a,this.currentMonth<1&&(this.currentMonth=12,this.currentYear=this.currentYear-1),this.currentMonth>12&&(this.currentMonth=1,this.currentYear=this.currentYear+1)},getDatesAfter(a,t){let n=1;t<0&&(n=-1,t=Math.abs(t));let o=[];for(;t;)a=this.getDate(a.getFullYear(),a.getMonth(),a.getDate()+n),o.push(a),t--;return n===-1?o.reverse():o},getDaysInMonth(a,t){let o=[31,28,31,30,31,30,31,31,30,31,30,31][a];return a===1&&this.isLeapYear(t)?29:o},isLeapYear(a){return a%400===0?!0:a%100===0?!1:a%4===0},toValue(a){return a?typeof a=="string"?a:(a.setHours(0,-a.getTimezoneOffset(),0,0),a.toISOString().slice(0,10)):""},getDate(...a){return new Date(...a)},isInRange(a){return!this.fromDate||!this.toDate?!1:a>=this.getDate(this.fromDate)&&a<=this.getDate(this.toDate)},formatDates(a){if(!a)return"";const t=a.split(",");return this.formatter(t[0])+" to "+this.formatter(t[1])},clearDates(){this.fromDate="",this.toDate="",this.selectDates()}}},Ya=["placeholder","value","onFocus"],Za={class:"my-2 w-[16rem] select-none space-y-3 rounded border border-gray-50 bg-white p-3 text-base shadow"},Xa={class:"flex items-center text-gray-700"},er={class:"flex h-6 w-6 cursor-pointer items-center justify-center rounded hover:bg-gray-100"},tr={class:"flex-1 text-center text-lg font-medium text-blue-500"},or={class:"flex h-6 w-6 cursor-pointer items-center justify-center rounded hover:bg-gray-100"},lr={class:"flex space-x-2"},nr={class:"mt-2 flex flex-col items-center justify-center text-base"},sr={class:"flex w-full items-center justify-center space-x-1 text-gray-600"},ar={class:"flex w-full items-center"},rr=["onClick"],ir={class:"mt-1 flex w-full justify-end space-x-2"};function ur(a,t,n,o,s,e){const r=T("FeatherIcon"),x=T("Input"),c=T("Button"),m=T("Popover");return i(),S(m,{onOpen:e.selectCurrentMonthYear,class:"flex w-full [&>div:first-child]:w-full"},{target:O(({togglePopover:f})=>[l("input",{readonly:"",type:"text",placeholder:n.placeholder,value:n.formatter?e.formatDates(n.value):n.value,onFocus:g=>n.readonly?null:f(),class:Z(["form-input block h-7 w-full cursor-pointer select-none rounded border-gray-400 text-sm  placeholder-gray-500 ",n.inputClass])},null,42,Ya)]),body:O(({togglePopover:f})=>[l("div",Za,[l("div",Xa,[l("div",er,[p(r,{onClick:e.prevMonth,name:"chevron-left",class:"h-5 w-5"},null,8,["onClick"])]),l("div",tr,Q(e.formatMonth),1),l("div",or,[p(r,{onClick:e.nextMonth,name:"chevron-right",class:"h-5 w-5"},null,8,["onClick"])])]),l("div",lr,[p(x,{type:"text",modelValue:s.fromDate,"onUpdate:modelValue":t[0]||(t[0]=g=>s.fromDate=g)},null,8,["modelValue"]),p(x,{type:"text",modelValue:s.toDate,"onUpdate:modelValue":t[1]||(t[1]=g=>s.toDate=g)},null,8,["modelValue"])]),l("div",nr,[l("div",sr,[(i(),$(F,null,G(["S","M","T","W","T","F","S"],(g,w)=>l("div",{class:"flex h-[30px] w-[30px] items-center justify-center text-center",key:w},Q(g),1)),64))]),(i(!0),$(F,null,G(e.datesAsWeeks,(g,w)=>(i(),$("div",{key:w},[l("div",ar,[(i(!0),$(F,null,G(g,u=>(i(),$("div",{key:e.toValue(u),class:Z(["flex h-[30px] w-[30px] cursor-pointer items-center justify-center hover:bg-blue-50 hover:text-blue-500",{"text-gray-600":u.getMonth()!==s.currentMonth-1,"text-blue-500":e.toValue(u)===e.toValue(e.today),"bg-blue-50 text-blue-500":e.isInRange(u),"rounded-l-md bg-blue-100":s.fromDate&&e.toValue(u)===e.toValue(s.fromDate),"rounded-r-md bg-blue-100":s.toDate&&e.toValue(u)===e.toValue(s.toDate)}]),onClick:()=>e.handleDateClick(u)},Q(u.getDate()),11,rr))),128))])]))),128))]),l("div",ir,[p(c,{onClick:t[2]||(t[2]=()=>e.clearDates()),disabled:!n.value},{default:O(()=>[M(" Clear ")]),_:1},8,["disabled"]),p(c,{onClick:()=>e.selectDates()|f(),disabled:!s.fromDate||!s.toDate,variant:"solid"},{default:O(()=>[M(" Apply ")]),_:2},1032,["onClick","disabled"])])])]),_:1},8,["onOpen"])}const _t=te(Ka,[["render",ur]]),cr={name:"TimespanPicker",components:{Tabs:Ie},emits:["update:modelValue","change"],props:["value","modelValue","placeholder"],data(){var s;const a=(this.valuePropPassed()?this.value:(s=this.modelValue)==null?void 0:s.value)||"";let[t,n,o]=a.split(" ");return t=="Current"&&(o=n),(o==null?void 0:o.at(-1))=="s"&&(o=o.slice(0,-1)),{span:t||"Last",interval:n||"1",intervalType:o||"Day"}},computed:{_value(){return this.span==="Current"?`${this.span} ${this.intervalType}`:`${this.span} ${this.interval} ${this.intervalType}`}},watch:{interval(a){a<1&&(this.interval=1)}},methods:{valuePropPassed(){return this.value!==void 0},apply(){this.valuePropPassed()?this.$emit("change",this._value):this.$emit("update:modelValue",{value:this._value,label:this._value})}}},dr=["value","placeholder","onFocus"],pr={class:"my-2 flex w-[18rem] select-none flex-col space-y-3 rounded border bg-white p-3 text-base shadow-md"},mr={class:"flex space-x-2"},fr={class:"flex justify-end"};function vr(a,t,n,o,s,e){const r=T("Tabs"),x=T("Input"),c=T("Button"),m=T("Popover");return i(),S(m,{class:"flex w-full [&>div:first-child]:w-full"},{target:O(({togglePopover:f})=>[l("input",{readonly:"",type:"text",value:e._value,placeholder:n.placeholder,onFocus:g=>f(),class:"form-input block h-7 w-full cursor-text select-none rounded border-gray-400 text-sm placeholder-gray-500"},null,40,dr)]),body:O(({togglePopover:f})=>[l("div",pr,[p(r,{tabs:[{label:"Last",active:s.span=="Last"},{label:"Current",active:s.span=="Current"},{label:"Next",active:s.span=="Next"}],onSwitch:t[0]||(t[0]=g=>s.span=g.label)},null,8,["tabs"]),l("div",mr,[s.span!=="Current"?(i(),S(x,{key:0,type:"number",modelValue:s.interval,"onUpdate:modelValue":t[1]||(t[1]=g=>s.interval=g),class:"w-full text-sm"},null,8,["modelValue"])):A("",!0),p(x,{type:"select",modelValue:s.intervalType,"onUpdate:modelValue":t[2]||(t[2]=g=>s.intervalType=g),class:"w-full text-sm",options:["Day","Week","Month","Quarter","Year","Fiscal Year"]},null,8,["modelValue"])]),l("div",fr,[p(c,{variant:"solid",onClick:()=>{e.apply(),f()}},{default:O(()=>[M(" Done ")]),_:2},1032,["onClick"])])])]),_:1})}const ht=te(cr,[["render",vr]]),_r={class:"flex flex-col space-y-3"},hr={class:"space-y-1 text-sm text-gray-700"},yr=l("div",{class:""},"Column",-1),xr={class:"space-y-1 text-sm text-gray-700"},gr=l("div",{class:""},"Operator",-1),br={class:"space-y-1 text-sm text-gray-700"},wr=l("div",{class:""},"Value",-1),$r={class:"flex justify-end"},kr={__name:"SimpleFilterPicker",props:{filter:{type:Object,default:{column:{},operator:{},value:{}}}},emits:["filter-select"],setup(a,{emit:t}){const n=a,o=B("query"),s={column:{},operator:{},value:{}};let e=H(s);if(n.filter&&n.filter.type){const h=o.filters.convertIntoSimpleFilter(n.filter);e=H(h)}const r=o.columns.options,x=V(()=>{var h;return Ze((h=e.column)==null?void 0:h.type)}),c=V(()=>{var h,y;return["Date","Datetime"].includes((h=e.column)==null?void 0:h.type)&&["=","!=",">",">=","<","<=","between"].includes((y=e.operator)==null?void 0:y.value)}),m=V(()=>{var h,y;return["Date","Datetime"].includes((h=e.column)==null?void 0:h.type)&&((y=e.operator)==null?void 0:y.value)==="timespan"}),f=V(()=>{var h,y;return["in","not_in"].includes((h=e.operator)==null?void 0:h.value)&&((y=e.column)==null?void 0:y.type)=="String"}),g=V(()=>{var h,y;return["=","!=","is"].includes((h=e.operator)==null?void 0:h.value)&&((y=e.column)==null?void 0:y.type)=="String"}),w=V(()=>{var h,y;return((h=e.operator)==null?void 0:h.value)=="is"?[{label:"Set",value:"set"},{label:"Not Set",value:"not set"}]:(y=o.fetchColumnValues.data)==null?void 0:y.message}),u=V(()=>{var h,y,C;return c.value?"Select a date...":ne(e.operator)?"Type a value...":((h=e.operator)==null?void 0:h.value)=="between"?"Type two comma separated values...":((y=e.operator)==null?void 0:y.value)=="in"||((C=e.operator)==null?void 0:C.value)=="not_in"?"Select one or more values...":"Type a value..."}),d=V(()=>ne(e.column,e.operator,e.value));q(()=>e.column,h=>{e.column=h,e.operator={},e.value={}}),q(()=>e.operator,h=>{e.operator=h,e.value={}});function b(h){return Array.isArray(h)?{value:h.map(y=>y.hasOwnProperty("value")?y.value:y),label:h.length>1?h.length+" values":h.length>0?h[0].value||h[0]:""}:{value:[],label:""}}function _(){d.value||(f.value?e.value=b(e.value.value):c.value&&(e.value={value:e.value.value,label:ee(e.value.value)}),t("filter-select",o.filters.convertIntoExpression(e)),Object.assign(e,s))}const k=re(function(h=""){var y,C;ne(e.column)||!["=","!=","in","not_in"].includes((y=e.operator)==null?void 0:y.value)||((C=e.column)==null?void 0:C.type)=="String"&&o.fetchColumnValues.submit({column:e.column,search_text:h})},300);return q(()=>{var h;return{shouldFetch:f.value||g.value,columnChanged:(h=e.column)==null?void 0:h.value}},({shouldFetch:h,columnChanged:y})=>{var U,R;const C=(U=o.fetchColumnValues.data)==null?void 0:U.message;y&&(C!=null&&C.length)&&(o.fetchColumnValues.data.message=[]),h&&y&&!((R=w.value)!=null&&R.length)&&k()},{immediate:!0}),(h,y)=>{const C=T("Autocomplete"),U=T("Input"),R=T("Button");return i(),$("div",_r,[l("div",hr,[yr,p(C,{modelValue:v(e).column,"onUpdate:modelValue":y[0]||(y[0]=D=>v(e).column=D),options:v(r),placeholder:"Select a column..."},null,8,["modelValue","options"])]),l("div",xr,[gr,p(C,{modelValue:v(e).operator,"onUpdate:modelValue":y[1]||(y[1]=D=>v(e).operator=D),options:x.value,placeholder:"Select operator..."},null,8,["modelValue","options"])]),l("div",br,[wr,g.value?(i(),S(C,{key:0,modelValue:v(e).value,"onUpdate:modelValue":y[2]||(y[2]=D=>v(e).value=D),options:w.value,placeholder:u.value,"onUpdate:query":v(k),loading:v(o).fetchColumnValues.loading},null,8,["modelValue","options","placeholder","onUpdate:query","loading"])):m.value?(i(),S(ht,{key:1,id:"value",modelValue:v(e).value,"onUpdate:modelValue":y[3]||(y[3]=D=>v(e).value=D),placeholder:u.value},null,8,["modelValue","placeholder"])):f.value?(i(),S(Xt,{key:2,value:v(e).value.value,onChange:y[4]||(y[4]=D=>{v(e).value.value||(v(e).value={value:null,label:null}),v(e).value.value=D}),options:w.value,placeholder:u.value,onInputChange:v(k),loading:v(o).fetchColumnValues.loading},null,8,["value","options","placeholder","onInputChange","loading"])):c.value&&v(e).operator.value==="between"?(i(),S(_t,{key:3,id:"value",value:v(e).value.value,placeholder:u.value,formatter:v(ee),onChange:y[5]||(y[5]=D=>{v(e).value={value:D,label:v(ee)(D)}})},null,8,["value","placeholder","formatter"])):c.value?(i(),S(tt,{key:4,id:"value",value:v(e).value.value,placeholder:u.value,formatter:v(ee),onChange:y[6]||(y[6]=D=>{v(e).value={value:D,label:v(ee)(D)}})},null,8,["value","placeholder","formatter"])):(i(),S(U,{key:5,type:"text",modelValue:v(e).value.value,"onUpdate:modelValue":y[7]||(y[7]=D=>v(e).value.value=D),placeholder:u.value},null,8,["modelValue","placeholder"]))]),l("div",$r,[p(R,{onClick:_,variant:"solid",disabled:d.value},{default:O(()=>[M(" Apply ")]),_:1},8,["disabled"])])])}}},Cr={class:"flex w-full flex-shrink-0 items-center bg-white pb-2"},Vr={class:"text-sm tracking-wide text-gray-700"},Tr={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},Ar={class:"flex h-9 flex-shrink-0 items-center space-x-2 rounded bg-gray-100 p-1 text-sm"},Or={__name:"FilterPicker",props:["filter"],emits:["filter-select","close"],setup(a){var s;const t=a,n=E(!!t.filter),o=E((s=t.filter)!=null&&s.is_expression?"expression":"simple");return(e,r)=>{const x=T("Button");return i(),$(F,null,[l("div",Cr,[p(x,{icon:"chevron-left",class:"mr-2",onClick:r[0]||(r[0]=c=>e.$emit("close"))}),l("div",Vr,Q(n.value?"EDIT":"ADD")+" FILTER",1)]),l("div",Tr,[l("div",Ar,[l("div",{class:Z(["flex h-full flex-1 items-center justify-center rounded",{"bg-white font-normal shadow":o.value=="simple"}]),onClick:r[1]||(r[1]=N(c=>o.value="simple",["prevent","stop"]))}," Simple ",2),l("div",{class:Z(["flex h-full flex-1 items-center justify-center rounded",{" bg-white font-normal shadow":o.value=="expression"}]),onClick:r[2]||(r[2]=N(c=>o.value="expression",["prevent","stop"]))}," Expression ",2)]),o.value=="simple"?(i(),S(kr,{key:0,filter:t.filter,onFilterSelect:r[3]||(r[3]=c=>e.$emit("filter-select",c))},null,8,["filter"])):A("",!0),o.value=="expression"?(i(),S(Ja,{key:1,filter:t.filter,onFilterSelect:r[4]||(r[4]=c=>e.$emit("filter-select",c))},null,8,["filter"])):A("",!0)])],64)}}},Sr={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden"},Er={key:0,class:"flex w-full flex-shrink-0 items-center justify-between bg-white pb-2"},Dr=l("div",{class:"text-sm tracking-wide text-gray-700"},"FILTERS",-1),Rr={key:1,class:"flex h-full w-full items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-600"},Qr=l("p",null,"No filters added",-1),Ir=[Qr],Ur={key:2,class:"h-full w-full overflow-scroll"},Br={__name:"FilterPanel",setup(a){const t=E(!1),n=B("query"),o=V(()=>n.filters.data||{}),s=E(null),e=({condition:m,level:f,position:g,idx:w})=>{t.value=!0,m?(s.value=m,n.filters.editFilterAt.level=f,n.filters.editFilterAt.position=g,n.filters.editFilterAt.idx=w):(s.value=null,n.filters.addNextFilterAt.level=f,n.filters.addNextFilterAt.position=g)};function r(m){s.value?n.filters.edit(m):n.filters.add(m),s.value=null,t.value=!1}function x({level:m,position:f,idx:g}){n.filters.remove(m,f,g)}function c({level:m,position:f}){n.filters.toggleOperator(m,f)}return(m,f)=>{var w;const g=T("Button");return i(),$("div",Sr,[t.value?A("",!0):(i(),$("div",Er,[Dr,p(g,{icon:"plus",onClick:f[0]||(f[0]=u=>t.value=!0)})])),!t.value&&(!o.value.conditions||o.value.conditions.length==0)?(i(),$("div",Rr,Ir)):!t.value&&((w=o.value.conditions)==null?void 0:w.length)>0?(i(),$("div",Ur,[(i(),S(Pa,{key:JSON.stringify(o.value),expression:o.value,onAddFilter:e,onEditFilter:e,onRemoveFilter:x,onToggleOperator:c},null,8,["expression"]))])):t.value?(i(),S(Or,{key:3,onClose:f[1]||(f[1]=u=>t.value=!1),onFilterSelect:r,filter:s.value},null,8,["filter"])):A("",!0)])}}},Mr={class:"flex h-full flex-1 items-center justify-between rounded-b-md px-1 text-base text-gray-600"},Fr={key:0,class:"flex items-center space-x-1 text-gray-900"},Pr=l("span",{class:"text-gray-600"},"Showing",-1),Nr={class:"font-mono"},Lr=l("span",{class:"text-gray-600"},"out of",-1),jr={class:"font-mono"},qr=l("span",{class:"text-gray-600"},"rows in",-1),Gr={class:"font-mono"},Hr=l("span",{class:"text-gray-600"},"seconds",-1),zr={class:"ml-auto space-x-1"},Wr=l("span",null,"Limit to",-1),Jr=["size"],Kr=l("span",null,"rows",-1),Yr={__name:"LimitsAndOrder",setup(a){const t=B("query"),n=V(()=>t.doc.execution_time),o=V(()=>t.doc.results_row_count),s=V(()=>Math.min(t.MAX_ROWS,o.value)),e=E(t.doc.limit);return V(()=>t.doc.columns.filter(r=>r.order_by).map(r=>({column:r.label,order:r.order_by}))),(r,x)=>(i(),$("div",Mr,[o.value>=0?(i(),$("div",Fr,[Pr,l("span",Nr,Q(s.value),1),Lr,l("span",jr,Q(o.value),1),qr,l("span",Gr,Q(n.value),1),Hr])):A("",!0),l("div",zr,[Wr,X(l("input",{type:"text",ref:"limitInput","onUpdate:modelValue":x[0]||(x[0]=c=>e.value=c),size:String(e.value).length,class:"form-input border-gray-400 pr-1 placeholder-gray-500",onKeydown:[x[1]||(x[1]=xe(N(()=>{v(t).setLimit.submit({limit:parseInt(e.value)}),r.$refs.limitInput.blur()},["stop"]),["enter"])),x[2]||(x[2]=xe(N(c=>r.$refs.limitInput.blur(),["stop"]),["esc"]))]},null,40,Jr),[[pe,e.value,void 0,{number:!0}]]),Kr])]))}},Zr={},Xr={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"},ei=l("path",{strokeWidth:"1",fill:"currentColor",d:"M6.667 15.833Q4.229 15.833 2.531 14.135Q0.833 12.438 0.833 10Q0.833 7.562 2.531 5.865Q4.229 4.167 6.667 4.167Q7.188 4.167 7.594 4.25Q8 4.333 8.333 4.5Q7.333 5.292 6.771 6.75Q6.208 8.208 6.208 10Q6.208 11.792 6.771 13.25Q7.333 14.708 8.333 15.5Q8 15.667 7.594 15.75Q7.188 15.833 6.667 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM13.333 15.833Q12.875 15.833 12.448 15.76Q12.021 15.688 11.604 15.562Q11.958 15.292 12.292 14.865Q12.625 14.438 12.854 14.042Q12.979 14.062 13.094 14.073Q13.208 14.083 13.333 14.083Q15.021 14.083 16.219 12.885Q17.417 11.688 17.417 10Q17.417 8.312 16.219 7.115Q15.021 5.917 13.333 5.917Q13.208 5.917 13.094 5.927Q12.979 5.938 12.854 5.958Q12.625 5.562 12.292 5.135Q11.958 4.708 11.604 4.438Q12.021 4.312 12.448 4.24Q12.875 4.167 13.333 4.167Q15.75 4.167 17.458 5.875Q19.167 7.583 19.167 10Q19.167 12.417 17.458 14.125Q15.75 15.833 13.333 15.833Z"},null,-1),ti=[ei];function oi(a,t){return i(),$("svg",Xr,ti)}const yt=te(Zr,[["render",oi]]),li={},ni={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"},si=l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.812 15.833 12.406 15.75Q12 15.667 11.667 15.5Q12.667 14.708 13.229 13.25Q13.792 11.792 13.792 10Q13.792 8.208 13.229 6.75Q12.667 5.292 11.667 4.5Q12 4.333 12.406 4.25Q12.812 4.167 13.333 4.167Q15.771 4.167 17.469 5.865Q19.167 7.562 19.167 10Q19.167 12.438 17.469 14.135Q15.771 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.25 15.833 2.542 14.125Q0.833 12.417 0.833 10Q0.833 7.583 2.542 5.875Q4.25 4.167 6.667 4.167Q7.125 4.167 7.552 4.24Q7.979 4.312 8.396 4.438Q8.042 4.708 7.708 5.135Q7.375 5.562 7.146 5.958Q7.021 5.938 6.906 5.927Q6.792 5.917 6.667 5.917Q4.979 5.917 3.781 7.115Q2.583 8.312 2.583 10Q2.583 11.688 3.781 12.885Q4.979 14.083 6.667 14.083Q6.792 14.083 6.906 14.073Q7.021 14.062 7.146 14.042Q7.375 14.438 7.708 14.865Q8.042 15.292 8.396 15.562Q7.979 15.688 7.552 15.76Q7.125 15.833 6.667 15.833Z"},null,-1),ai=[si];function ri(a,t){return i(),$("svg",ni,ai)}const xt=te(li,[["render",ri]]),ii={},ui={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"},ci=l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.875 15.833 12.448 15.76Q12.021 15.688 11.604 15.562Q11.958 15.292 12.292 14.865Q12.625 14.438 12.854 14.042Q12.979 14.062 13.094 14.073Q13.208 14.083 13.333 14.083Q15.021 14.083 16.219 12.885Q17.417 11.688 17.417 10Q17.417 8.312 16.219 7.115Q15.021 5.917 13.333 5.917Q13.208 5.917 13.094 5.927Q12.979 5.938 12.854 5.958Q12.625 5.562 12.292 5.135Q11.958 4.708 11.604 4.438Q12.021 4.312 12.448 4.24Q12.875 4.167 13.333 4.167Q15.75 4.167 17.458 5.875Q19.167 7.583 19.167 10Q19.167 12.417 17.458 14.125Q15.75 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.25 15.833 2.542 14.125Q0.833 12.417 0.833 10Q0.833 7.583 2.542 5.875Q4.25 4.167 6.667 4.167Q7.125 4.167 7.552 4.24Q7.979 4.312 8.396 4.438Q8.042 4.708 7.708 5.135Q7.375 5.562 7.146 5.958Q7.021 5.938 6.906 5.927Q6.792 5.917 6.667 5.917Q4.979 5.917 3.781 7.115Q2.583 8.312 2.583 10Q2.583 11.688 3.781 12.885Q4.979 14.083 6.667 14.083Q6.792 14.083 6.906 14.073Q7.021 14.062 7.146 14.042Q7.375 14.438 7.708 14.865Q8.042 15.292 8.396 15.562Q7.979 15.688 7.552 15.76Q7.125 15.833 6.667 15.833Z"},null,-1),di=[ci];function pi(a,t){return i(),$("svg",ui,di)}const gt=te(ii,[["render",pi]]),mi={},fi={xmlns:"http://www.w3.org/2000/svg",height:"20",width:"20"},vi=l("path",{strokeWidth:"1",fill:"currentColor",d:"M13.333 15.833Q12.812 15.833 12.406 15.75Q12 15.667 11.667 15.5Q12.667 14.708 13.229 13.25Q13.792 11.792 13.792 10Q13.792 8.208 13.229 6.75Q12.667 5.292 11.667 4.5Q12 4.333 12.406 4.25Q12.812 4.167 13.333 4.167Q15.771 4.167 17.469 5.865Q19.167 7.562 19.167 10Q19.167 12.438 17.469 14.135Q15.771 15.833 13.333 15.833ZM10 14.792Q8.958 14.792 8.25 13.406Q7.542 12.021 7.542 10Q7.542 7.979 8.25 6.594Q8.958 5.208 10 5.208Q11.042 5.208 11.75 6.594Q12.458 7.979 12.458 10Q12.458 12.021 11.75 13.406Q11.042 14.792 10 14.792ZM6.667 15.833Q4.229 15.833 2.531 14.135Q0.833 12.438 0.833 10Q0.833 7.562 2.531 5.865Q4.229 4.167 6.667 4.167Q7.188 4.167 7.594 4.25Q8 4.333 8.333 4.5Q7.333 5.292 6.771 6.75Q6.208 8.208 6.208 10Q6.208 11.792 6.771 13.25Q7.333 14.708 8.333 15.5Q8 15.667 7.594 15.75Q7.188 15.833 6.667 15.833Z"},null,-1),_i=[vi];function hi(a,t){return i(),$("svg",fi,_i)}const bt=te(mi,[["render",hi]]),yi={class:"relative"},xi=["onClick"],He={__name:"LinkIcon",props:{link:{type:String,required:!0}},setup(a){const t=a;function n(){window.open(t.link,"_blank")}return(o,s)=>{const e=T("FeatherIcon");return i(),$("div",yi,[ge(o.$slots,"default"),t.link?(i(),$("div",{key:0,class:"absolute top-0 right-0 flex h-full w-8 cursor-pointer items-center justify-center",onClick:N(n,["prevent","stop"])},[p(e,{name:"link-2",class:"h-4 w-4 text-gray-600 hover:text-gray-800"})],8,xi)):A("",!0)])}}},gi={class:"flex w-full flex-col overflow-hidden"},bi={class:"flex flex-shrink-0 items-center bg-white pb-3 pt-1"},wi=l("div",{class:"text-sm tracking-wide text-gray-700"},"JOIN",-1),$i={class:"flex flex-1 flex-col space-y-3 overflow-y-scroll"},ki={class:"flex flex-col space-y-3"},Ci={class:"space-y-1 text-sm"},Vi=l("div",{class:"text-gray-700"},"Left Table",-1),Ti={class:"space-y-1 text-sm"},Ai=l("div",{class:"text-gray-700"},"Join Type",-1),Oi={class:"space-y-1 text-sm"},Si=l("div",{class:"text-gray-700"},"Right Table",-1),Ei={class:"text-sm"},Di={class:"flex items-end space-x-1"},Ri={class:"flex-1"},Qi=l("div",{class:"mb-1 text-gray-700"},"Left Column",-1),Ii=l("span",{class:"flex items-center px-1 text-lg"}," = ",-1),Ui={class:"flex-1"},Bi=l("div",{class:"mb-1 text-gray-700"},"Right Column",-1),Mi={class:"flex justify-end space-x-2"},Fi={__name:"TableJoiner",props:{table:{type:Object,required:!0}},emits:["close"],setup(a,{emit:t}){const n=a,o=B("query"),s=E({type:{label:"Left",value:"left"},with:{},condition:{left:{},right:{}}}),e=E(P({},n.table));e.value.join&&(s.value=e.value.join);const r=E([{label:"Inner Join",value:"inner"},{label:"Left Join",value:"left"},{label:"Full Outer Join",value:"full"}]);q(()=>s.value.with,d=>d&&m());const x=E([]),c=E([]);function m(){const d=e.value.table,b=s.value.with.value;!d||!b||o.fetchJoinOptions.submit({left_table:d,right_table:b}).then(({message:_})=>{f(_),_.saved_links.length&&g(_.saved_links[0])})}function f({left_columns:d,right_columns:b}){x.value=d.map(_=>({label:_.label,value:_.column})),c.value=b.map(_=>({label:_.label,value:_.column}))}function g({left:d,right:b}){s.value.condition={left:x.value.find(_=>_.value===d),right:c.value.find(_=>_.value===b)}}function w(){e.value.join=s.value,o.updateTable.submit({table:e.value}),t("close")}function u(){e.value.join="",o.updateTable.submit({table:e.value}),t("close")}return(d,b)=>{var y,C;const _=T("Button"),k=T("Input"),h=T("Autocomplete");return i(),$("div",gi,[l("div",bi,[p(_,{icon:"chevron-left",class:"mr-2",onClick:b[0]||(b[0]=U=>d.$emit("close"))}),wi]),l("div",$i,[l("div",ki,[l("div",Ci,[Vi,p(He,{link:v(Ne)(e.value.table),show:e.value.label},{default:O(()=>[p(k,{modelValue:e.value.label,"onUpdate:modelValue":b[1]||(b[1]=U=>e.value.label=U),disabled:"",class:"cursor-not-allowed"},null,8,["modelValue"])]),_:1},8,["link","show"])]),l("div",Ti,[Ai,p(h,{modelValue:s.value.type,"onUpdate:modelValue":b[2]||(b[2]=U=>s.value.type=U),options:r.value,placeholder:"Select a type..."},null,8,["modelValue","options"])]),l("div",Oi,[Si,p(He,{link:v(Ne)((y=s.value.with)==null?void 0:y.value),show:(C=s.value.with)==null?void 0:C.label},{default:O(()=>[p(h,{modelValue:s.value.with,"onUpdate:modelValue":b[3]||(b[3]=U=>s.value.with=U),options:v(o).tables.joinOptions,placeholder:"Select a table..."},null,8,["modelValue","options"])]),_:1},8,["link","show"])]),l("div",Ei,[l("div",Di,[l("div",Ri,[Qi,(i(),S(h,{key:s.value.condition.left,modelValue:s.value.condition.left,"onUpdate:modelValue":b[4]||(b[4]=U=>s.value.condition.left=U),options:x.value,placeholder:"Select a Column"},null,8,["modelValue","options"]))]),Ii,l("div",Ui,[Bi,(i(),S(h,{key:s.value.condition.right,modelValue:s.value.condition.right,"onUpdate:modelValue":b[5]||(b[5]=U=>s.value.condition.right=U),options:c.value,placeholder:"Select a Column"},null,8,["modelValue","options"]))])])])]),l("div",Mi,[p(_,{disabled:!e.value.join,onClick:u},{default:O(()=>[M(" Clear ")]),_:1},8,["disabled"]),p(_,{variant:"solid",disabled:!s.value.with||!s.value.condition||!s.value.type,onClick:w},{default:O(()=>[M(" Apply ")]),_:1},8,["disabled"])])])])}}},Pi={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden text-gray-900"},Ni={key:0,class:"flex flex-shrink-0 items-center justify-between bg-white pb-2"},Li=l("div",{class:"text-sm tracking-wide text-gray-700"},"TABLES",-1),ji={key:1,class:"flex w-full flex-shrink-0 space-x-2 pb-3 pt-1"},qi={class:"flex-1"},Gi={key:2,class:"flex flex-1 items-center justify-center rounded border-2 border-dashed border-gray-200 text-sm text-gray-700"},Hi=l("p",null,"No tables selected",-1),zi=[Hi],Wi={key:3,class:"flex w-full flex-1 select-none flex-col divide-y overflow-y-scroll"},Ji=["onClick"],Ki={class:"overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},Yi={key:0,class:"ml-2 text-gray-700"},Zi={key:1,class:"ml-2 overflow-hidden text-ellipsis whitespace-nowrap text-base font-medium"},Xi={class:"ml-auto mr-1 overflow-hidden text-ellipsis whitespace-nowrap text-gray-700"},eu=["onClick"],tu={__name:"TablePanel",setup(a){const t=B("query"),n=E({}),o=E(null),s=E(!1),e=E(null);q(s,m=>{n.value={},m&&t.fetchTables.submit().then(()=>{e.value.input.el.focus()})});const r=B("$notify");function x(m){s.value=!1,m!=null&&m.value&&t.addTable.submit({table:{table:m.value,label:m.label}})}function c(m){const f=t.tables.validateRemoveTable(m);if(f)return r(f);t.removeTable.submit({table:m})}return(m,f)=>{var d;const g=T("Button"),w=T("Autocomplete"),u=T("FeatherIcon");return i(),$("div",Pi,[o.value?(i(),S(Fi,{key:1,table:o.value,onClose:f[3]||(f[3]=b=>o.value=null)},null,8,["table"])):(i(),$(F,{key:0},[s.value?A("",!0):(i(),$("div",Ni,[Li,p(g,{icon:"plus",onClick:f[0]||(f[0]=b=>s.value=!0)})])),s.value?(i(),$("div",ji,[l("div",qi,[p(w,{ref_key:"tableSearch",ref:e,modelValue:n.value,"onUpdate:modelValue":[f[1]||(f[1]=b=>n.value=b),x],options:v(t).tables.newTableOptions,placeholder:"Select a table..."},null,8,["modelValue","options"])]),p(g,{icon:"x",onClick:f[2]||(f[2]=b=>s.value=!1)})])):A("",!0),((d=v(t).tables.data)==null?void 0:d.length)==0?(i(),$("div",Gi,zi)):(i(),$("div",Wi,[(i(!0),$(F,null,G(v(t).tables.data,(b,_)=>(i(),$("div",{key:_,class:"flex h-10 w-full cursor-pointer items-center border-b text-sm last:border-0 hover:bg-gray-50",onClick:N(k=>o.value=b,["prevent","stop"])},[p(u,{name:"layout",class:"mr-2 h-[14px] w-[14px]"}),l("span",Ki,Q(b.label),1),b.join?(i(),$("span",Yi,[b.join.type.value=="left"?(i(),S(yt,{key:0})):A("",!0),b.join.type.value=="right"?(i(),S(xt,{key:1})):A("",!0),b.join.type.value=="inner"?(i(),S(gt,{key:2})):A("",!0),b.join.type.value=="full"?(i(),S(bt,{key:3})):A("",!0)])):A("",!0),b.join?(i(),$("span",Zi,Q(b.join.with.label),1)):A("",!0),l("span",Xi,Q(v(t).doc.data_source),1),l("div",{class:"flex items-center px-1 py-0.5 text-gray-700 hover:text-gray-700",onClick:N(k=>c(b),["prevent","stop"])},[p(u,{name:"x",class:"h-3 w-3"})],8,eu)],8,Ji))),128))]))],64))])}}},ou={key:0,class:"flex h-full w-full flex-col"},lu={class:"flex flex-1 flex-shrink-0 gap-4 overflow-y-scroll"},nu={class:"flex w-full flex-1 flex-shrink-0 overflow-hidden rounded py-4"},su={__name:"ClassicQueryBuilder",setup(a){const t=B("query"),n=V(()=>{var o,s;return{title:(o=t.doc)==null?void 0:o.title,subtitle:(s=t.doc)==null?void 0:s.name}});return Ft(n),(o,s)=>{var e;return(e=v(t).doc)!=null&&e.name?(i(),$("div",ou,[l("div",lu,[p(tu),p(ga),p(Br)]),l("div",nu,[p(Ve,null,{footer:O(()=>[p(Yr)]),_:1})])])):A("",!0)}}};function au({handle:a,target:t,direction:n,limits:o,inverse:s,disabled:e,start:r,stop:x,onResize:c}){const m=E(!1),f=E(0),g=E(0),w=H({startWidth:0,startHeight:0,newWidth:0,newHeight:0}),u=V(()=>v(e)),d=v(t);function b(h){u.value||(r&&r(),m.value=!0,f.value=h.clientX,g.value=h.clientY,w.startWidth=parseInt(document.defaultView.getComputedStyle(d).width,10),w.startHeight=parseInt(document.defaultView.getComputedStyle(d).height,10),document.addEventListener("mousemove",_),document.addEventListener("mouseup",k))}function _(h){if(m.value){const y=h.clientX-f.value,C=h.clientY-g.value;(!n||n=="x")&&(w.newWidth=s?w.startWidth-y:w.startWidth+y,o&&(w.newWidth<o.minWidth?w.newWidth=o.minWidth:w.newWidth>o.maxWidth&&(w.newWidth=o.maxWidth)),d.style.width=w.newWidth+"px"),(!n||n=="y")&&(w.newHeight=s?w.startHeight-C:w.startHeight+C,o&&(w.newHeight<o.minHeight?w.newHeight=o.minHeight:w.newHeight>o.maxHeight&&(w.newHeight=o.maxHeight)),d.style.height=`${w.newHeight}px`)}}function k(){m.value=!1,document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",k),x&&x(),c&&c(w.newWidth,w.newHeight)}v(a).addEventListener("mousedown",b)}const he={table:"",column:"",label:"",type:"",alias:"",order:"",granularity:"",aggregation:"",format:{},expression:{}},wt={column:P({},he),operator:{},value:{},expression:{}},$t={join_type:{label:"Inner Join",value:"inner"},left_table:{},left_column:{},right_table:{},right_column:{}},ru={type:"",options:{}},iu=(a,t)=>({variant:"warning",title:"Unable to find a relationship",message:`Please add a relationship between ${a} and ${t} manually`}),uu=()=>({variant:"error",title:"Cannot add self as table",message:"Please select a different table"}),cu=()=>({variant:"error",title:"Unable to reset main table",message:"Please remove all columns and joins before resetting the main table"});function du(a){const t=se.DATE.includes(a.type),n=se.NUMBER.includes(a.type);return Y(P(P({},he),a),{granularity:a.granularity||(t?"Month":""),aggregation:a.aggregation||(n?"sum":"")})}function pu(a){return J(this,null,function*(){const t=[],n=a.data_source,o=a.table;if(!o.table)return t;const e=[...a.columns.filter(r=>r.table&&r.column),...a.filters.map(r=>r.column).filter(r=>r.table&&r.column)].reduce((r,x)=>(r[x.table]=x,r),{});for(const r of Object.values(e)){if(r.table==o.table)continue;const x=yield ke(o.table,r.table,n);if(x){t.push($e(x));continue}for(const c of Object.keys(e)){if(c===r.table||c===o.table)continue;const m=yield ke(c,r.table,n);if(m){t.push($e(m));break}}}return t})}function $e(a){return Y(P({},$t),{left_table:{table:a.primary_table,label:a.primary_table_label},left_column:{table:a.primary_table,column:a.primary_column},right_table:{table:a.foreign_table,label:a.foreign_table_label},right_column:{table:a.foreign_table,column:a.foreign_column}})}const ye={};function ke(a,t,n){return J(this,null,function*(){const o=`${n}-${a}-${t}`;return ye[o]||(ye[o]=yield Je("insights.api.data_sources.get_relation",{data_source:n,table_one:a,table_two:t})),ye[o]})}function mu(a,t){return J(this,null,function*(){const n=t.table,o=t.data_source;if(!n.table)return null;const s=yield ke(n.table,a.table,o);if(s)return $e(s);for(const e of t.joins){const r=yield ke(e.right_table.table,a.table,o);if(r)return $e(r)}return null})}function fu(a,t){return a.table.table===t.table?!0:a.joins.some(o=>o.right_table.table===t.table)}function vu(a){return(a.measures.length||a.dimensions.length)&&(a.measures.forEach(t=>{a.columns.find(n=>n.label===t.label)||a.columns.push(t)}),a.dimensions.forEach(t=>{a.columns.find(n=>n.label===t.label)||a.columns.push(t)})),a.orders.length&&a.columns.forEach(t=>{const n=a.orders.find(o=>o.label===t.label);n&&(t.order=n.order)}),a.filters.length,a.limit||(a.limit=100),P({},a)}function _u(a){const t=H({data_source:V(()=>a.doc.data_source),table:{},joins:[],columns:[],filters:[],calculations:[],dimensions:[],measures:[],orders:[],limit:100,transforms:V(()=>[...a.doc.transforms]),joinAssistEnabled:!0,columnOptions:[],groupedColumnOptions:[],addTable:o,resetMainTable:s,removeJoinAt:e,updateJoinAt:r,addColumns:x,removeColumnAt:c,updateColumnAt:m,moveColumn:f,addFilter:g,removeFilterAt:w,updateFilterAt:u,setOrderBy:d,addTransform:b,removeTransformAt:_,updateTransformAt:k,fetchColumnOptions:re(n,500)});ve(()=>{const y=vu(a.doc.json);t.table=y.table,t.joins=y.joins,t.columns=y.columns,t.filters=y.filters,t.calculations=y.calculations,t.dimensions=y.dimensions,t.measures=y.measures,t.orders=y.orders,t.limit=y.limit}),Ye(()=>({table:t.table,joins:t.joins,columns:t.columns,filters:t.filters,calculations:t.calculations,dimensions:t.dimensions,measures:t.measures,orders:t.orders,limit:t.limit}),(y,C)=>{const U=yu(y,C);a.updateQuery(y).then(({query_updated:R})=>{R&&U&&n()})},{deep:!0,debounce:500});function n(y=""){return J(this,null,function*(){if(!t.data_source)return;const C=y.toLowerCase(),U=yield Pt("fetch_related_tables_columns",a.doc,{search_txt:C});t.columnOptions=U.message.map(Xe),t.groupedColumnOptions=hu(U.message)})}function o(y){return J(this,null,function*(){if(!(y!=null&&y.table))return;if(y.table===a.doc.name)return Ee(uu());const C=t.table;if(!(C!=null&&C.table)){t.table={table:y.table,label:y.label};return}if(fu(t,y))return;const U=yield mu(y,t);if(U)return t.joins.push(U);Ee(iu(C.label,y.label)),t.joins.push(Y(P({},$t),{left_table:{table:C.table,label:C.label},right_table:{table:y.table,label:y.label}}))})}function s(){if(t.joins.length||t.columns.length){Ee(cu());return}t.table={}}function e(y){t.joins.splice(y,1)}function r(y,C){t.joins.splice(y,1,C)}function x(y){const C=y.map(du);t.columns.push(...C),t.joinAssistEnabled&&h()}function c(y){t.columns.splice(y,1)}function m(y,C){t.columns.splice(y,1,C),t.joinAssistEnabled&&h()}function f(y,C){t.columns.splice(C,0,t.columns.splice(y,1)[0])}function g(){t.filters.push(P({},wt))}function w(y){t.filters.splice(y,1)}function u(y,C){t.filters.splice(y,1,C),t.joinAssistEnabled&&h()}function d(y,C){t.columns.some(U=>{if(U.label===y)return U.order=C,!0})}function b(){t.transforms.push({type:"",options:{}}),a.updateTransforms(t.transforms)}function _(y){t.transforms.splice(y,1),a.updateTransforms(t.transforms)}function k(y,C){t.transforms.splice(y,1,C),a.updateTransforms(t.transforms)}function h(){return J(this,null,function*(){const C=(yield pu(t)).filter(U=>!t.joins.some(R=>R.left_table.table===U.left_table.table&&R.right_table.table===U.right_table.table));t.joins.push(...C)})}return t}function hu(a){const t=a.reduce((n,o)=>(n[o.table_label]||(n[o.table_label]=[]),n[o.table_label].push(o),n),{});return Object.entries(t).map(([n,o])=>o.length?(o.splice(0,0,Y(P({},he),{table:o[0].table,column:"count",type:"Integer",label:`${n} Count`,alias:`${n} Count`,aggregation:"count"})),{group:n,items:o.map(Xe)}):{group:n,items:[]})}function yu(a,t){if(!t)return!0;const n=Ce(a),o=Ce(t);return!Nt(n,o)}function Ce(a){return a?[a.table.table,...a.joins.map(n=>n.right_table.table)].filter(n=>n):[]}const xu={class:"exp-editor space-y-3 text-base"},gu=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Expression",-1),bu={class:"w-[10rem] text-sm transition-all"},wu={__name:"ColumnExpressionEditor",props:{column:Object},emits:["update:column"],setup(a,{emit:t}){const n=a;B("query");const o=B("assistedQuery"),s=V({get:()=>n.column,set:b=>t("update:column",b)}),e=E(!1),r=V(()=>{const b=Ce(o);return o.columnOptions.filter(_=>b.includes(_.table)).map(_=>({label:`${_.table}.${_.column}`}))}),x=(b,_)=>{let k=b.matchBefore(/\w*/),h=_.resolveInner(b.pos,-1);if(h.name==="TemplateString")return{from:k.from,options:r.value};if(h.name==="VariableName")return{from:k.from,options:Object.keys(K).map(y=>({label:y}))}},c=E(null),m=E(null),f=re(function({cursorPos:b}){var h;if(!((h=s.value.expression)!=null&&h.raw))return;u(),m.value=null;const k=de(s.value.expression.raw).tokens.filter(y=>y.start<=b-1&&y.end>=b&&y.type=="FUNCTION").at(-1);if(k){const{value:y}=k;K[y]&&(m.value=K[y])}},300),g=E(0),w=new ResizeObserver(()=>{g.value+=1});ve(()=>{c.value&&w.observe(c.value)});function u(){const b=document.querySelector(".cm-tooltip-autocomplete");if(!b)return;const _=document.querySelector(".cm-cursor.cm-cursor-primary"),k=Number(_.style.left.replace("px","")),h=Number(_.style.top.replace("px",""));b.setAttribute("style",`left: ${k}px !important; top: ${h+20}px !important;`)}const d=[{label:"String",value:"String"},{label:"Integer",value:"Integer"},{label:"Decimal",value:"Decimal"},{label:"Text",value:"Text"},{label:"Datetime",value:"Datetime"},{label:"Date",value:"Date"},{label:"Time",value:"Time"}];return(b,_)=>{const k=T("FormControl");return i(),$(F,null,[l("div",xu,[l("div",null,[gu,l("div",{ref_key:"codeEditor",ref:c,class:"form-input min-h-[7rem] border border-gray-400 p-0"},[p(ae,{modelValue:s.value.expression.raw,completions:x,autofocus:!1,placeholder:"Write an expression",onFocus:_[0]||(_[0]=h=>e.value=!0),onBlur:_[1]||(_[1]=h=>e.value=!1),onViewUpdate:v(f),"onUpdate:modelValue":_[2]||(_[2]=h=>s.value.expression={raw:h,ast:v(de)(h).ast})},null,8,["modelValue","onViewUpdate"])],512)]),p(k,{type:"text",label:"Label",class:"w-full",modelValue:s.value.label,"onUpdate:modelValue":_[3]||(_[3]=h=>s.value.label=h),placeholder:"Label"},null,8,["modelValue"]),p(k,{label:"Type",type:"select",class:"w-full",modelValue:s.value.type,"onUpdate:modelValue":_[4]||(_[4]=h=>s.value.type=h),options:d},null,8,["modelValue"])]),c.value?(i(),S(_e,{show:e.value&&!!m.value,targetElement:c.value,placement:"right-start",key:g.value},{default:O(()=>{var h;return[l("div",bu,[X(p(Ae,{info:m.value},null,8,["info"]),[[fe,(h=m.value)==null?void 0:h.syntax]])])]}),_:1},8,["show","targetElement"])):A("",!0)],64)}}},$u={class:"flex flex-col gap-4 p-4"},ku={class:"flex h-8 w-full cursor-pointer select-none items-center rounded bg-gray-100 p-1"},Cu=["onClick"],Vu={class:"space-y-1"},Tu=l("span",{class:"text-sm font-medium text-gray-700"},"Aggregation",-1),Au={class:"space-y-1"},Ou=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1),Su={class:"space-y-1"},Eu=l("span",{class:"text-sm font-medium text-gray-700"},"Label",-1),Du={key:2,class:"space-y-1"},Ru=l("span",{class:"text-sm font-medium text-gray-700"},"Date Format",-1),Qu={class:"flex justify-between"},Iu={class:"flex gap-2"},Uu={__name:"ColumnEditor",props:{column:Object},emits:["save","discard","remove"],setup(a,{emit:t}){var c;const n=a,o=B("assistedQuery");B("query");const s=E("Simple"),e=H(P(P({},he),n.column));e.table&&e.column&&!e.value&&(e.value=`${e.table}.${e.column}`),(c=e.expression)!=null&&c.ast?s.value="Expression":e.aggregation||(e.aggregation="group by");function r(m){const f=P({},m);e.table=f.table,e.table_label=f.table_label,e.column=f.column,e.label=f.label,e.alias=f.label,e.type=f.type,e.value=f.value}const x=V(()=>{var m,f;return!e.label||!e.type?!1:!!((m=e.expression)!=null&&m.raw&&((f=e.expression)!=null&&f.ast)||e.table&&e.column)});return(m,f)=>{const g=T("Autocomplete"),w=T("FormControl"),u=T("Button");return i(),$("div",$u,[l("div",ku,[(i(),$(F,null,G(["Simple","Expression"],(d,b)=>l("div",{class:Z(["flex h-full flex-1 items-center justify-center px-4 text-sm transition-all",s.value===d?"rounded bg-white shadow":""]),onClick:N(_=>s.value=d,["prevent","stop"])},Q(d),11,Cu)),64))]),s.value=="Expression"?(i(),S(wu,{key:0,column:e,"onUpdate:column":f[0]||(f[0]=d=>e=d)},null,8,["column"])):A("",!0),s.value=="Simple"?(i(),$(F,{key:1},[l("div",Vu,[Tu,p(g,{modelValue:e.aggregation,placeholder:"Aggregation",options:v(Lt),"onUpdate:modelValue":f[1]||(f[1]=d=>e.aggregation=d.value)},null,8,["modelValue","options"])]),l("div",Au,[Ou,p(g,{modelValue:e,bodyClasses:"w-[18rem]",placeholder:"Column","onUpdate:modelValue":r,options:v(o).groupedColumnOptions,"onUpdate:query":v(o).fetchColumnOptions},null,8,["modelValue","options","onUpdate:query"])]),l("div",Su,[Eu,p(w,{type:"text",class:"w-full",modelValue:e.label,"onUpdate:modelValue":[f[2]||(f[2]=d=>e.label=d),f[3]||(f[3]=d=>e.alias=d)],placeholder:"Label"},null,8,["modelValue"])])],64)):A("",!0),v(se).DATE.includes(e.type)?(i(),$("div",Du,[Ru,p(g,{modelValue:e.granularity,placeholder:"Date Format",options:v(jt),"onUpdate:modelValue":f[4]||(f[4]=d=>e.granularity=d.value)},null,8,["modelValue","options"])])):A("",!0),l("div",Qu,[p(u,{variant:"outline",onClick:f[5]||(f[5]=d=>t("discard"))},{default:O(()=>[M(" Discard ")]),_:1}),l("div",Iu,[p(u,{variant:"outline",theme:"red",onClick:f[6]||(f[6]=d=>t("remove"))},{default:O(()=>[M("Remove")]),_:1}),p(u,{variant:"solid",disabled:!x.value,onClick:f[7]||(f[7]=d=>t("save",e))},{default:O(()=>[M(" Save ")]),_:1},8,["disabled"])])])])}}},Bu={class:"flex w-full items-center overflow-hidden"},Mu={key:0,class:"flex w-full items-center space-x-1.5 truncate"},Fu={class:"rounded border border-violet-400 py-0.5 px-1 font-mono text-xs tracking-wider text-violet-700"},Pu={key:1,class:"text-gray-600"},Nu={class:"flex items-center space-x-2"},Lu={__name:"ColumnListItem",props:["column","isActive"],emits:["edit-column","remove-column"],setup(a){function t(s){var r;const e=(r=s.expression)==null?void 0:r.raw;return s.label&&s.type&&(e||s.table&&s.column)}const n={min:"MIN",max:"MAX",sum:"SUM",avg:"AVG",count:"CNT",distinct:"UDST",distinct_count:"DCNT","group by":"UNQ","cumulative count":"CCNT","cumulative sum":"CSUM"};function o(s){var e;return(e=s.expression)!=null&&e.raw?"EXPR":n[s.aggregation]||"UNQ"}return(s,e)=>(i(),$("div",{class:Z(["group flex h-8 flex-1 cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow",a.isActive?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:e[1]||(e[1]=N(r=>s.$emit("edit-column",a.column),["prevent","stop"]))},[l("div",Bu,[t(a.column)?(i(),$("div",Mu,[l("div",Fu,Q(o(a.column)),1),l("div",null,Q(a.column.label),1)])):(i(),$("div",Pu,"Select a column"))]),l("div",Nu,[p(v(Te),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:e[0]||(e[0]=N(r=>s.$emit("remove-column",a.column),["prevent","stop"]))})])],2))}},ju={class:"mb-2 flex items-center justify-between"},qu={class:"flex items-center space-x-1.5"},Gu=l("p",{class:"font-medium"},"Summarize",-1),Hu={class:"mb-2 flex items-center gap-1"},zu={class:"flex-1"},Wu={key:0,class:"ml-2 w-[20rem] rounded-lg border border-gray-100 bg-white text-base shadow-xl"},Ju={__name:"ColumnSection",setup(a){B("query");const t=B("assistedQuery");!t.columnOptions.length&&t.fetchColumnOptions();const n=V(()=>t.columns);E(null);const o=E(null);function s(m){!m||n.value.find(g=>g.table===m.table&&g.column===m.column&&g.label===m.label)||t.addColumns([m])}function e(){t.removeColumnAt(o.value),o.value=null}function r(m){t.updateColumnAt(o.value,m),o.value=null}function x(){t.addColumns([Y(P({},he),{expression:{raw:"",ast:{}}})]),Be(()=>{o.value=n.value.length-1})}function c(m){m.oldIndex!=m.newIndex&&t.moveColumn(m.oldIndex,m.newIndex)}return(m,f)=>{const g=T("Button"),w=T("Autocomplete"),u=T("Popover");return i(),$("div",null,[l("div",ju,[l("div",qu,[p(v(ro),{class:"h-4 w-4 text-gray-600"}),Gu]),p(w,{modelValue:n.value,bodyClasses:"w-[18rem]","onUpdate:modelValue":s,options:v(t).groupedColumnOptions,"onUpdate:query":v(t).fetchColumnOptions},{target:O(({togglePopover:d})=>[p(g,{variant:"outline",icon:"plus",onClick:d},null,8,["onClick"])]),footer:O(({togglePopover:d})=>[p(g,{class:"w-full",variant:"ghost",iconLeft:"plus",onClick:b=>x()||d()},{default:O(()=>[M(" Custom Expression ")]),_:2},1032,["onClick"])]),_:1},8,["modelValue","options","onUpdate:query"])]),p(v(nt),{class:"w-full","model-value":n.value,group:"columns","item-key":"label",handle:".handle",onSort:c},{item:O(({element:d,index:b})=>[l("div",Hu,[p(v(po),{class:"handle h-4 w-4 flex-shrink-0 cursor-grab text-gray-500"}),l("div",zu,[p(u,{show:o.value===b,onClose:f[1]||(f[1]=_=>o.value=null),placement:"right-start"},{target:O(({togglePopover:_})=>[p(Lu,{column:d,isActive:o.value===b,onEditColumn:k=>o.value=b,onRemoveColumn:k=>v(t).removeColumnAt(b)},null,8,["column","isActive","onEditColumn","onRemoveColumn"])]),body:O(()=>[o.value===b?(i(),$("div",Wu,[p(Uu,{column:d,onDiscard:f[0]||(f[0]=_=>o.value=null),onRemove:e,onSave:r},null,8,["column"])])):A("",!0)]),_:2},1032,["show"])])])]),_:1},8,["model-value"])])}}};const Ku={class:"exp-editor space-y-3 text-base"},Yu=l("span",{class:"mb-2 block text-sm leading-4 text-gray-700"},"Expression",-1),Zu={class:"w-[10rem] text-sm transition-all"},Xu={__name:"FilterExpressionEditor",props:{filter:Object},emits:["update:filter"],setup(a,{emit:t}){const n=a;B("query");const o=B("assistedQuery"),s=V({get:()=>n.filter,set:d=>t("update:filter",{expression:{raw:d.expression.raw,ast:d.expression.ast}})}),e=E(!1),r=V(()=>{const d=Ce(o);return o.columnOptions.filter(b=>d.includes(b.table)).map(b=>({label:`${b.table}.${b.column}`}))}),x=(d,b)=>{let _=d.matchBefore(/\w*/),k=b.resolveInner(d.pos,-1);if(k.name==="TemplateString")return{from:_.from,options:r.value};if(k.name==="VariableName")return{from:_.from,options:Object.keys(K).map(h=>({label:h}))}},c=E(null),m=E(null),f=re(function({cursorPos:d}){var k;if(!((k=s.value.expression)!=null&&k.raw))return;u(),m.value=null;const _=de(s.value.expression.raw).tokens.filter(h=>h.start<=d-1&&h.end>=d&&h.type=="FUNCTION").at(-1);if(_){const{value:h}=_;K[h]&&(m.value=K[h])}},300),g=E(0),w=new ResizeObserver(()=>{g.value+=1});ve(()=>{c.value&&w.observe(c.value)});function u(){const d=document.querySelector(".cm-tooltip-autocomplete");if(!d)return;const b=document.querySelector(".cm-cursor.cm-cursor-primary"),_=Number(b.style.left.replace("px","")),k=Number(b.style.top.replace("px",""));d.setAttribute("style",`left: ${_}px !important; top: ${k+20}px !important;`)}return(d,b)=>(i(),$(F,null,[l("div",Ku,[l("div",null,[Yu,l("div",{ref_key:"codeEditor",ref:c,class:"form-input min-h-[7rem] border border-gray-400 p-0"},[p(ae,{modelValue:s.value.expression.raw,completions:x,autofocus:!1,placeholder:"Write an expression",onFocus:b[0]||(b[0]=_=>e.value=!0),onBlur:b[1]||(b[1]=_=>e.value=!1),onViewUpdate:v(f),"onUpdate:modelValue":b[2]||(b[2]=_=>s.value.expression={raw:_,ast:v(de)(_).ast})},null,8,["modelValue","onViewUpdate"])],512)])]),c.value?(i(),S(_e,{show:e.value&&!!m.value,targetElement:c.value,placement:"right-start",key:g.value},{default:O(()=>{var _;return[l("div",Zu,[X(p(Ae,{info:m.value},null,8,["info"]),[[fe,(_=m.value)==null?void 0:_.syntax]])])]}),_:1},8,["show","targetElement"])):A("",!0)],64))}},ec={__name:"FilterValueSelector",props:{selectorType:{type:String,required:!0},filter:{type:Object,required:!0}},emits:["update:filter"],setup(a,{emit:t}){const n=a,o=B("assistedQuery"),s=V({get:()=>n.filter,set:w=>t("update:filter",w)});function e(w){s.value.value={value:w,label:w.split(",").map(u=>ee(u)).join(" to ")}}function r(w){s.value.value={value:w,label:ee(w)}}const x=V(()=>{var w;return["in","not_in"].includes((w=s.value.operator)==null?void 0:w.value)}),c=E([]),m=E(!1),f=re(function(w=""){return J(this,null,function*(){var d;const u=s.value;if(!(!u.column||!u.operator)&&["=","!=","in","not_in"].includes(u.operator.value)&&!(!u.column.table||!u.column.column||!o.data_source)&&((d=u.column)==null?void 0:d.type)=="String"&&o.data_source){const b="insights.api.data_sources.fetch_column_values";m.value=!0;const _=yield Je(b,{data_source:o.data_source,table:u.column.table,column:u.column.column,search_text:w});c.value=_.map(k=>({label:k,value:k})),Array.isArray(u.value.value)&&u.value.value.forEach(k=>{c.value.find(h=>h.value===k.value)||c.value.unshift(k)}),m.value=!1}})},300);q(()=>s.value.column,()=>f(),{deep:!0}),et(()=>n.selectorType=="combobox",()=>f(),{immediate:!0});function g(w){s.value.value=x.value?{label:`${w.length} values`,value:w}:w}return(w,u)=>{const d=T("Autocomplete");return i(),$(F,null,[a.selectorType==="combobox"?(i(),S(d,{key:0,placeholder:"Value",multiple:x.value,modelValue:s.value.value.value,options:c.value,"onUpdate:query":v(f),"onUpdate:modelValue":g},null,8,["multiple","modelValue","options","onUpdate:query"])):A("",!0),a.selectorType==="timespanpicker"?(i(),S(ht,{key:1,modelValue:s.value.value,"onUpdate:modelValue":u[0]||(u[0]=b=>s.value.value=b),placeholder:"Value"},null,8,["modelValue"])):A("",!0),a.selectorType==="datepickerrange"?(i(),S(_t,{key:2,value:s.value.value.value,formatter:v(ee),onChange:u[1]||(u[1]=b=>e(b))},null,8,["value","formatter"])):A("",!0),a.selectorType==="datepicker"?(i(),S(tt,{key:3,value:s.value.value.value,formatter:v(ee),onChange:u[2]||(u[2]=b=>r(b))},null,8,["value","formatter"])):A("",!0),a.selectorType==="text"?(i(),S(v(Dt),{key:4,type:"text",autocomplete:"off",placeholder:"Value",modelValue:s.value.value.value,"onUpdate:modelValue":u[3]||(u[3]=b=>s.value.value.value=b)},null,8,["modelValue"])):A("",!0)],64)}}},tc={class:"flex flex-col gap-4 p-4"},oc={class:"flex h-8 w-full cursor-pointer select-none items-center rounded bg-gray-100 p-1"},lc=["onClick"],nc={class:"space-y-1"},sc=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1),ac={key:2,class:"text-xs text-orange-500"},rc=l("i",null,"column expression",-1),ic={class:"space-y-1"},uc=l("span",{class:"text-sm font-medium text-gray-700"},"Operator",-1),cc={key:0,class:"space-y-1"},dc=l("span",{class:"text-sm font-medium text-gray-700"}," Value ",-1),pc={class:"flex justify-between"},mc={class:"flex gap-2"},fc={__name:"FilterEditor",props:{filter:Object},emits:["save","discard","remove"],setup(a,{emit:t}){var k,h,y,C,U;const n=a,o=B("assistedQuery");B("query");const s=E("Simple"),e=H(P(P({},wt),n.filter));(k=e.expression)!=null&&k.raw&&(s.value="Expression"),e.column&&e.column.column&&e.column.table&&!e.column.value&&(e.column.value=`${e.column.table}.${e.column.column}`),((h=e.operator)==null?void 0:h.value)=="is"&&((C=(y=e.value)==null?void 0:y.value)!=null&&C.toLowerCase().includes("set"))&&(e.operator.value=e.value.value==="Set"?"is_set":"is_not_set");const r=V(()=>o.groupedColumnOptions.map(R=>({group:R.group,items:R.items.filter(D=>D.column!=="count")}))),x=V(()=>{var R,D,W,ie,oe,L,j,Oe;return!!((R=e.expression)!=null&&R.raw&&((D=e.expression)!=null&&D.ast)||(W=e.column)!=null&&W.value&&((ie=e.operator)!=null&&ie.value)&&((oe=e.value)!=null&&oe.value)||(j=(L=e.operator)==null?void 0:L.value)!=null&&j.includes("is_")&&((Oe=e.column)!=null&&Oe.column))}),c=V(()=>{var D;return Ze((D=e.column)==null?void 0:D.type).filter(W=>W.value!=="is").concat([{label:"is set",value:"is_set"},{label:"is not set",value:"is_not_set"}])});(U=e.operator)!=null&&U.value||(e.operator=c.value[0]),q(()=>e.operator.value,(R,D)=>{R!==D&&(e.value={})});const m=V(()=>{var R;return(R=e.operator)==null?void 0:R.value}),f=V(()=>{var R,D;return(D=(R=e.column)==null?void 0:R.expression)==null?void 0:D.raw}),g=V(()=>{var R;return((R=e.column)==null?void 0:R.type)==="String"}),w=V(()=>{var R;return se.DATE.includes((R=e.column)==null?void 0:R.type)}),u=V(()=>["=","!=","in","not_in"].includes(m.value)),d=V(()=>["is_set","is_not_set"].includes(m.value)),b=V(()=>d.value?"none":w.value&&m.value==="between"?"datepickerrange":w.value&&m.value==="timespan"?"timespanpicker":w.value?"datepicker":!f.value&&g.value&&u.value?"combobox":"text");function _(R){var D,W;return R?((D=R.expression)==null?void 0:D.raw)&&((W=R.expression)==null?void 0:W.ast):!1}return(R,D)=>{var L;const W=T("Autocomplete"),ie=T("FormControl"),oe=T("Button");return i(),$("div",tc,[l("div",oc,[(i(),$(F,null,G(["Simple","Expression"],(j,Oe)=>l("div",{class:Z(["flex h-full flex-1 items-center justify-center px-4 text-sm transition-all",s.value===j?"rounded bg-white shadow":""]),onClick:N(tp=>s.value=j,["prevent","stop"])},Q(j),11,lc)),64))]),s.value=="Expression"?(i(),S(Xu,{key:0,filter:e,"onUpdate:filter":D[0]||(D[0]=j=>e=j)},null,8,["filter"])):A("",!0),s.value=="Simple"?(i(),$(F,{key:1},[l("div",nc,[sc,_(e.column)?(i(),S(ie,{key:1,type:"textarea",class:"w-full",modelValue:(L=e.column)==null?void 0:L.expression.raw,disabled:""},null,8,["modelValue"])):(i(),S(W,{key:0,modelValue:e.column,placeholder:"Column",options:r.value,"onUpdate:modelValue":D[1]||(D[1]=j=>e.column=j||{}),"onUpdate:query":v(o).fetchColumnOptions},null,8,["modelValue","options","onUpdate:query"])),_(e.column)?(i(),$("span",ac,[M(" Editing a filter with a "),rc,M(" is not supported yet. Remove this filter and add an expression filter instead. ")])):A("",!0)]),l("div",ic,[uc,p(W,{modelValue:e.operator,placeholder:"Operator",options:c.value,"onUpdate:modelValue":D[2]||(D[2]=j=>e.operator=j)},null,8,["modelValue","options"])]),b.value!=="none"?(i(),$("div",cc,[dc,p(ec,{filter:e,"selector-type":b.value,"onUpdate:filter":D[3]||(D[3]=j=>e.value=j.value)},null,8,["filter","selector-type"])])):A("",!0)],64)):A("",!0),l("div",pc,[p(oe,{variant:"outline",onClick:D[4]||(D[4]=j=>t(x.value?"discard":"remove"))},{default:O(()=>[M(" Discard ")]),_:1}),l("div",mc,[p(oe,{variant:"outline",theme:"red",onClick:D[5]||(D[5]=j=>t("remove"))},{default:O(()=>[M("Remove")]),_:1}),p(oe,{variant:"solid",disabled:!x.value,onClick:D[6]||(D[6]=j=>t("save",e))},{default:O(()=>[M(" Save ")]),_:1},8,["disabled"])])])])}}},vc={class:"mb-2 flex items-center justify-between"},_c={class:"flex items-center space-x-1.5"},hc=l("p",{class:"font-medium"},"Filter",-1),yc={class:"space-y-2"},xc=["onClick"],gc={class:"flex w-full items-center overflow-hidden"},bc={key:0,class:"flex w-full space-x-2"},wc={key:0,class:"truncate font-mono"},$c={class:"max-w-[40%] flex-shrink-0 truncate"},kc={class:"flex-shrink-0 font-medium text-green-600"},Cc={key:0,class:"flex-1 flex-shrink-0 truncate"},Vc={key:1,class:"text-gray-600"},Tc={class:"flex items-center"},Ac={class:"w-[20rem] rounded bg-white text-base shadow-2xl"},Oc={__name:"FilterSection",setup(a){B("query");const t=B("assistedQuery"),n=V(()=>t.filters),o=E(null),s=E(null);function e(){t.addFilter(),s.value=n.value.length-1}function r(){t.removeFilterAt(s.value),s.value=null}function x(m){t.updateFilterAt(s.value,m),s.value=null}function c(m){var g,w,u,d;return(g=m.expression)!=null&&g.raw&&((w=m.expression)!=null&&w.ast)?!0:(m.column.column||((u=m.column.expression)==null?void 0:u.raw)&&((d=m.column.expression)==null?void 0:d.ast))&&m.operator.value&&(m.value.value||m.operator.value.includes("is_"))}return(m,f)=>{var w;const g=T("Button");return i(),$(F,null,[l("div",null,[l("div",vc,[l("div",_c,[p(v(St),{class:"h-4 w-4 text-gray-600"}),hc]),p(g,{variant:"outline",icon:"plus",onClick:N(e,["prevent","stop"])},null,8,["onClick"])]),l("div",yc,[(i(!0),$(F,null,G(n.value,(u,d)=>{var b;return i(),$("div",{ref_for:!0,ref_key:"filterRefs",ref:o,key:d,class:Z(["group flex h-8 cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow",s.value===d?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:_=>s.value=n.value.indexOf(u)},[l("div",gc,[c(u)?(i(),$("div",bc,[(b=u.expression)!=null&&b.raw?(i(),$("span",wc,Q(u.expression.raw),1)):(i(),$(F,{key:1},[l("span",$c,Q(u.column.label||u.column.column),1),l("span",kc,Q(u.operator.value),1),u.operator.value.includes("is_")?A("",!0):(i(),$("span",Cc,Q(u.value.label||u.value.value),1))],64))])):(i(),$("div",Vc,"Select a filter"))]),l("div",Tc,[p(v(Te),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:N(_=>v(t).removeFilterAt(d),["prevent","stop"])},null,8,["onClick"])])],10,xc)}),128))])]),(w=o.value)!=null&&w[s.value]?(i(),S(_e,{key:0,show:s.value!==null,"onUpdate:show":f[1]||(f[1]=u=>s.value=null),"target-element":o.value[s.value],placement:"right-start"},{default:O(()=>[l("div",Ac,[p(fc,{filter:n.value[s.value],onDiscard:f[0]||(f[0]=u=>s.value=null),onRemove:r,onSave:x},null,8,["filter"])])]),_:1},8,["show","target-element"])):A("",!0)],64)}}},Sc={class:"space-x-1"},Ec={__name:"ResultColumnActions",props:{column:Object},setup(a){const t=a,n=B("assistedQuery");function o(r){var x;return(x=n.columns.find(c=>c.label==r))==null?void 0:x.order}const s=[{label:"Sort Ascending",onClick:()=>n.setOrderBy(t.column.label,"asc")},{label:"Sort Descending",onClick:()=>n.setOrderBy(t.column.label,"desc")},{label:"Remove Sort",onClick:()=>n.setOrderBy(t.column.label,"")}],e={asc:oo,desc:to};return(r,x)=>{const c=T("Dropdown");return i(),$("div",Sc,[p(c,{options:s},{default:O(()=>[(i(),S(ce(e[o(a.column.label)]||v(eo)),{class:"h-4 w-4 cursor-pointer text-gray-500 hover:text-gray-700"}))]),_:1})])}}},Dc={class:"flex flex-col gap-1 p-4"},Rc=l("span",{class:"text-sm font-medium text-gray-700"},"Join",-1),Qc={class:"mb-2 flex gap-2"},Ic={class:"flex-1"},Uc={class:"flex-shrink-0"},Bc={class:"flex-1"},Mc=l("span",{class:"text-sm font-medium text-gray-700"},"Condition",-1),Fc={class:"mb-2 flex gap-2"},Pc={class:"flex-1"},Nc=l("div",{class:"flex flex-shrink-0 items-center font-mono"},"=",-1),Lc={class:"flex-1"},jc={class:"flex justify-between"},qc={class:"flex gap-2"},Gc={__name:"TableJoinEditor",props:{join:Object},emits:["save","remove","discard"],setup(a,{emit:t}){const n=a,o=B("assistedQuery"),s=st(o.data_source);!s.tableList.length&&s.fetchTables();const e=H(P({left_table:{},left_column:{},join_type:{},right_table:{},right_column:{}},n.join)),r=(w,u)=>w.value=u;r(e.left_table,e.left_table.table),r(e.left_column,e.left_column.column),r(e.right_table,e.right_table.table),r(e.right_column,e.right_column.column);const x=V(()=>[{label:"Inner Join",value:"inner"},{label:"Left Join",value:"left"}]),c=V(()=>{const w=[o.table];return o.joins.forEach(u=>{u.right_table.table!==e.right_table.table&&(w.find(d=>d.table===u.right_table.table)||w.push(u.right_table))}),w.map(u=>Y(P({},u),{value:u.table}))}),m=V(()=>(s==null?void 0:s.groupedTableOptions)||[]),f=E(null),g=E(null);return q(()=>{var w;return(w=e.left_table)==null?void 0:w.table},(w,u)=>J(this,null,function*(){var b;if(!w||w===u)return;const d=yield Le({data_source:o.data_source,table:w});f.value=d.columns.map(_=>({column:_.column,table:_.table,label:_.label,value:_.column})),((b=e.left_column)==null?void 0:b.table)!==w&&(e.left_column={})}),{immediate:!0}),q(()=>{var w;return(w=e.right_table)==null?void 0:w.table},(w,u)=>J(this,null,function*(){var b;if(!w||w===u)return;const d=yield Le({data_source:o.data_source,table:w});g.value=d.columns.map(_=>({column:_.column,table:_.table,label:_.label,value:_.column})),((b=e.right_column)==null?void 0:b.table)!==w&&(e.right_column={})}),{immediate:!0}),(w,u)=>{const d=T("Autocomplete"),b=T("Button");return i(),$("div",Dc,[Rc,l("div",Qc,[l("div",Ic,[p(d,{modelValue:e.left_table,"onUpdate:modelValue":u[0]||(u[0]=_=>e.left_table=_),hideSearch:!0,options:c.value,placeholder:"Left Table"},null,8,["modelValue","options"])]),l("div",Uc,[p(d,{modelValue:e.join_type,"onUpdate:modelValue":u[1]||(u[1]=_=>e.join_type=_),"hide-search":!0,options:x.value,placeholder:"Join Type"},null,8,["modelValue","options"])]),l("div",Bc,[p(d,{modelValue:e.right_table,"onUpdate:modelValue":u[2]||(u[2]=_=>e.right_table=_),options:m.value,placeholder:"Right Table"},null,8,["modelValue","options"])])]),Mc,l("div",Fc,[l("div",Pc,[p(d,{modelValue:e.left_column,"onUpdate:modelValue":u[3]||(u[3]=_=>e.left_column=_),options:f.value,placeholder:"Left Column"},null,8,["modelValue","options"])]),Nc,l("div",Lc,[p(d,{modelValue:e.right_column,"onUpdate:modelValue":u[4]||(u[4]=_=>e.right_column=_),options:g.value,placeholder:"Right Column"},null,8,["modelValue","options"])])]),l("div",jc,[p(b,{variant:"outline",onClick:u[5]||(u[5]=_=>t("discard"))},{default:O(()=>[M("Discard")]),_:1}),l("div",qc,[p(b,{variant:"outline",theme:"red",onClick:u[6]||(u[6]=_=>t("remove"))},{default:O(()=>[M("Remove")]),_:1}),p(b,{variant:"solid",onClick:u[7]||(u[7]=_=>t("save",e))},{default:O(()=>[M("Save")]),_:1})])])])}}},Hc={class:"mb-2 flex items-center justify-between"},zc={class:"flex items-center space-x-1.5"},Wc=l("p",{class:"font-medium"},"Data",-1),Jc={class:"space-y-2"},Kc={key:0,class:"group flex h-8 cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow"},Yc={class:"flex items-center space-x-2"},Zc={class:"flex flex-1 items-center gap-2"},Xc={class:"truncate"},ed={class:"flex items-center space-x-2"},td=["onClick"],od={class:"flex flex-1 items-center gap-2"},ld={class:"truncate"},nd={class:"min-w-[24rem] rounded bg-white text-base shadow-2xl"},sd={__name:"TableSection",setup(a){const t=B("assistedQuery");let n=H({});et(()=>t.data_source,(f,g)=>{f&&f!=g&&(n=st(t.data_source),n.fetchTables())},{immediate:!0});const o=V(()=>t.joins),s=E([]),e=E(null);function r(f){t.updateJoinAt(e.value,f),e.value=null}function x(){t.removeJoinAt(e.value),e.value=null}const c=We();function m(f){const g=f.startsWith("QRY-")?c.resolve({name:"Query",params:{name:f}}):c.resolve({name:"DataSource",params:{name:t.data_source}});window.open(g.href,"_blank")}return(f,g)=>{var u;const w=T("Button");return i(),$(F,null,[l("div",null,[l("div",Hc,[l("div",zc,[p(v(fo),{class:"h-4 w-4 text-gray-600"}),Wc]),(i(),S(qt,{key:v(t).data_source,bodyClasses:"w-[18rem]",options:v(n).groupedTableOptions,"onUpdate:modelValue":g[0]||(g[0]=d=>d&&v(t).addTable(d))},{target:O(({togglePopover:d})=>[p(w,{variant:"outline",icon:"plus",onClick:d},null,8,["onClick"])]),_:1},8,["options"]))]),l("div",Jc,[v(t).table.table?(i(),$("div",Kc,[l("div",Yc,[l("div",Zc,[l("span",Xc,Q(v(t).table.label),1),p(v(je),{class:"h-3 w-3 text-gray-600 opacity-0 transition-all hover:text-gray-800 group-hover:opacity-100",onClick:g[1]||(g[1]=N(d=>m(v(t).table.table),["prevent","stop"]))})])]),l("div",ed,[p(v(Te),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:g[2]||(g[2]=d=>v(t).resetMainTable())})])])):A("",!0),(i(!0),$(F,null,G(o.value,(d,b)=>(i(),$("div",{ref_for:!0,ref_key:"joinRefs",ref:s,key:d.right_table.table,class:Z(["group flex h-8 cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow",b===e.value?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""]),onClick:_=>e.value=b},[l("div",od,[l("span",ld,Q(d.right_table.label),1),p(v(je),{class:"h-3 w-3 text-gray-600 opacity-0 transition-all hover:text-gray-800 group-hover:opacity-100",onClick:N(_=>m(d.right_table.table),["prevent","stop"])},null,8,["onClick"])]),d.join_type.value=="left"?(i(),S(yt,{key:0,class:"text-gray-600"})):A("",!0),d.join_type.value=="right"?(i(),S(xt,{key:1,class:"text-gray-600"})):A("",!0),d.join_type.value=="inner"?(i(),S(gt,{key:2,class:"text-gray-600"})):A("",!0),d.join_type.value=="full"?(i(),S(bt,{key:3,class:"text-gray-600"})):A("",!0)],10,td))),128))])]),(u=s.value)!=null&&u[e.value]?(i(),S(_e,{key:e.value,show:e.value!==null,"onUpdate:show":g[5]||(g[5]=d=>e.value=null),"target-element":s.value[e.value],placement:"right-start"},{default:O(()=>[l("div",nd,[p(Gc,{join:o.value[e.value],onSave:g[3]||(g[3]=d=>r(d)),onDiscard:g[4]||(g[4]=d=>e.value=null),onRemove:x},null,8,["join"])])]),_:1},8,["show","target-element"])):A("",!0)],64)}}},ad={class:"space-y-1"},rd=l("span",{class:"text-sm font-medium text-gray-700"},"Number Column",-1),id={__name:"CumulativeSumTransformFields",props:{transformOptions:Object},emits:["update:transformOptions"],setup(a,{emit:t}){const n=a,o=B("query"),s=V({get:()=>n.transformOptions,set:r=>t("update:transformOptions",r)}),e=V(()=>o.resultColumns?o.resultColumns.filter(r=>se.NUMBER.includes(r.type)).map(r=>({label:r.label,value:r.label,description:r.type})):[]);return(r,x)=>{const c=T("Autocomplete");return i(),$("div",ad,[rd,p(c,{modelValue:s.value.column,"onUpdate:modelValue":x[0]||(x[0]=m=>s.value.column=m),"return-value":!0,placeholder:"Number Column",options:e.value},null,8,["modelValue","options"])])}}},ud={class:"space-y-1"},cd=l("span",{class:"text-sm font-medium text-gray-700"},"Column",-1),dd={key:0,class:"text-xs text-red-500"},pd={class:"space-y-1"},md=l("span",{class:"text-sm font-medium text-gray-700"},"Row",-1),fd={key:0,class:"text-xs text-red-500"},vd={class:"space-y-1"},_d=l("span",{class:"text-sm font-medium text-gray-700"},"Value",-1),hd={key:0,class:"text-xs text-red-500"},yd={__name:"PivotTransformFields",props:{transformOptions:Object},emits:["update:transformOptions"],setup(a,{emit:t}){const n=a,o=B("query"),s=V({get:()=>n.transformOptions,set:c=>t("update:transformOptions",c)}),e=V(()=>o.resultColumns?o.resultColumns.filter(c=>se.NUMBER.includes(c.type)).map(c=>({label:c.label,value:c.label,description:c.type})):[]),r=V(()=>o.resultColumns?o.resultColumns.map(c=>({label:c.label,value:c.label,description:c.type})):[]),x=V(()=>({column:s.value.column&&[s.value.index,s.value.value].includes(s.value.column)?"Column cannot be same as Row or Value":"",index:s.value.index&&[s.value.column,s.value.value].includes(s.value.index)?"Row cannot be same as Column or Value":"",value:s.value.value&&[s.value.column,s.value.index].includes(s.value.value)?"Value cannot be same as Column or Row":""}));return(c,m)=>{const f=T("Autocomplete");return i(),$(F,null,[l("div",ud,[cd,p(f,{modelValue:s.value.column,"onUpdate:modelValue":m[0]||(m[0]=g=>s.value.column=g),"return-value":!0,placeholder:"Column",options:r.value},null,8,["modelValue","options"]),x.value.column?(i(),$("span",dd,Q(x.value.column),1)):A("",!0)]),l("div",pd,[md,p(f,{modelValue:s.value.index,"onUpdate:modelValue":m[1]||(m[1]=g=>s.value.index=g),"return-value":!0,placeholder:"Row",options:r.value},null,8,["modelValue","options"]),x.value.index?(i(),$("span",fd,Q(x.value.index),1)):A("",!0)]),l("div",vd,[_d,p(f,{modelValue:s.value.value,"onUpdate:modelValue":m[2]||(m[2]=g=>s.value.value=g),"return-value":!0,placeholder:"Value",options:e.value},null,8,["modelValue","options"]),x.value.value?(i(),$("span",hd,Q(x.value.value),1)):A("",!0)])],64)}}},xd={class:"flex flex-col gap-4 p-4"},gd={class:"space-y-1"},bd=l("span",{class:"text-sm font-medium text-gray-700"},"Type",-1),wd={class:"flex justify-between"},$d={class:"flex gap-2"},kd={__name:"TransformEditor",props:{transform:Object},emits:["save","discard","remove"],setup(a,{emit:t}){const n=a;B("assistedQuery"),B("query");const o=H(P(P({},ru),n.transform));o.type||(o.type="Pivot"),o.options||(o.options={});const s=[{label:"Select Transform Type",value:"",disabled:!0},{label:"Pivot",value:"Pivot"},{label:"Cumulative Sum",value:"CumulativeSum"}],e=V(()=>(o==null?void 0:o.type)&&!ne(o.options));return(r,x)=>{const c=T("FormControl"),m=T("Button");return i(),$("div",xd,[l("div",gd,[bd,p(c,{type:"select",modelValue:o.type,"onUpdate:modelValue":[x[0]||(x[0]=f=>o.type=f),x[1]||(x[1]=f=>o.options={})],placeholder:"Select Transform Type",options:s},null,8,["modelValue"])]),o.type=="Pivot"?(i(),S(yd,{key:0,transformOptions:o.options,"onUpdate:transformOptions":x[2]||(x[2]=f=>o.options=f)},null,8,["transformOptions"])):o.type=="CumulativeSum"?(i(),S(id,{key:1,transformOptions:o.options,"onUpdate:transformOptions":x[3]||(x[3]=f=>o.options=f)},null,8,["transformOptions"])):A("",!0),l("div",wd,[p(m,{variant:"outline",onClick:x[4]||(x[4]=f=>t(e.value?"discard":"remove"))},{default:O(()=>[M(" Discard ")]),_:1}),l("div",$d,[p(m,{variant:"outline",theme:"red",onClick:x[5]||(x[5]=f=>t("remove"))},{default:O(()=>[M("Remove")]),_:1}),p(m,{variant:"solid",disabled:!e.value,onClick:x[6]||(x[6]=f=>t("save",o))},{default:O(()=>[M(" Save ")]),_:1},8,["disabled"])])])])}}},Cd={class:"mb-2 flex items-center justify-between"},Vd={class:"flex items-center space-x-1.5"},Td=l("p",{class:"font-medium"},"Transform",-1),Ad={class:"space-y-2"},Od={class:"flex w-full items-center overflow-hidden"},Sd={key:0,class:"flex w-full space-x-2 truncate"},Ed={class:"truncate"},Dd={key:1,class:"text-gray-600"},Rd={class:"flex items-center space-x-2"},Qd={class:"w-[20rem] rounded bg-white text-base shadow-2xl"},Id={__name:"TransformSection",setup(a){B("query");const t=B("assistedQuery"),n=E(null),o=E(null),s={Pivot:uo,Unpivot:io,Transpose:co,CumulativeSum:vo},e={Pivot:"Convert Row to Column",Unpivot:"Convert Column to Row",Transpose:"Transpose",CumulativeSum:"Cumulative Sum"};function r(){t.addTransform(),o.value=t.transforms.length-1}function x(){t.removeTransformAt(o.value),o.value=null}function c(f){t.updateTransformAt(o.value,f),o.value=null}function m(f){return(f==null?void 0:f.type)&&!ne(f.options)}return(f,g)=>{var u;const w=T("Button");return i(),$(F,null,[l("div",null,[l("div",Cd,[l("div",Vd,[p(v(mo),{class:"h-3.5 w-3.5 text-gray-600"}),Td]),p(w,{variant:"outline",icon:"plus",onClick:N(r,["prevent","stop"])},null,8,["onClick"])]),l("div",Ad,[(i(!0),$(F,null,G(v(t).transforms,(d,b)=>(i(),$("div",{ref_for:!0,ref_key:"transformRefs",ref:n,key:b,class:Z(["group flex h-8 cursor-pointer items-center justify-between rounded border border-gray-300 bg-white px-2 hover:shadow",o.value===b?"border-gray-500 bg-white shadow-sm ring-1 ring-gray-400":""])},[l("div",Od,[m(d)?(i(),$("div",Sd,[(i(),S(ce(s[d.type]),{class:"h-4 w-4 text-gray-600"})),l("span",Ed,Q(e[d.type]),1)])):(i(),$("div",Dd,"Select a transform"))]),l("div",Rd,[p(v(Te),{class:"invisible h-4 w-4 text-gray-600 transition-all hover:text-gray-800 group-hover:visible",onClick:N(_=>v(t).removeTransformAt(b),["prevent","stop"])},null,8,["onClick"])])],2))),128))])]),(u=n.value)!=null&&u[o.value]?(i(),S(_e,{key:0,show:o.value!==null,"onUpdate:show":g[1]||(g[1]=d=>o.value=null),"target-element":n.value[o.value],placement:"right-start"},{default:O(()=>[l("div",Qd,[p(kd,{transform:v(t).transforms[o.value],onDiscard:g[0]||(g[0]=d=>o.value=null),onRemove:x,onSave:c},null,8,["transform"])])]),_:1},8,["show","target-element"])):A("",!0)],64)}}},Ud={class:"relative flex h-full w-full flex-row-reverse overflow-hidden border-t"},Bd={key:0,class:"absolute inset-0 z-[100] flex items-center justify-center bg-gray-100/50"},Md={class:"flex h-full w-full flex-col overflow-hidden p-4 pr-0"},Fd={class:"flex flex-1 flex-shrink-0 flex-col overflow-hidden"},Pd={class:"relative flex w-[23rem] flex-shrink-0 flex-col overflow-y-scroll border-r bg-white p-4 pt-0 pl-1"},Nd={class:"sticky top-0 z-10 w-full flex-shrink-0 bg-white py-4"},Ld={class:"space-y-4"},jd=l("hr",{class:"border-gray-200"},null,-1),qd=l("hr",{class:"border-gray-200"},null,-1),Gd=l("hr",{class:"border-gray-200"},null,-1),Hd={__name:"VisualQueryBuilder",setup(a){const t=E("Build"),n=["Build","Visualize"],o=B("query"),s=_u(o);Ue("assistedQuery",s),E(!1);const e=E(null),r=E(null),x=lt("insights:chartContainerHeight",void 0);return ve(()=>{au({disabled:!1,direction:"y",handle:e.value,target:e.value.previousElementSibling,onResize(c,m){x.value=m}})}),(c,m)=>(i(),$("div",Ud,[v(o).loading?(i(),$("div",Bd,[p(v(Rt),{class:"w-10 text-gray-600"})])):A("",!0),l("div",Md,[l("div",{ref_key:"chartContainer",ref:r,class:"flex h-[60%] !max-h-[60%] flex-shrink-0 flex-col overflow-hidden",style:Qt(v(x)>=0?`height: ${v(x)}px`:"")},[isNaN(v(x))||v(x)>=50?(i(),S(rt,{key:0})):A("",!0)],4),l("div",{ref_key:"resizeHandle",ref:e,class:"my-2 mx-auto w-20 cursor-ns-resize rounded-full bg-gray-100 py-1 transition-all"},null,512),l("div",Fd,[p(Ve,null,{columnActions:O(({column:f})=>[p(Ec,{column:f},null,8,["column"])]),footer:O(()=>[p($l)]),_:1})])]),l("div",Pd,[l("div",Nd,[p(Ie,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=f=>t.value=f),class:"w-full",tabs:n},null,8,["modelValue"])]),l("div",Ld,[t.value==="Build"?(i(),$(F,{key:0},[p(sd),jd,p(Oc),qd,p(Ju),Gd,p(Id)],64)):A("",!0),t.value==="Visualize"?(i(),S(at,{key:1})):A("",!0)])])]))}},zd={class:"sticky top-0 z-10 flex items-center justify-between bg-white px-5 py-2.5"},Wd={key:0,class:"flex h-full w-full flex-col space-y-4 overflow-hidden bg-white px-6 pt-2"},Jd={class:"w-full flex-shrink-0"},Kd={key:0,class:"flex flex-1 flex-shrink-0 overflow-hidden"},Yd={key:1,class:"flex flex-1 flex-shrink-0 gap-4 overflow-hidden"},Zd={class:"w-[21rem] flex-shrink-0"},Xd={class:"flex flex-1"},ep={__name:"Query",props:{name:String},setup(a){return J(this,null,function*(){let t,n;const o=a,s=ot(o.name);[t,n]=It(()=>s.reload()),yield t,n(),Ue("query",s);const e=E("Query"),r=["Query","Visualize"];return be(()=>{var x;(x=s.doc)!=null&&x.name&&(document.title=`${s.doc.name} - Frappe Insights`)}),(x,c)=>{var m,f;return i(),$(F,null,[l("header",zd,[p(Ot,{class:"h-7",items:[{label:"Queries",route:{path:"/query"}},{label:o.name,route:{path:`/query/build/${o.name}`}}]},null,8,["items"])]),(m=v(s).doc)!=null&&m.name?(i(),$("div",Wd,[l("div",Jd,[p(ln,null,Ut({_:2},[v(s).doc.is_assisted_query?void 0:{name:"right-actions",fn:O(()=>[p(Ie,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=g=>e.value=g),tabs:r},null,8,["modelValue"])]),key:"0"}]),1024)]),e.value=="Query"?(i(),$("div",Kd,[v(s).doc.is_assisted_query?(i(),S(Hd,{key:0})):v(s).doc.is_native_query?(i(),S(Ul,{key:1})):v(s).doc.is_script_query?(i(),S(Mn,{key:2})):!v(s).doc.is_assisted_query&&!v(s).doc.is_native_query&&!v(s).doc.is_script_query?(i(),S(su,{key:3})):A("",!0)])):A("",!0),e.value=="Visualize"&&((f=v(s).chart.doc)!=null&&f.name)?(i(),$("div",Yd,[l("div",Zd,[p(at)]),l("div",Xd,[p(rt)])])):A("",!0)])):A("",!0)],64)}})}},bp=Object.freeze(Object.defineProperty({__proto__:null,default:ep},Symbol.toStringTag,{value:"Module"}));export{bp as Q,Ro as _,ep as a};
