var ee=Object.defineProperty;var z=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var A=(_,n,e)=>n in _?ee(_,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[n]=e,R=(_,n)=>{for(var e in n||(n={}))te.call(n,e)&&A(_,e,n[e]);if(z)for(var e of z(n))le.call(n,e)&&A(_,e,n[e]);return _};var H=(_,n,e)=>new Promise((f,c)=>{var w=i=>{try{r(e.next(i))}catch(a){c(a)}},y=i=>{try{r(e.throw(i))}catch(a){c(a)}},r=i=>i.done?f(i.value):Promise.resolve(i.value).then(w,y);r((e=e.apply(_,n)).next())});import{I as ae}from"./IndicatorIcon-7b530cb8.js";import{_ as se,v as k,x as B,N as p,r as F,u as oe,G as L,H as d,L as o,z as m,aQ as ne,y as J,a8 as M,a9 as W,J as re,aR as ie,K as ue,aS as ce,n as de,aj as pe,w as K,f as E,S as me,aT as T,aU as fe,M as I,aH as ve,O as S,F as G,E as _e,ar as P,Z as X,U as ye,B as Z,X as Y,Y as ge,aB as he,b as be,aI as xe,aJ as $,a5 as Q,A as ke}from"./frappe-ui-24524c82.js";import{L as we}from"./ListView-7e5cf52e.js";import{N as Se}from"./NewDialogWithTypes-fb9c228f.js";import{P as Ce}from"./PageBreadcrumbs-e38fbd0a.js";import{u as Ve}from"./useNotebooks-212680cb.js";import{u as Fe}from"./dataSourceStore-3ba6c3b5.js";import{u as Ne}from"./queryStore-d82f5e4a.js";import{u as $e,s as Le,l as qe}from"./index-61e7aa99.js";import{g as Ue}from"./widgets-f5903e20.js";import{u as Ee}from"./index-45270e13.js";import{P as Be}from"./plus-32532d21.js";const je={},Qe={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"},De=p("path",{d:"M2 4.5H14",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Oe=p("path",{d:"M4 8.5H12",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Pe=p("path",{d:"M6.5 12.5H9.5",stroke:"currentColor","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Te=[De,Oe,Pe];function Ie(_,n){return k(),B("svg",Qe,Te)}const ze=se(je,[["render",Ie]]),Ae={__name:"NestedPopover",props:{placement:{type:String,default:"bottom-start"}},setup(_){const n=_,e=F(null),f=F(null);let c=F(null);function w(){c.value?c.value.update():c.value=pe(e.value.el,f.value.el,{placement:n.placement})}function y(){de(()=>w())}return oe(()=>{var r;(r=c.value)==null||r.destroy()}),(r,i)=>(k(),L(m(ce),null,{default:d(({open:a})=>[o(m(ne),{as:"div",ref_key:"reference",ref:e,onClick:y,onFocusin:y,onKeydown:y},{default:d(({open:C})=>[J(r.$slots,"target",M(W({open:C})))]),_:2},1536),re(p("div",null,[o(m(ie),{ref_key:"popover",ref:f,static:"",class:"z-[100]"},{default:d(({open:C,close:q})=>[J(r.$slots,"body",M(W({open:C,close:q})))]),_:2},1536)],512),[[ue,a]])]),_:3}))}},Re={__name:"SearchComplete",props:{value:{type:String,required:!1,default:""},doctype:{type:String,required:!0},searchField:{type:String,required:!1,default:"name"},labelField:{type:String,required:!1,default:"name"},valueField:{type:String,required:!1,default:"name"},pageLength:{type:Number,required:!1,default:10}},emits:["update:modelValue"],setup(_,{emit:n}){const e=_;K(()=>e.doctype,r=>{c.doctype=r,c.reload()});const f=E({get:()=>e.value,set:r=>n("update:modelValue",r)}),c=me({doctype:e.doctype,pageLength:e.pageLength,cache:["link_doctype",e.doctype],auto:!0,fields:[e.labelField,e.searchField,e.valueField],onSuccess:()=>{}}),w=E(()=>{var i;const r=((i=c.data)==null?void 0:i.map(a=>({label:a[e.labelField],value:a[e.valueField]})))||[];return f.value&&!r.find(a=>a.value===f.value)&&r.push({label:f.value,value:f.value}),r});function y(r){c.update({filters:{[e.searchField]:["like",`%${r}%`]}}),c.reload()}return(r,i)=>(k(),L(m(T),{placeholder:"Select an option",options:w.value,modelValue:f.value,"onUpdate:query":i[0]||(i[0]=a=>y(a)),"onUpdate:modelValue":i[1]||(i[1]=a=>f.value=a.value)},null,8,["options","modelValue"]))}},He={class:"flex h-5 w-5 items-center justify-center rounded bg-gray-900 pt-[1px] text-xs font-medium text-white"},Je={class:"my-2 rounded-lg border border-gray-100 bg-white shadow-xl"},Me={class:"min-w-[400px] p-2"},We={class:"flex flex-1 items-center gap-2"},Ye={class:"w-13 flex-shrink-0 pl-2 text-end text-base text-gray-600"},Ke={id:"fieldname",class:"!min-w-[140px] flex-1"},Ge={id:"operator",class:"!min-w-[140px] flex-shrink-0"},Xe={id:"value",class:"!min-w-[140px] flex-1"},Ze={class:"flex-shrink-0"},et={key:1,class:"mb-3 flex h-7 items-center px-3 text-sm text-gray-600"},tt={class:"flex items-center justify-between gap-2"},lt={__name:"ListFilter",props:{modelValue:{type:Object,default:()=>({})},docfields:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(_,{emit:n}){const e=_,f=["Check"],c=["Link"],w=["Float","Int"],y=["Select"],r=["Data","Long Text","Small Text","Text Editor","Text","JSON","Code"],i=E(()=>e.docfields.filter(l=>!l.is_virtual&&(f.includes(l.fieldtype)||c.includes(l.fieldtype)||w.includes(l.fieldtype)||y.includes(l.fieldtype)||r.includes(l.fieldtype))).map(l=>R({label:l.label,value:l.fieldname,description:l.fieldtype},l))),a=F(C(e.modelValue));K(a,t=>n("update:modelValue",N(t)),{deep:!0}),fe(()=>{const t=C(e.modelValue);JSON.stringify(a.value)!==JSON.stringify(t)&&(a.value=t)});function C(t){return Object.entries(t).map(([l,[b,j]])=>{const u=q(l);return{fieldname:l,operator:b,value:j,field:u}})}function q(t){return i.value.find(l=>l.fieldname===t)}function N(t){return t.reduce((l,b)=>{const{fieldname:j,operator:u,value:U}=b;return l[j]=[u,U],l},{})}function D(t){let l=[];return(r.includes(t)||c.includes(t))&&l.push({label:"Equals",value:"="},{label:"Not Equals",value:"!="},{label:"Like",value:"like"},{label:"Not Like",value:"not like"}),w.includes(t)&&l.push({label:"<",value:"<"},{label:">",value:">"},{label:"<=",value:"<="},{label:">=",value:">="},{label:"Equals",value:"="},{label:"Not Equals",value:"!="}),y.includes(t)&&l.push({label:"Equals",value:"="},{label:"Not Equals",value:"!="}),f.includes(t)&&l.push({label:"Equals",value:"="}),l}function x(t){return y.includes(t)||c.includes(t)||f.includes(t)||w.includes(t)?"=":"like"}function v(t,l){if(y.includes(t)||f.includes(t)){const b=t=="Check"?["Yes","No"]:g(l);return Y(P,{type:"select",options:b})}else return Y(P,{type:"text"})}function h(t){return y.includes(t.fieldtype)?g(t.options)[0]:f.includes(t.fieldtype)?"Yes":""}function g(t){return t.split(`
`)}function s(t){const l=q(t),b={fieldname:t,operator:x(l.fieldtype),value:h(l),field:l};a.value=[...a.value,b]}function O(t){a.value=a.value.filter((l,b)=>b!==t)}return(t,l)=>{const b=I("Button");return k(),L(Ae,null,{target:d(()=>[o(b,{label:"Filter"},ve({prefix:d(()=>[o(ze,{class:"h-4"})]),_:2},[a.value.length?{name:"suffix",fn:d(()=>[p("div",He,S(a.value.length),1)]),key:"0"}:void 0]),1024)]),body:d(({close:j})=>[p("div",Je,[p("div",Me,[a.value.length?(k(!0),B(G,{key:0},_e(a.value,(u,U)=>(k(),B("div",{key:U,id:"filter-list",class:"mb-3 flex items-center justify-between gap-2"},[p("div",We,[p("div",Ye,S(U==0?"Where":"And"),1),p("div",Ke,[o(m(T),{modelValue:u.fieldname,options:i.value,"onUpdate:modelValue":V=>u.fieldname=V.value,placeholder:"Filter by..."},null,8,["modelValue","options","onUpdate:modelValue"])]),p("div",Ge,[o(m(P),{type:"select",modelValue:u.operator,"onUpdate:modelValue":V=>u.operator=V,options:D(u.field.fieldtype),placeholder:"Operator"},null,8,["modelValue","onUpdate:modelValue","options"])]),p("div",Xe,[c.includes(u.field.fieldtype)&&["=","!="].includes(u.operator)?(k(),L(Re,{key:0,doctype:u.field.options,modelValue:u.value,"onUpdate:modelValue":V=>u.value=V,placeholder:"Value"},null,8,["doctype","modelValue","onUpdate:modelValue"])):(k(),L(X(v(u.field.fieldtype,u.field.options)),{key:1,modelValue:u.value,"onUpdate:modelValue":V=>u.value=V,placeholder:"Value"},null,8,["modelValue","onUpdate:modelValue"]))])]),p("div",Ze,[o(b,{variant:"ghost",icon:"x",onClick:V=>O(U)},null,8,["onClick"])])]))),128)):(k(),B("div",et," Empty - Choose a field to filter by ")),p("div",tt,[o(m(T),{value:"",options:i.value,onChange:l[0]||(l[0]=u=>s(u.value)),placeholder:"Filter by..."},{target:d(({togglePopover:u})=>[o(b,{class:"!text-gray-600",variant:"ghost",onClick:U=>u(),label:"Add filter"},{prefix:d(()=>[o(m(ye),{name:"plus",class:"h-4"})]),_:2},1032,["onClick"])]),_:1},8,["options"]),a.value.length?(k(),L(b,{key:0,class:"!text-gray-600",variant:"ghost",label:"Clear all filter",onClick:l[1]||(l[1]=u=>a.value=[])})):Z("",!0)])])])]),_:1})}}},at={class:"sticky top-0 z-10 flex items-center justify-between bg-white px-5 py-2.5"},st=p("div",{class:"text-xl font-medium"},"No Query Created.",-1),ot=p("div",{class:"mt-1 text-base text-gray-600"},"Create a new query to get started.",-1),ht={__name:"QueryList",setup(_){const n=Ne(),e=F(!1);ge().hash=="#new"&&(e.value=!0);const c=he(),w=Fe(),y=F({dataSource:"",title:""});E(()=>[{label:"Select a Data Source",value:""},...w.list.map(x=>({label:x.title,value:x.name}))]),E(()=>!y.value.dataSource||!y.value.title||n.creating);const r=F({title:"Queries"});$e(r);const i=Ve();i.reload();function a(x){return H(this,null,function*(){if(x==="notebook"){const g=i.list.find(O=>O.title==="Uncategorized"),s=yield i.createPage(g.name);return c.push({name:"NotebookPage",params:{notebook:g.name,name:s}})}const v={};x==="visual"&&(v.is_assisted_query=1),x==="sql"&&(v.is_native_query=1),x==="script"&&(v.is_script_query=1);const h=yield n.create(v);c.push({name:"Query",params:{name:h.name}})})}const C=F([{label:"Notebook",description:"Create a query using the notebook interface",icon:"book",tag:"beta",onClick:()=>a("notebook")},{label:"Visual",description:"Create a query using the visual interface",icon:"box",onClick:()=>a("visual")},{label:"SQL",description:"Create a query by writing native query",icon:"code",onClick:()=>a("sql")},{label:"Script",description:"Create a query by writing a python script",icon:"code",tag:"beta",onClick:()=>a("script")}]),q=Le().user.user_id,N=Ee("insights:query-list-filters",{owner:["=",q]}),D=E(()=>qe(N.value)?n.list:n.list.filter(x=>{for(const[v,[h,g]]of Object.entries(N.value)){if(!v||!h||!g)continue;const s=x[v];if(h==="=")return s===g;if(h==="!=")return s!==g;if(h==="<")return s<g;if(h===">")return s>g;if(h==="<=")return s<=g;if(h===">=")return s>=g;if(h.includes("like"))return s.toLowerCase().includes(g.toLowerCase())}return!0}));return(x,v)=>{const h=I("Button"),g=I("Avatar");return k(),B(G,null,[p("header",at,[o(Ce,{class:"h-7",items:[{label:"Queries"}]}),p("div",null,[o(h,{label:"New Query",variant:"solid",onClick:v[0]||(v[0]=s=>e.value=!0)},{prefix:d(()=>[o(m(Be),{class:"w-4"})]),_:1})])]),o(we,{columns:[{label:"Title",name:"title",class:"flex-[3]"},{label:"Status",name:"status",class:"flex-[2]"},{label:"Chart Type",name:"chart_type",class:"flex-1"},{label:"Data Source",name:"data_source",class:"flex-1"},{label:"ID",name:"name",class:"flex-1"},{label:"Created By",name:"owner_name",class:"flex-1"},{label:"Created",name:"created_from_now",class:"flex-1 text-right"}],rows:D.value},{actions:d(()=>[o(lt,{modelValue:m(N),"onUpdate:modelValue":v[1]||(v[1]=s=>be(N)?N.value=s:null),docfields:m(n).getFilterableFields()},null,8,["modelValue","docfields"])]),"list-row":d(({row:s})=>[o(m(xe),{as:"router-link",row:s,to:{name:"Query",params:{name:s.name}}},{default:d(()=>[o(m($),{class:"flex-[3]"},{default:d(()=>[Q(S(s.title),1)]),_:2},1024),o(m($),{class:"flex-[2] space-x-2"},{default:d(()=>[o(ae,{class:ke({"Pending Execution":"text-yellow-500","Execution Successful":"text-green-500","Execution Failed":"text-red-500"}[s.status]||"text-gray-500")},null,8,["class"]),p("span",null,S(s.status),1)]),_:2},1024),o(m($),{class:"flex-1 space-x-2"},{default:d(()=>[s.chart_type?(k(),L(X(m(Ue)(s.chart_type)),{key:0,class:"h-4 w-4 text-gray-700"})):Z("",!0),p("span",null,S(s.chart_type),1)]),_:2},1024),o(m($),{class:"flex-1"},{default:d(()=>[Q(S(s.data_source),1)]),_:2},1024),o(m($),{class:"flex-1"},{default:d(()=>[Q(S(s.name),1)]),_:2},1024),o(m($),{class:"flex-1 space-x-2"},{default:d(()=>[o(g,{image:s.owner_image,label:s.owner_name,size:"md"},null,8,["image","label"]),p("span",null,S(s.owner_name),1)]),_:2},1024),o(m($),{class:"flex-1 justify-end"},{default:d(()=>[Q(S(s.created_from_now),1)]),_:2},1024)]),_:2},1032,["row","to"])]),emptyState:d(()=>[st,ot,o(h,{class:"mt-3",label:"New Query",variant:"solid",onClick:v[2]||(v[2]=s=>e.value=!0)})]),_:1},8,["rows"]),o(Se,{show:e.value,"onUpdate:show":v[3]||(v[3]=s=>e.value=s),title:"Select Interface Type",types:C.value},null,8,["show","types"])],64)}}};export{ht as default};
