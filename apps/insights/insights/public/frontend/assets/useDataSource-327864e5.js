var m=(s,n,a)=>new Promise((b,r)=>{var i=o=>{try{u(a.next(o))}catch(l){r(l)}},c=o=>{try{u(a.throw(o))}catch(l){r(l)}},u=o=>o.done?b(o.value):Promise.resolve(o.value).then(i,c);u((a=a.apply(s,n)).next())});import{E as S}from"./index-61e7aa99.js";import{u as D}from"./cacheStore-8d74b582.js";import{f as O,r as d,a as T}from"./frappe-ui-24524c82.js";function I(s){const n=D();if(n.getDataSource(s))return n.getDataSource(s);const a=S("Insights Data Source",s);a.fetchIfNeeded();const b=O({get:()=>a.doc||{},set:e=>a.doc=e}),r=d([]),i=d([]),c=d([]),u=d([]);function o(){return m(this,null,function*(){const e=[a.get_tables.submit(),a.get_queries.submit()],t=yield Promise.all(e);return r.value=t[0].message,i.value=t[1].message,c.value=l(),u.value=h(),r.value})}function l(){return r.value.filter(e=>!e.hidden).filter((e,t,p)=>p.findIndex(v=>v.table===e.table)===t).map(e=>({table:e.table,value:e.table,label:e.label,description:e.table,data_source:s}))}function h(){const e={Tables:[],Queries:[]};return r.value.filter(t=>!t.hidden&&!t.is_query_based).forEach(t=>{e.Tables.push({table:t.table,label:t.label,value:t.table,description:t.table,data_source:s})}),i.value.forEach(t=>{e.Queries.push({table:t.name,label:t.title,value:t.name,description:t.name,data_source:s})}),Object.entries(e).map(([t,p])=>({group:t,items:p}))}function _(e){return a.update_table_link.submit({data:e})}function g(e){return a.delete_table_link.submit({data:e})}const f=T({doc:b,tableList:r,dropdownOptions:c,groupedTableOptions:u,loading:a.loading,fetchTables:o,updateTableRelationship:_,deleteTableRelationship:g,syncTables:()=>a.enqueue_sync_tables.submit(),delete:()=>a.delete.submit()});return n.setDataSource(s,f),f}export{I as u};
