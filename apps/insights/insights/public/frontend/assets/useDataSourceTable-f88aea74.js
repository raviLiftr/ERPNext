var i=(c,n,o)=>new Promise((e,t)=>{var l=s=>{try{a(o.next(s))}catch(u){t(u)}},r=s=>{try{a(o.throw(s))}catch(u){t(u)}},a=s=>s.done?e(s.value):Promise.resolve(s.value).then(l,r);a((o=o.apply(c,n)).next())});import{E as g,j as d,H as f}from"./index-61e7aa99.js";import{u as y}from"./cacheStore-8d74b582.js";import{u as p}from"./index-45270e13.js";import{f as m,a as h}from"./frappe-ui-24524c82.js";function k(c){return i(this,null,function*(){const n=yield T(c),o=y();if(o.getTable(n))return o.getTable(n);const e=g("Insights Table",n);yield e.fetchIfNeeded(),yield d(()=>e.doc);const t=m({get:()=>e.doc||{},set:a=>e.doc=a}),l=m(()=>{var a;return(a=t.value)!=null&&a.columns?t.value.columns.map(s=>({column:s.column,type:s.type,label:s.label,table:t.value.table,table_label:t.value.label,data_source:t.value.data_source})):[]}),r=h({doc:t,columns:l,rows:m(()=>{var a;return(a=e.getPreview.data)==null?void 0:a.message}),loading:e.loading,syncing:e.syncTable.loading,sync:()=>e.syncTable.submit(),fetchPreview:()=>e.getPreview.submit(),updateColumnType:a=>e.update_column_type.submit({column:a.column,newtype:a.type})});return o.setTable(n,r),r})}const v=new Date().toISOString().split("T")[0],w=`insights:table-name-cache-{${v}}`;for(const c of Object.keys(localStorage))c.startsWith("insights:table-name-cache-")&&localStorage.removeItem(c);const b=p(w,{});function T(c){return i(this,null,function*(){const{name:n,table:o,data_source:e}=c;if(n)return n;const t=`${e}:${o}`;if(b.value[t])return b.value[t];const l=yield f(e,o);return b.value[t]=l,l})}export{k as u};
